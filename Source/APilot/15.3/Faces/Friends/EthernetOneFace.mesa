-- Copyright (C) 1980, 1981  by Xerox Corporation. All rights reserved. -- EthernetOneFace.mesa (last edited by: DXG      on: 26-Sep-84  2:25:52)DIRECTORY  Environment USING [Base, Byte];EthernetOneFace: DEFINITIONS =  BEGIN  -- PROCEDURES  GetNextDevice: PROCEDURE [DeviceHandle] RETURNS [DeviceHandle];  -- Return handle of next device in physical order (starts and ends with  -- EthernetOneFace.nullDeviceHandle).  GetEthernet1Address: PROCEDURE [DeviceHandle]    RETURNS [net, host: Environment.Byte];  -- Returns the net+host numbers from the switches (or Prom, or ...).  AddCleanup: PROCEDURE [DeviceHandle];  RemoveCleanup: PROCEDURE [DeviceHandle];  -- Add/delete the device cleanup procedure which is used to turn off an  -- Ethernet One controller around world swaps (see DeviceCleanup.mesa).  -- For now, RemoveCleanup doesn't do anything, but the (leftover) cleanup  -- proc is careful to avoid doing anything nasty.  (Extra calls to AddCleanup  -- are currently ignored.)  TurnOn: PROCEDURE [    device: DeviceHandle, host: Environment.Byte, inInterrupt, outInterrupt: WORD,    globalState: GlobalStatePtr];  TurnOff: PROCEDURE [device: DeviceHandle];  -- Turn on/off the device associated with this DeviceHandle.  Calling TurnOn  -- when the device is already on may forget any operations currently in  -- progress.  Extra calls to TurnOff are harmless.   QueueOutput: PROCEDURE [    device: DeviceHandle, buffer: LONG POINTER, length: CARDINAL,    cb: ControlBlock];  QueueInput: PROCEDURE [    device: DeviceHandle, buffer: LONG POINTER, length: CARDINAL,    cb: ControlBlock];  -- Queue the buffer for transmit or receive.  A (different) control block must  -- be passed in with each call for the private use of the head.  cb should be  -- a pointer to a block of EthernetOneFace.controlBlockSize words.  It must be  -- allocated within the first 64K and must be quad word aligned.  The data  -- buffer must be quad word aligned and less than 32K words long.  When  -- GetStatus[cb] returns anything other than pending, both the control block  -- and the data buffer are available for reuse.   GetStatus: PROCEDURE [cb: ControlBlock] RETURNS [status: Status];  -- Returns the status of the packet associated with this control block.  See  -- the comments on Status below.  GetRetries: PROCEDURE [cb: ControlBlock] RETURNS [CARDINAL];  -- Returns the number of times the packet was retransmitted because of collisions.  GetPacketLength: PROCEDURE [cb: ControlBlock] RETURNS [CARDINAL];  -- Returns the length in words of a recently arrived packet.  GetPacketsMissed: PROCEDURE [DeviceHandle] RETURNS [CARDINAL];  -- Returns the number of input packets missed because a buffer was not ready.  -- TYPES  DeviceHandle: TYPE [1];  GlobalStatePtr: TYPE = Environment.Base RELATIVE POINTER;  Status: TYPE = {    pending, ok, overrun,  -- Input data arrived when FIFO was full    underrun,  -- Output FIFO went empty before end of packet was set    packetTooLong,  -- Input packet didn't fit into buffer    tooManyCollisions,  -- More than 16 attempts to transmit the same packet    crc, crcAndBadAlignment, badAlignmentButOkCrc, otherError};  -- Note: The error conditions are an open ended set to allow a smart driver to  -- collect statistics.  Thus new error conditions may be added to allow more  -- sophisticated data collection, so a driver should not get upset if it  -- encounters a strange error status that it does not understand.  Dumb drivers  -- should only check for pending or ok and consider everything else as an error.  ControlBlock: TYPE = LONG POINTER TO ControlBlockRecord;  ControlBlockRecord: TYPE;  -- EXPORTED VARIABLES  globalStateSize: READONLY CARDINAL;  controlBlockSize: READONLY CARDINAL;  nullDeviceHandle: READONLY DeviceHandle;  hearSelf: READONLY BOOLEAN;  -- CONSTANTS  END.LOGTime: February 4, 1980  5:48 PM		By: PXM       Create fileTime: February 6, 1980  12:54 PM	By: Dawson   Add interface itemsTime: April 18, 1980  5:51 PM		By: HGM      Giant CleanupTime: August 20, 1980  2:05 PM		By: RYL     renames EthernetFace to EthernetOneFace and added hearSelfTime: September 5, 1980  12:11 AM	By: HGM   fix typos, add ControlBlockRecordTime: 11-Nov-81 11:11:34	By: AWL         Fix some comments.Time: 26-Sep-84  2:25:47	By: DXG     	Action: Added copyright notice and rebuild for 11.1 release.