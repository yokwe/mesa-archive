-- Copyright (C) 1982, 1983, 1986, 1987  by Xerox Corporation. All rights reserved. -- Scavenger.mesa (last edited by: RSV       on: 11-May-87 15:24:12)DIRECTORY  File USING [ID, File, nullFile, PageNumber, Type],  System USING [GreenwichMeanTime],  Volume USING [ID];Scavenger: DEFINITIONS =  BEGIN  Error: ERROR [error: ErrorType];  ErrorType: TYPE = {    bucketPageLost, cannotWriteLog, copyETFETLost, overflowIsLost,    overflowPageIsLost, primaryETFETLost, volumeOpen, diskHardwareError,    diskNotReady, eTableFilesHeaderLost, eTFETLost, eTFLogLost,      needsRiskyRepair, needsConversion};  Header: TYPE = MACHINE DEPENDENT RECORD [    seal(0): CARDINAL ¬ LogSeal,    version(1): CARDINAL ¬ currentLogVersion,    volume(2): Volume.ID,    date(7): System.GreenwichMeanTime,    repairMode(9:0..1): RepairType,    incomplete(9:2..2): BOOLEAN,    repaired(9:3..3): BOOLEAN,    bootFilesDeleted(9:4..9): BootFileArray,    pad(9:10..15): [0..0] ¬ 0,    numberOfFiles(10): LONG CARDINAL,    logEntries(12): LONG CARDINAL];    LogSeal: CARDINAL = 130725B;    currentLogVersion: CARDINAL = 2;  LogFormat: TYPE = MACHINE DEPENDENT RECORD [    header(0): Header, files(SIZE[Header]): ARRAY [0..0) OF FileEntry];  FileEntry: TYPE = MACHINE DEPENDENT RECORD [    file(0): File.ID,    sortKey(2): LONG CARDINAL,    numberOfProblems(4): CARDINAL,    problems(5): ARRAY [0..0) OF File.PageNumber];    RepairType: TYPE = MACHINE DEPENDENT {    checkOnly(0), safeRepair(1), riskyRepair(2)};  BootFileType: TYPE = MACHINE DEPENDENT{    hardMicrocode(0), softMicrocode(1), germ(2), pilot(3), debugger(4),    debuggee(5)};  BootFileArray: TYPE = PACKED ARRAY BootFileType OF BOOLEAN;  noneDeleted: BootFileArray = ALL[FALSE];  tScavengerLog: READONLY File.Type;    tScavengerLogOtherVolume: READONLY File.Type;    ClearLog: PROCEDURE [logFile: File.File];    CompactDisk: PROCEDURE [volume: Volume.ID];  GetLog: PROCEDURE [volume: Volume.ID]      RETURNS [logFile: File.File];       MakeFileList: PROCEDURE [volume, logDestination: Volume.ID]    RETURNS [logFile: File.File];  Verifier: PROCEDURE [    volume: Volume.ID, checkOnly: BOOLEAN,    optionalLogFile: File.File ¬ File.nullFile]     RETURNS [logFile: File.File];      END.--LOGJune 17, 1980  10:06 AM		AWL         Create fileJuly 13, 1980  9:08 PM		FXH       Add error: to ERROR declarationSeptember 2, 1980  4:58 PM	AWL         Make all records be Machine Dependent and use explicit word numbers within   those recordsOctober 10, 1980  6:30 PM	AWL         SIZE[] => #January 28, 1981  12:39 PM	PXM       Add diskHardwareError, diskNotReady to ErrorType8-Nov-81 19:14:46		AWL         Added makeFileList and ReplaceBadPage.  Add error returns values to   ReadBadPage and RewritePage.8-Dec-81 17:18:57		AWL         Added writeErrors result to ReplaceBadPage.24-Nov-82  8:52:48		AWL         Added tScavengerLog and tScavengerLogOtherVolume.  Added RepairType and used in Scavenge.  Added EntryType and used in Problem.  Added sortKey to FileEntry.  Redid Header completely.  Use File.File where appropriate.27-Nov-82 14:09:20		AWL         Added needsRiskyRepair to ErrorType.17-Dec-82 17:45:00		JXP      Added bootFilesDeleted to Header definition. Added supporting Types   BootFileType and DeletedBootFileArray, as well as the constant noneDeleted.27-Jun-83  9:24:17		AWL         Added okayToConvert argument to Scavenge, needsConversion to ErrorType. 7-Aug-86  9:50:12              RSV   Modified for labelessness. 2-Sep-86 14:19:51              RSV   Added GetLog, DeleteLog, and changed EntryType to just include dataLost.25-Sep-86 16:23:24		RRR   Cleared out unnecessary comments and changed GetLog, ClearLog, and Verifier   to reflect the actual implementing code.27-Jan-87 10:15:01              RSV   Added MakeFileList procedure and Header.logEntries.  Deleted ErrorType.noSuchPage 8-May-87 16:37:40		RRR   Added call to CompactDisk.11-May-87 15:24:32              RSV   Changed currentLogVersion to 2.   