{File name:  Bank2Misc.mcDescription: Miscellaneous Bank2 opcodes,Author: JPM,Created: December 5, 1990Last Revised:JPM, 5-Dec-90 16:11:41	Created from Bank1Misc.mc}{ 	Copyright (C) 1990 by Xerox Corporation.  All rights reserved.}{Macro for causing an ESC code trap}MacroDef[UnimplBank2ESCRange,(ESCStd, CANCELBR[Bank2ESCOpcodeTrap,0F], c3, at[1#1])];Bank2ESCx:	Xbus ¬ TT LRot0, XDisp, push, DISP4[Bank2ESCHi],	c2, at[addrBankESCx];{emulator codes -- always in bank 0 or 1}Bank2ESCHi:	UnimplBank2ESCRange[0];	UnimplBank2ESCRange[1];	UnimplBank2ESCRange[2];	UnimplBank2ESCRange[3];	UnimplBank2ESCRange[7];	UnimplBank2ESCRange[9];{floating point}	UnimplBank2ESCRange[4];	UnimplBank2ESCRange[5];	UnimplBank2ESCRange[E];{Cedar}	UnimplBank2ESCRange[6]; {available in this bank}{BandBLT}	Bank2ESCDisp[8]; {only BANDBLT is in this bank}{image processing}	UnimplBank2ESCRange[A];{RES support}	UnimplBank2ESCRange[B];{unassigned}	UnimplBank2ESCRange[C]; {available in this bank}	UnimplBank2ESCRange[D]; {available in this bank}	UnimplBank2ESCRange[F];Bank2ESCOpcodeTrap:	PC ¬ PC - 1, Bank ¬ r0100, {= bank0 in low 4 bits}	c1, at[Bank2ESCOpcodeTrap];Bank2ESCb:	T ¬ TT + 0FF + 1, GOTOBANK0[ESCc],			c2, at[Bank2ESCb];{paths back to bank 0}{Bank2Fault: go to fault handler}{Parameters:	T contains fault type (qPageFault or qWriteProtect)	faulted address already stored in [uFaultParm1, uFaultParm0]}Bank2Fault:	PC ¬ PC - 1, Bank ¬ r0100 {= bank0 in low 4 bits}, push, c3, at[Bank2Fault];Bank2Faultc1:	Rx ¬ pFault, STK ¬ TOS, pop, GOTOBANK0[SaveRegs],	c1, at[Bank2Faultc1];{Bank2Interrupt: go to interrupt handler}Bank2Interrupt:	Bank ¬ bank0,						c1, at[Bank2Interrupt];Bank2Intc2:	PC ¬ PC - 1, GOTOBANK0[RefillInt],			c2, at[Bank2Intc2];{Bank2NxtInstc1: dispatch on next opcode}Bank2NxtInstc1:	Bank ¬ bank0,						c1, at[Bank2NxtInstc1];Bank2NxtInstc2:	IBDisp, GOTOBANK0[DISPNIonly],				c2, at[Bank2NxtInstc2];