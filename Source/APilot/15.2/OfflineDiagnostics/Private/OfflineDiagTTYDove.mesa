-- File: OfflineDiagTTYDove.mesa -- Last edited on  11-Mar-87 12:10:57 by KXW--  -- Copyright (C) 1984, 1985, 1986, 1987 by Xerox Corporation. All rights reserved.---- This interface module provides access to OfflineDiagTTYImplDove. This is-- a stripped down version of the original DiagSimpleTTY. Only the essential-- items are provided to save space.--DIRECTORY  UserTerminal	USING [CursorArray],  KeyStations	USING [DownUp, KeyStation];OfflineDiagTTYDove: DEFINITIONS =  BEGIN    -- There are 3 possible screen sizes: 15", 17" and 19". The following are    -- upper limits, ie maximum dimemsions, for the largest screen size (19").    --    maxNumOfCharsPerLine: CARDINAL = 144;  -- pixelsPerLine/font.maxWidth.    maxLines: CARDINAL = 71;  -- screenHeight/fontHeight (Gacha12Strike).        -- Ranges for character positions and line numbers.    --    xRange: TYPE = [0..maxNumOfCharsPerLine);   -- Possible character positions.     yRange: TYPE = [0..maxLines);   -- Possible line numbers.    -- Actual limits exported by the implementation module.    --    rightEdge: READONLY CARDINAL;  --  Character positions on a line.    bottomLine: READONLY CARDINAL; -- Number of lines on screen.    charHeight: READONLY CARDINAL;  -- This is the character height in bits.    bitsPerTextLine: READONLY CARDINAL;  -- Number of bits per text line.    OutOfRange: ERROR;  -- Out of display limitation.    -- Current character position and line number exported by implementation     --                                                                module.    charPos: READONLY CARDINAL;      -- [0..rightEdge)    currentLine: READONLY CARDINAL;  -- [0..maxLines)        -- Keyboard information    --    oldKeys: READONLY LONG POINTER TO PACKED ARRAY KeyStations.KeyStation    	     OF KeyStations.DownUp;    newKeys: READONLY LONG POINTER TO PACKED ARRAY KeyStations.KeyStation    	     OF KeyStations.DownUp;          -- KeyDescriptor:    --    -- This is used for Keyboard diagnostics. Each key on the keyboard is    -- described by a KeyDescriptor.    --    KeyDescriptor: TYPE = RECORD [  	x: CARDINAL, -- [0..UserTerminal.screenWidth) = Position on a raster  	y: CARDINAL ¬ 0, -- [0..UserTerminal.screenHeight) = raster line number	width: CARDINAL ¬ 0, -- [0..UserTerminal.screenWidth)	height: CARDINAL ¬ 0]; -- [0..UserTerminal.screenHeight)        -- diagKeyBoard    --    -- Language-independent pointer to a particular keyboard implementation,    -- described in KDMMsgesAndKBDsImplDove.mesa     --    diagKeyBoard: READONLY POINTER TO ARRAY KeyStations.KeyStation     				         OF KeyDescriptor;        -- DiagPutText:    --    --   xCoordinate = Horizontal position of character starting from 0. Unit of    --		       measure is font.maxWidth.     --   yCoordinate = Line number on bitmapped screen starting from 0. Unit of    --		       measure is fontHeight (Gacha12Strike).    --   text is pointer to an arbitrarily long/short text to be printed.    --                 NIL pointer => No text to print. Just position the cursor.    --   DiagPutText[] non-destructively homes cursor.    --    DiagPutText: PROC[xCoordinate: xRange ¬ 0, yCoordinate: yRange ¬ 0,                       text: LONG STRING ¬ NIL];		                    -- PutObject    --    --   Put an UserTerminal.CursorArray object (16X16 pixels) on the display    --   at location (x,y). x is the pixel position on a scanline; y is the    --   scanline on the screen.    --    PutObject: PROCEDURE [x, y: CARDINAL,    		      object: LONG POINTER TO UserTerminal.CursorArray];        -- SetTTYMode and TTYMode:    --    --   The OfflineDiagTTY has three modes of operation. abnormalMode and    --   kbdDiagnostic are used exclusively by Mouse, Dispaly and Keyboard    --   diagnostics. All other clients should use the normal mode, which is the    --   default mode set by the OfflineDiagnosticControlModule.    --    TTYMode: TYPE = {normal, abnormalMode, kbdDiagnostic};    SetTTYMode: PROC [mode: TTYMode ¬ normal];            -- FillScreenWithObject:    --    --	 Paint the display with objects made up of arrays of 16 words    --    FillScreenWithObject: PROCEDURE [object: LONG POINTER TO     					     UserTerminal.CursorArray];        -- DrawALine:    --    --   Draws a horizontal line of arbitrary length and thickness on the screen.    --	 Ink is either black (all 1's) or white (all 0's).    --    DrawALine: PROCEDURE [x, y, thickness, lineLength, ink: CARDINAL];			             -- FillRectangle:     --    --	1) A key is represented by a rectangle with the dimensions as specified    --     in its KeyDescriptor.    --	2) "key" is a bit position in the keyboard bit map in the IOREGION.    --	3) "paint" is a CARDINAL of all 1's or all 0's.    --  4) When a key is down, it is painted black.    --  5) When a key is up, it is painted white.    --    FillRectangle: PROCEDURE [key: KeyStations.KeyStation, paint: CARDINAL];    			      -- DrawKBDLine: For the exclusive use of Display diagnostics.    --    --   This procedure is specifically designed for drawing the keyboard     --   outlines in the Data Area of the display.     --    --		horizontal = TRUE => Horizontal line (Top and bottom edges)    --		horizontal = FALSE => Vertical line (Left and right edges)    --    DrawKBDLine: PROCEDURE [x, yRelMiddle, lineLength, ink: CARDINAL,    			    horizontal: BOOLEAN];			            END...  OfflineDiagTTYDove  LOG19-Jan-85: Creation by KL18-Feb-85: Deleted Inline PROC's24-Jan-86: Moved KeyDescriptor and diagKeyBoard here from KDMMsgesAndKBDsDove11-Mar-87 12:11:02: Added ERROR OutOfRange. 