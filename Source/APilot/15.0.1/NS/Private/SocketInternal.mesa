-- File: SocketInternal.mesa - last edit:-- SMA                 22-May-86 11:31:24-- AOF                 18-Dec-85 15:55:29-- Copyright (C) 1984, 1985, 1986 by Xerox Corporation. All rights reserved. DIRECTORY  NSBuffer USING [AccessHandle, Buffer, Queue, QueueObject],  NSTypes USING [PacketType],  Socket USING [ChannelHandle, WaitTime],  System USING [NetworkAddress, SocketNumber];SocketInternal: DEFINITIONS =  BEGIN  SocketHandle: TYPE = LONG POINTER TO SocketObject;  SocketObject: TYPE = RECORD [    next: SocketHandle, -- used only by the router    pool: NSBuffer.AccessHandle,  --accounting pool behind channel    address: System.NetworkAddress,  --receiving channel (local.local.socket)    packetType: NSTypes.PacketType,  --additional filtering by socket?    checksums: BOOLEAN,  --does this socket want software checksums?    flair: SELECT type: * FROM      normal => [        queue: NSBuffer.QueueObject,  --to queue inputs        aborted: BOOLEAN ¬ FALSE,  --is socket being deleted?	waitTime: Socket.WaitTime,  --set by client or defaulted	newUserInput: CONDITION, getsOutstanding: CARDINAL ¬ 0],      listen => [        queue: NSBuffer.Queue,  --common queue for all listeners        callout: ListenerProcType,  --gets called when packet arrives	arrival: LONG POINTER TO CONDITION,  --this is who get notified	clientData: LONG POINTER],  --client association data      ENDCASE];  socketTable: <<RouterImpl>> SocketTable;  SocketTable: TYPE = RECORD [length: CARDINAL, first: SocketHandle];  CreateListen: PROC[    socket: System.SocketNumber,  --will be used as source address when sending    callback: ListenerProcType,  --call me when one arrives    clientData: LONG POINTER,  --client association    send: CARDINAL ¬ 0,  --listen only that wants to send??    receive: CARDINAL ¬ 2, --limits how many input buffers may be queued    type: NSTypes.PacketType ¬ private]  --only packets of this type    RETURNS [Socket.ChannelHandle];  ListenerProcType: TYPE = PROC[b: NSBuffer.Buffer, clientData: LONG POINTER];  TestAndSetListener: PROC[modify: INTEGER[-1..1]] RETURNS[CARDINAL];       END...-- SocketInternal.mesaLOG14-May-84 13:19:03  AOF  Post Klamath 9-Dec-85 19:05:17  AOF  Restructure listener sockets22-May-86 11:30:59  SMA  Remove dependencies on Buffer.