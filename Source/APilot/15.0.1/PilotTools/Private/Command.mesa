-- Copyright (C) 1982  by Xerox Corporation. All rights reserved. -- Command.mesa    26-Dec-84 13:01:23 by AWL      DIRECTORY  TTY USING [Handle];Command: DEFINITIONS =  BEGIN  -- TYPE definitions    Context: TYPE = LONG UNSPECIFIED ¬ nullContext;    nullContext: Context = LONG[0];  Action: TYPE = PROCEDURE [    h: TTY.Handle, context: Context ¬ nullContext];  Catch: TYPE = PROCEDURE [     h: TTY.Handle, action: Action, context: Context ¬ nullContext];  Entry: TYPE = RECORD [    command: LONG STRING, action: Action, context: Context ¬ nullContext];  Options: TYPE = LONG DESCRIPTOR FOR ARRAY OF Entry;  VariableDescriptor: TYPE = RECORD [    name: LONG STRING,    vp: SELECT type: * FROM      boolean => [p: LONG POINTER TO BOOLEAN],      cardinal => [p: LONG POINTER TO CARDINAL],      integer => [p: LONG POINTER TO INTEGER],      string => [p: LONG STRING],      longCardinal => [p: LONG POINTER TO LONG CARDINAL],      ENDCASE];  -- ERRORs  Aborted: ERROR;  -- Cause Loop to continue  Quit: ERROR;  -- Cause Loop to return  -- PUBLIC Procedures, alphabetical  Break: PROCEDURE [h: TTY.Handle, why: LONG STRING];  -- Loop with top level commands  Comment: Action;  -- Swallow characters up to end of line  Confirm: PROCEDURE [h: TTY.Handle];  -- Null or raise TTY.Rubout  InstallTopLevel: PROCEDURE [h: TTY.Handle, entry: Entry];  -- Add entry to options interpreted by RunTopLevel  Loop: PROCEDURE [h: TTY.Handle, options: Options, catch: Catch, prompt: LONG STRING];  -- Repeatedly scan for command in options until Quit signal is raised  LowerCase: PROCEDURE [char: CHARACTER] RETURNS [CHARACTER];  -- Change upper case letter to lower case, pass others unchanged  NullCatch: Catch;  -- Invoke action with null catch phrase  QuitLevel: Action;  -- Confirm, then return one level in the command hierarchy  ReadChar: PROCEDURE [h: TTY.Handle] RETURNS [c: CHARACTER];  -- Return next character of input stream, or raise TTY.Rubout if it is DEL  RemoveTopLevel: PROCEDURE [    h: TTY.Handle, p: PROCEDURE[Entry] RETURNS [remove: BOOLEAN]];  -- enumerates all top level entries for h calling p with each of the options  -- installed in that top level.  p is called with the ENTRY's in the order  -- that InstallTopLevel was called.  The entry is removed, preserving the  -- enumeration order, if p returns TRUE.  RunTopLevel: PROCEDURE [h: TTY.Handle];  -- Loop on top level with null catch and prompt    Scan: PROCEDURE [h: TTY.Handle, options: Options, catch: Catch];  -- Read characters until command in options is specified, then invoke its action  SetVariable: PROCEDURE [    h: TTY.Handle, options: LONG DESCRIPTOR FOR ARRAY OF VariableDescriptor];  -- Unimplemented; read characters until variable in options is specified, then read value and assign  UnwindCmd: Action;  -- Raises ERROR Unwind  UpperCase: PROCEDURE [char: CHARACTER] RETURNS [CHARACTER];  -- Change lower case letter to upper case, pass others unchanged  WriteBoolean: PROCEDURE [h: TTY.Handle, b: BOOLEAN];  WriteError: PROCEDURE [h: TTY.Handle, text: LONG STRING];  WriteLongDecimal: PROCEDURE [h: TTY.Handle, n: LONG UNSPECIFIED];  END.LOGSeptember 5, 1980  9:53 AM   Shozo SXY      Based on TTYCommand, Action and Catch have TTY.Handle as parameters. 2-Sep-81 13:59:02   WDK       LONGified. 16-Dec-82 16:58:21  EKN      Added LongCardinal field to VariableDescriptor26-Dec-84 13:01:20   AWL         Added Context to Action, Catch, Entry.  Added RemoveTopLevel.