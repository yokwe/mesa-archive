-- RESSupport.mesa  Last edit:--  JPM 18-Nov-87 11:08:13-- Copyright (C) Xerox Corporation 1987, All rights reserved.DIRECTORY  Environment USING [Byte],  ESCAlphaExtras2 USING [aENCODE, aGETRUNS, aPREDICT, aRIPPLEXOR],  Inline USING [DBITAND],  Mopcodes USING [zESC];RESSupport: DEFINITIONS  IMPORTS Inline =  BEGIN  -- TYPEs  IMGStreamPtr: TYPE = LONG POINTER TO IMGStream;  IMGStream: TYPE = MACHINE DEPENDENT RECORD [    handle(0): LONG POINTER,    word(2): WORD ¬ 0, -- after Encode call, data is right-justified within the word    bitPos(3): CARDINAL ¬ 0];  OffsetSize: TYPE = [5..8];  ScanLinePtr: TYPE = LONG POINTER;  Status: TYPE = MACHINE DEPENDENT {ok, soiInData, scanTooLong, illegalGin12bit};  -- Alignment (IMGStream must be on a 4-word boundary)  imgAlignment: PRIVATE CARDINAL = 4;  alignmentMask: PRIVATE LONG INTEGER = -imgAlignment; -- same as ~(imgAlignment - 1)  IMGSpace: TYPE = PRIVATE ARRAY [1..SIZE[IMGStream] + imgAlignment) OF UNSPECIFIED;  AlignedIMGStream: PROC [space: LONG POINTER TO IMGSpace] RETURNS [IMGStreamPtr] = INLINE    {RETURN[Inline.DBITAND[(space + imgAlignment - 1), alignmentMask]]};  -- machine code PROCs  GetRuns: PROC [dest: ScanLinePtr, source: IMGStreamPtr, wpl: CARDINAL]        RETURNS [code: Environment.Byte, status: Status] = MACHINE CODE    {Mopcodes.zESC, ESCAlphaExtras2.aGETRUNS};  Predict: PROC [source: ScanLinePtr, wpl: CARDINAL]        RETURNS [length: CARDINAL] = MACHINE CODE    {Mopcodes.zESC, ESCAlphaExtras2.aPREDICT};  Encode: PROC [source: ScanLinePtr, dest: IMGStreamPtr, wpl: CARDINAL] = MACHINE CODE    {Mopcodes.zESC, ESCAlphaExtras2.aENCODE};  RippleXOR: PROC [scanLine: ScanLinePtr, offset: OffsetSize, wpl: CARDINAL] = MACHINE CODE    {Mopcodes.zESC, ESCAlphaExtras2.aRIPPLEXOR};  -- software equivalent PROCs (for comparison)  SoftwareGetRuns: PROC [dest: ScanLinePtr, source: IMGStreamPtr, wpl: CARDINAL]        RETURNS [code: Environment.Byte, status: Status];  SoftwarePredict: PROC [source: ScanLinePtr, wpl: CARDINAL]        RETURNS [length: CARDINAL];  SoftwareEncode: PROC [source: ScanLinePtr, dest: IMGStreamPtr, wpl: CARDINAL];  SoftwareRippleXOR: PROC [scanLine: ScanLinePtr, offset: OffsetSize, wpl: CARDINAL];  END. -- of RESSupportLOG17-Sep-87 -- JPM -- Created.22-Sep-87 -- JPM -- Added (Software)RippleXOR.18-Nov-87 -- JPM -- Added comment to IMGStream (to document Encode side-effect)