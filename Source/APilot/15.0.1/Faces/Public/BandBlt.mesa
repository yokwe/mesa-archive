-- Copyright (C) 1981, 1982, 1983, 1986 by Xerox Corporation.-- All rights reserved. -- BandBLT.mesa  (Last edited by CRF on 5-Oct-86 17:03:02)DIRECTORY  BitBlt      USING [DstFunc, SrcFunc],  Environment USING [PageCount],  ESCAlpha    USING [aBANDBLT],  FixedPoint  USING [Interpolator],  Mopcodes    USING [zESC];BandBLT: DEFINITIONS =  BEGIN  bandBufferSize: Environment.PageCount = 16;  --band buffers MUST be    -- this size for bandBlt to function properly    BandBLTTablePtr: TYPE = POINTER TO BandBLTTable;  BandBLTTable: TYPE = MACHINE DEPENDENT RECORD [    readLO(0):      PageNumber,  -- input leftover-list virtual page #    bandlist(1):    LONG POINTER,            -- input bandlist    writeLO(3):     PageNumber,  -- output leftover-list virtual page #    bandbuf(4):     LONG POINTER,            -- band buffer virtual address    fontPtrTbl(6):  PageNumber,  -- Font Pointer Table virtual page #    fontRasters(7): PageNumber,  -- Font raster memory virtual page #    inkwells(8):    PageNumber]; -- inkwell(s) virtual page #  PageNumber: TYPE = CARDINAL;    BandBLT: PROC [ptr: BandBLTTablePtr] RETURNS [bandListPtr: LONG POINTER] =    MACHINE CODE {Mopcodes.zESC, ESCAlpha.aBANDBLT};  SoftwareBandBLT: PROC [ptr: BandBLTTablePtr]    RETURNS [bandListPtr: LONG POINTER];  -- calls Mesa implementation  BandBLTTableAlignment: CARDINAL = 16;  BBTableSpace: TYPE = ARRAY [1..SIZE[BandBLTTable] + BandBLTTableAlignment) OF WORD;  AlignedBandBLTTable: PROC [ip: POINTER TO BBTableSpace]    RETURNS [b: BandBLTTablePtr] = INLINE    BEGIN    align: TYPE = MACHINE DEPENDENT RECORD [      s: [0..LAST[WORD]/BandBLTTableAlignment), z: [0..BandBLTTableAlignment)];    b ¬ LOOPHOLE[ip + BandBLTTableAlignment - 1];    LOOPHOLE[b, align].z ¬ 0;    END;  Command: TYPE = CARDINAL [0..17B];  Font: TYPE = CARDINAL [0..177B];  Interpolator: TYPE = FixedPoint.Interpolator;  -- Clients are encouraged to use bound varient constructors  -- when making these guys.  -- fields named mustBeZero are required by the the BandBLT microcode to be 0.  BlItem: TYPE = MACHINE DEPENDENT RECORD [    tag(0): SELECT OVERLAID * FROM      char => [        type(0:0..0):  [0..1] ¬ charCmd,        font(0:1..7):  Font,        cc(0:8..15):   [0..377B],        xloc(1:0..3):  [0..17B],        yloc(1:4..15): [0..7777B]],      leftOverChar => [        type(0:0..0):           [0..1] ¬ charCmd,        font(0:1..7):           Font,        cc(0:8..15):            [0..377B],        mustBeZero(1:0..3):     [0..17B] ¬ 0,        yloc(1:4..15):          [0..7777B],        alsoMustBeZero(2:0..3): [0..17B] ¬ 0,        scansToSkip(2:4..15):   [0..7777B]],      rectangle => [        type(0:0..3):         Command ¬ rectangleCmd,        yloc(0:4..15):        [0..7777B],        mustBeZero(1:0..3):   [0..17B] ¬ 0,        bitsPerScan(1:4..15): [0..7777B],        nScans(2:0..11):      [0..7777B],        xloc(2:12..15):       [0..17B]],      setLevel => [        type(0:0..3):       Command ¬ setLevelCmd,        mustBeZero(0:4..4): [0..1] ¬ 0,        pad(0:5..7):        [0..7B] ¬ 0,        levelnum(0:8..15):  [0..377B]],      setInk => [        type(0:0..3):    Command ¬ setInkCmd,        srcFunc(0:4..4): BitBlt.SrcFunc ¬ null,        dstFunc(0:5..6): BitBlt.DstFunc ¬ null,        unused(0:7..7):  BOOLEAN ¬ NULL,        inknum(0:8..15): [0..377B]],      endOfBand => [        type(0:0..3): Command ¬ endOfBandCmd, pad(0:4..15): [0..7777B] ¬ 0],      endOfPage => [        type(0:0..3): Command ¬ endOfPageCmd, pad(0:4..15): [0..7777B] ¬ 0],      rulette => [        type(0:0..3):    Command ¬ ruletteCmd,        yloc(0:4..15):   [0..7777B],        length(1:0..11): [0..7777B],        xloc(1:12..15):  [0..17B]],      trapezoid => [        type(0:0..3): 	      Command ¬ trapezoidCmd,	mustBeZero1(0:4..11): [0..377B] ¬ 0,	xloc(0:12..15):       [0..17B] ¬ 0,	mustBeZero2(1:0..3):  [0..17B] ¬ 0,	nScans(1:4..15):      [0..7777B],	yMin(2:0..63):        Interpolator,	yMax(6:0..63):        Interpolator],      nop => [type(0:0..3): Command ¬ nopCmd, pad(0:4..15): [0..7777B] ¬ 0],      ENDCASE];  BandListItemLongPointer: TYPE = MACHINE DEPENDENT RECORD [    SELECT OVERLAID * FROM    ptr =>          [ptr: LONG POINTER],    char =>         [char: LONG POINTER TO char BlItem],    leftOverChar => [leftOverChar: LONG POINTER TO leftOverChar BlItem],    rectangle =>    [rectangle: LONG POINTER TO rectangle BlItem],    setLevel =>     [setLevel: LONG POINTER TO setLevel BlItem],    setInk =>       [setInk: LONG POINTER TO setInk BlItem],    endOfBand =>    [endOfBand: LONG POINTER TO endOfBand BlItem],    endOfPage =>    [endOfPage: LONG POINTER TO endOfPage BlItem],    rulette =>      [rulette: LONG POINTER TO rulette BlItem],    trapezoid =>    [trapezoid: LONG POINTER TO trapezoid BlItem],    nop =>          [nop: LONG POINTER TO nop BlItem],    ENDCASE];  charCmd:      Command = 0;  endOfBandCmd: Command = 8;  endOfPageCmd: Command = 9;  rectangleCmd: Command = 10;  setLevelCmd:  Command = 11;  setInkCmd:    Command = 12;  ruletteCmd:   Command = 13;  trapezoidCmd: Command = 14;  nopCmd:       Command = 15;  END...LOG23-Jun-86  9:28:30	CRF	Replaced nop1 with trapezoid item type; renamed nop2 to nop item type;	added identifiers to BandBLT procedure parameters; used Command type for	commands instead of CARDINAL. 4-Sep-86 19:40:05	CRF	Add SoftwareBandBLT. 5-Oct-86 17:02:59	CRF	Removed FixedPtNum definition and changed Interpolator definition to use	FixedPoint interface instead of defining here.