-- EthernetIOFaceDove.mesa (last edited by: MxS on:  8-Mar-89 14:26:42)DIRECTORY  DoveInputOutput USING [ClientCondition, IOPCondition, NotifyMask, OpieAddress, QueueBlock, TaskContextBlock],  Environment USING [Byte],  EthernetHardFaceDove USING [ActionCommand, CommandBlock, CommandSelect, DumpStatusBlock, ReceiveBufferDescriptor, ReceiveFrameDescriptor, SCBBase, Status, SystemControlBlock];EthernetIOFaceDove: DEFINITIONS = BEGIN  OPEN DoveIO: DoveInputOutput, EthernetHardFace: EthernetHardFaceDove;  FunctionContextBlock: TYPE = MACHINE DEPENDENT RECORD [        mesaOutQueue(0): DoveIO.QueueBlock,    mesaInQueue(6): DoveIO.QueueBlock,    mesaClientStateRequest(12): MesaClientState,    scb(13): EthernetHardFace.SystemControlBlock,    etherOutWorkMask(21): DoveIO.NotifyMask,    etherInWorkMask(22): DoveIO.NotifyMask,    etherLockMask(23): WORD,    mesaInClientState(24): MesaClientState,    mesaOutClientState(25): MesaClientState,        iopEtherOutQueSemaphore(26): WORD,    mesaEtherOutQueSemaphore(27):WORD,    iopEtherInQueSemaphore(28):WORD,    mesaEtherInQueSemaphore(29): WORD,        nonMesaContext(30): NonMesaContext      ];  IOCB: TYPE = MACHINE DEPENDENT RECORD [    next(0): DoveIO.OpieAddress,    clientCondition(2): DoveIO.ClientCondition,    i586Status(5): EthernetHardFace.Status ¬ TRASH,    status(6:0..7): IOCBStatus,    op(6:8..127): SELECT type(6:8..11): IOCBType FROM      input, output => [        dontProcess(6:12..12): BOOLEAN ¬ FALSE,        unused(6:13..15): [0..0] _ 0,        address(7): DoveIO.OpieAddress,        length(9): CARDINAL, --in bytes--        count(10): CARDINAL _ TRASH --meaningful only for input--        ],      command => [        action(6:12..15): EthernetHardFace.ActionCommand,        select(7): EthernetHardFace.CommandSelect          --o  Transmit not supported in the command variant--          --o  Redefine dumpStatus.buffer to DoveIO.OpieAddress--        ],      reset, startRU => [unused(6:12..15): [0..0] ¬ 0],      ENDCASE    ];  IOCBSizeCheck: BOOLEAN [TRUE..TRUE] = (SIZE[IOCB]<=16);    IOCBStatus: TYPE = MACHINE DEPENDENT RECORD [    done(0:0..0): BOOLEAN,    handled(0:1..1): BOOLEAN,    okay(0:2..2): BOOLEAN ¬ TRASH,    frameTooLong(0:3..3): BOOLEAN ¬ TRASH,    interruptTimeout(0:4..4): BOOLEAN ¬ TRASH,    unused(0:5..6): [0..4) ¬ 0,    isDequeued(0:7..7): BOOLEAN ¬ FALSE    ];  IOCBType: TYPE = MACHINE DEPENDENT {    command(0), output(1), reset(2), startRU(3), input(15)};  LocalAreaNetworkType: TYPE = MACHINE DEPENDENT {    ethernetB0(0), ethernetB2, disabledOption(255)};    MesaClientState: TYPE = MACHINE DEPENDENT {off(0), on(1), (LAST[CARDINAL])};  NonMesaContext: TYPE = MACHINE DEPENDENT RECORD [    iopOutQueue(0): DoveIO.QueueBlock,    iopInQueue(6): DoveIO.QueueBlock,    bindweedInQueue(12): DoveIO.QueueBlock,    etherCmdAvail(18): DoveIO.IOPCondition,    inBufferAvail(19): DoveIO.IOPCondition,    tbdCount(20:0..7): [0..256),    rfdCount(20:8..15): [0..256),    rbdCount(21:0..7): [0..256),    unused(21:8..15): [0..256),    rbLength(22): CARDINAL,    ethernetTask(23): DoveIO.TaskContextBlock,    etherCNATask(32): DoveIO.TaskContextBlock,    bufferCopyTask(41): DoveIO.TaskContextBlock,    bufferCopyWork(50): DoveIO.IOPCondition,    endRDL(51): EthernetHardFace.SCBBase RELATIVE POINTER TO      EthernetHardFace.ReceiveFrameDescriptor,    beginFBL(52): EthernetHardFace.SCBBase RELATIVE POINTER TO      EthernetHardFace.ReceiveFrameDescriptor,    endFBL(53): EthernetHardFace.SCBBase RELATIVE POINTER TO      EthernetHardFace.ReceiveFrameDescriptor,    clientBufLength(54): CARDINAL,    clientBufPtr(55): DoveIO.OpieAddress,    clientIOCBStatus(57): EthernetHardFace.Status,    rbdToProcess(58): EthernetHardFace.SCBBase RELATIVE POINTER TO      EthernetHardFace.ReceiveBufferDescriptor,    cb(59): EthernetHardFace.CommandBlock,    i586Dump(69): EthernetHardFace.DumpStatusBlock,    debugInfo(154): CARDINAL,    localAreaNetworkType(155:0..7): LocalAreaNetworkType,    handlerVersionNumber(155:8..15): [0..256),    unusedA(156): ARRAY [0..4) OF CARDINAL,      descriptorArea(160): ARRAY [0..0) OF WORD  <<tbd: ARRAY [0..fcb.tbdCount) OF EthernetHardFace.TransmitBufferDescriptor,    rfd: ARRAY [0..fcb.rfdCount) OF EthernetHardFace.ReceiveFrameDescriptor,    rbd: ARRAY [0..fcb.rbdCount) OF EthernetHardFace.ReceiveBufferDescriptor,    rb: ARRAY [0..fcb.rbdCount) OF      PACKED ARRAY [0..fcb.rbLength) OF Environment.Byte>>      ];  END.LOG 3-Apr-85 18:18:54	BKI   	Convert to Opie 1929-Jul-85 11:25:56	JPM	Opie redesign conversion31-Jul-85 11:11:56	JPM	Move work-notify conditions near top of FCB11-Aug-85 18:41:51	BKI	Make compatible with IOREther.asm of 11-Aug-85 18:23:51 PDT14-Aug-85 12:45:18	JPM	Correct positions in NonMesaContext record19-Aug-85 19:49:11	BKI	Add interruptTimeout to IOCBStatus25-Sep-85 17:24:13	BKI	Change unused field to localAreaNetworkType and handlerVersionNumber.				Add dontProcess field to output iocb. 8-Mar-89 14:26:59	MxS	added some 