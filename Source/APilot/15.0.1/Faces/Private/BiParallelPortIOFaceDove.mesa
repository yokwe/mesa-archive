--File = BiParallelPortIOFaceDove.mesa-- Created by JMA on 27-May-86 16:55:53-- last edited 27-Feb-87 18:31:17 JMA-- Copyright (C) 1986, 1987 by Xerox Corporation. All rights reserved.<< ***************************************************************************Description:BiParallelPortIOFaceDove contains the IORegion (IOPage equivalent on the Dlion)   which is a region of memory that is permanently mapped into contiguous Real   Memory. This IORegion houses the well defined structures in shared memory   and allows communication between Mesa's BiParallelPort Head and the IOP's    BiParallel Port Handler software.  This Mesa interface is for the   Laser Printing Option (LPO) and Scanner Printing Option (SPO),   collectively referred to here as BiParallel Port Option (PPO) of Dove***************************************************************************** >>DIRECTORY  DoveInputOutput USING [Byte, ByteSwappedWord, ClientCondition,	IOPCondition, IOPShortBoolean, NotifyMask,	OpieAddress, QueueBlock, TaskContextBlock];BiParallelPortIOFaceDove: DEFINITIONS  IMPORTS DoveInputOutput =  BEGIN---------------------------------------------------------------------   I/O CONTEXT BLOCK(IOCB)  DEFINITION  FOR  PARALLEL PORT     ---------------------------------------------------------------------IOContextBlock: TYPE =  MACHINE DEPENDENT RECORD [  ppfaceLONGPOINTER:	LONG POINTER,				-- SIZE [BiParallelPortFace.Operation]  ppfaceCARDINAL:	CARDINAL,				--   total of 3 words    nextIOCB:		DoveInputOutput.OpieAddress,  specialTransfer:	DoveInputOutput.IOPShortBoolean,	--  indicates a special transfer  currentOpStatus:	TransferStatus,    iocbCnfgRegrVal:	ConfigRegrRec,  iocbCmdRegrVal:	CommandRegrRec,    dma1CntrlWrdVal:	DoveInputOutput.ByteSwappedWord,  dma1TransferCount: 	DoveInputOutput.ByteSwappedWord,  dma1MemSrcOrDst: 	DoveInputOutput.OpieAddress,  transferDataSize:	DoveInputOutput.ByteSwappedWord,	-- transfer data size in bytes  bytesTransferred:	DoveInputOutput.ByteSwappedWord,	-- successful # of bytes transferred    iocbSpareByte0:	DoveInputOutput.Byte,  iocbSpareByte1:	DoveInputOutput.Byte,    iocbSpareWord0:	DoveInputOutput.ByteSwappedWord,	-- for debug only  iocbSpareWord1:	DoveInputOutput.ByteSwappedWord  ];---------------------------------------------------------------------   DEVICE CONTEXT BLOCK(DCB)   DEFINITION  FOR  PARALLEL PORT  ---------------------------------------------------------------------DeviceContextBlock: TYPE = MACHINE DEPENDENT RECORD [  commandList:		CommandListRec,  transferQue:		DoveInputOutput.QueueBlock,	-- queue head, next, and tail  cnfgRegrVal:		ConfigRegrRec,			-- config regr value used   cmdRegrVal:		CommandRegrRec,			-- command regr value used  portStatus:		PortStatusRec,			-- port status  dcbLocation:		WORD,				-- dcb location in IOR (i186 terms)  intrpCnt:		DoveInputOutput.Byte,		-- intrp count  requestQueCleanup:	DoveInputOutput.IOPShortBoolean,-- handler-to-head request for cleanup  dcbSpareByte0:	DoveInputOutput.Byte,		-- spare byte  dcbSpareByte1:	DoveInputOutput.Byte		-- spare byte  ];  ---------------------------------------------------------------------   FUNCTION CONTEXT BLOCK(FCB)  DEFINITION  FOR  PARALLEL PORT ---------------------------------------------------------------------FunctionContextBlock: TYPE =  MACHINE DEPENDENT RECORD [  ppoIntrpTaskTcb:	DoveInputOutput.TaskContextBlock,  ppoInServiceTaskTcb:	DoveInputOutput.TaskContextBlock,  ppoMainTaskTcb:	DoveInputOutput.TaskContextBlock,  ppoClientCondition:	DoveInputOutput.ClientCondition,  ppoWorkFromClientCond:DoveInputOutput.IOPCondition,  ppoInServiceWorkCond:	DoveInputOutput.IOPCondition,  ppoAttentionCond:	DoveInputOutput.IOPCondition,  ppoEndOfScanCond:	DoveInputOutput.IOPCondition,  ppoWorkFromClientMask:DoveInputOutput.NotifyMask,  ppoLockMask:		WORD,  ppoIntrpMask:		WORD,  ppoInterrupt:		WORD,  ppoIntrpSelectRegrVal: WORD,  ppoEEPROMInfo:	DoveInputOutput.ByteSwappedWord, -- PPOptionType information  ppoSpareWord:		WORD,    ppoDiagTestPattern:	DoveInputOutput.ByteSwappedWord,  ppoDiagReturnPattern:	DoveInputOutput.ByteSwappedWord,    currentDCBPtr:	WORD,			-- points to the DCB in control  ppoDCBPtr:		WORD,			  ppoBoardStatus:	BoardStatusRec,  ppoHandlerStatus:	HandlerStatusRec,  ppoCnfgRegrImage:	ConfigRegrRec,  ppoCmdRegrImage:	CommandRegrRec,  --  DEVICE CONTEXT BLOCK (DCB)							  port0DCB:		DeviceContextBlock,	-- Context block for BiParallel Port0  port1DCB:		DeviceContextBlock,	-- Context block for BiParallel Port1    						--** all locations below are for debug only **  badPPOIntrpCnt:	DoveInputOutput.Byte,  badPPODMA1IntrpCnt:	DoveInputOutput.Byte,  ppoDebugByte0:	DoveInputOutput.Byte,  ppoDebugByte1:	DoveInputOutput.Byte,  ppoDebugWord0:	DoveInputOutput.ByteSwappedWord   ];	   ---------------------------------------------------------------------- ConstantsDMACntrlWrdByteOut:  WORD = 1786H;DMACntrlWrdBlockOut: WORD = 1787H;   << DMA Channel 1 set up:   	* Word or Byte transfer, depending if block or byte transfer	* Start bit enabled	* Allow Change start/stop 	* DMA request from Timer2 disabled	* Low priority with respect to DMA channel 0	* Destination synchronization	* Interrupt of CPU on transfer count = 0	* Stop DMA1 on transfer count = 0	* Source is memory	* Increment source pointer	* Destination is IO space	* Do not increment or decrement destination pointer  >>	DMACntrlWrdByteIn: WORD = 0A346H;DMACntrlWrdBlockIn: WORD = 0A347H;DMACntrlWrdByteInNoIntrp: WORD = 0A246H;-- mask valueLPOPROMError: WORD = 00F0;PPOPROMError: DoveInputOutput.Byte = 0070H;-- TYPES AND TYPE DEFS   << Notes On Byte Swapping:  BiParallelPortHeadDove performs a minimum of byte   	swapping.  Only word quantities are byte swapped.  Machine Independent	records HAVE BEEN properly ordered, in this IO Face, to match Intel format. 	No further byte swapping is required in BiParallelPortHeadDove.	** FOR REFERENCE ONLY **IntelBitFormat: TYPE = MACHINE DEPENDENT RECORD [	intelBit07: BOOLEAN,	intelBit06: BOOLEAN,	intelBit05: BOOLEAN,	intelBit04: BOOLEAN,	intelBit03: BOOLEAN,	intelBit02: BOOLEAN,	intelBit01: BOOLEAN,	intelBit00: BOOLEAN,		intelBit15: BOOLEAN,	intelBit14: BOOLEAN,	intelBit13: BOOLEAN,	intelBit12: BOOLEAN,	intelBit11: BOOLEAN,	intelBit10: BOOLEAN,	intelBit09: BOOLEAN,	intelBit08: BOOLEAN	];			>>	HandlerStatusRec: TYPE = MACHINE DEPENDENT RECORD [	unusedNibble: [0..0FH] ¬ 0,	diagInService: BOOLEAN ¬ FALSE,			-- indicates cmd in service		updateInService: BOOLEAN ¬ FALSE,	resetInService: BOOLEAN ¬ FALSE,	transferInService: BOOLEAN ¬ FALSE,	handlerError: BOOLEAN ¬ FALSE,			-- handler error detected	handlerInitialized: BOOLEAN ¬ FALSE,		-- PPO handler initialized	boardInstalled: BOOLEAN ¬ FALSE,		-- board IS installed	usingBiParallelPortOption: BOOLEAN ¬ TRUE,	-- PPO (TRUE) or LPO (FALSE)	handlerBusy: BOOLEAN ¬ FALSE,			-- handler is busy	optionBoardBusy: BOOLEAN ¬ FALSE,		-- option board busy	unusedBit9: BOOLEAN ¬ FALSE,	unusedBit8: BOOLEAN ¬ FALSE	];TransferStatus: TYPE = MACHINE DEPENDENT {		-- IOCB transfer status 	ready (0), success (1), endOfScanLine (2), inProgress (3), pending (4),	aborted (5), incomplete (6), unknown (7), (0FFH) };	CommandListRec: TYPE = MACHINE DEPENDENT RECORD [	-- word record	locked: BOOLEAN ¬ FALSE,		-- Head telling the Handler commandList is locked	unusedBit6: BOOLEAN ¬ FALSE,	unusedBit5: BOOLEAN ¬ FALSE,	unusedBit4: BOOLEAN ¬ FALSE,	diagnosticCmd: BOOLEAN ¬ FALSE,			-- used for LPO/PPO diagnostic	updateStatusCmd: BOOLEAN ¬ FALSE,	transferCmd: BOOLEAN ¬ FALSE,	resetCmd: BOOLEAN ¬ FALSE,		commandPending: DoveInputOutput.IOPShortBoolean ¬ False	];	ConfigRegrRec: TYPE = MACHINE DEPENDENT RECORD [	-- word record	ppoDMAEnable: BOOLEAN ¬ TRUE,	enableIntrp: BOOLEAN ¬ TRUE,	maintMode: BOOLEAN ¬ FALSE,	useAck: BOOLEAN ¬ FALSE,	clockCounter: [0..0FH) ¬ 8H, 	     		-- strobe rate set to 1uS		usePort1: BOOLEAN ¬ FALSE,			-- selects port0 or port1 	doScan: BOOLEAN ¬ FALSE,			-- selects printer or scanner	unusedBit13: BOOLEAN ¬ FALSE,	unusedBit12: BOOLEAN ¬ FALSE,	unusedBit11: BOOLEAN ¬ FALSE,	byteMode: BOOLEAN ¬ FALSE,			-- forces option to fetch only 1 byte	dataIsControl: BOOLEAN ¬ FALSE,			-- selects data or control	directionIsIn: BOOLEAN ¬ FALSE			-- selects in or out	];		CommandRegrRec: TYPE = MACHINE DEPENDENT RECORD [	-- word record	deviceReset: BOOLEAN ¬ FALSE,			-- supported on PPO only	unusedBit6: BOOLEAN ¬ FALSE,	unusedBit5: BOOLEAN ¬ FALSE,	unusedBit4: BOOLEAN ¬ FALSE,	ppoGo: BOOLEAN ¬ TRUE,			       	-- enable PPO board operations	enforce20uSecRule: BOOLEAN ¬ FALSE,		-- enforce 20uS rule (LPO only)	ppoNotClearIntrp: BOOLEAN ¬ TRUE,		-- toggle clear intrp bit	ppoNotReset: BOOLEAN ¬ TRUE,			-- toggle reset bit	unusedByte: [0..0FFH] ¬ 0 ];-- This register reflects signals from PPO Port0 or Port1-- Each bit interpretation depends on its current port designation (printer/scanner) 	PortStatusRec: TYPE = MACHINE DEPENDENT RECORD [	-- word record   SELECT OVERLAID * FROM               printer => [		prntrStatBit7:  BOOLEAN,		prntrStatBit6:  BOOLEAN,		prntrStatBit5:  BOOLEAN,		prntrStatBit4:  BOOLEAN,		prntrAck:	BOOLEAN,		prntrBusy:	BOOLEAN,		select:		BOOLEAN,		prntrFault:	BOOLEAN,			prntrBoardNotInstalled: BOOLEAN,	-- if clear, guaranteed installed		prntrPin36Signal: BOOLEAN,		prntrPin34Signal: BOOLEAN,		prntrPin33Signal: BOOLEAN,		prntrPin31Signal: BOOLEAN,		plus5VDC:	  BOOLEAN,		-- not supported by 4045		prntrPin15Signal: BOOLEAN,		printerEmpty:BOOLEAN ],			-- not supported by 4045		       scanner => [       		portNumberEcho:  BOOLEAN,		printScanEcho: 	 BOOLEAN,		scnrNotConnected:BOOLEAN,		portReady:	 BOOLEAN,		scnerAck: 	 BOOLEAN,		scnrBusy:	 BOOLEAN,		notScanLineSyncBuf:BOOLEAN,		scnrFault: 	 BOOLEAN,			scnrBoardNotInstalled:	BOOLEAN,	-- if clear, guaranteed installed		dataControlEcho: BOOLEAN,		scnrPin34Signal: BOOLEAN,		signalIsOut:	 BOOLEAN,		scnrResetEcho:   BOOLEAN,		scnrOn:	 	 BOOLEAN,		scnrPin15Signal: BOOLEAN,		-- scanner is powered-on		attention:	 BOOLEAN ],		-- scanner needs attention					ENDCASE];-- This register indicates the PPO board status; client is only interested on the state IDBoardStatusRec: TYPE = MACHINE DEPENDENT RECORD [	-- word record	stateID3: BOOLEAN,				-- stateID of FF indicates PROM error	stateID2: BOOLEAN,					stateID1: BOOLEAN,					stateID0: BOOLEAN,					sendIntrp: BOOLEAN,				-- intrp has been generated by LPO/SPO	highByteValid: BOOLEAN,				-- valid hi byte strobed by LPO/SPO	dataRegrEmpty: BOOLEAN,	ppoDMARequest: BOOLEAN,				-- board is ready for a DMA transfer		unusedBit15: BOOLEAN,	unusedBit14: BOOLEAN,	promErrorDetected: BOOLEAN,			-- indicates PPO PROM Error	bitIsNotZero: BOOLEAN,				-- bit is always zero if option installed	bitIsOne: BOOLEAN,				-- bit is always one if option installed	stateMachineReady: BOOLEAN,	SMAState2: BOOLEAN,	SMAState1: BOOLEAN	];	END...-- BiParallelPortIOFaceDove.mesaLOG27-May-86 16:55:53	JMA	Created27-Feb-87 18:31:55	JMA	Changed	Parallel to BiParallel	