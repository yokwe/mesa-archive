--File = ParallelPortIOFaceDove.mesa-- Copyright (C) 1985 by Xerox Corporation. All rights reserved.-- Created by JMA on 11-Sep-85 17:13:34	-- last edited by:-- JMA		 9-Dec-85 15:26:28	:more bit rearrangements--*****************************************************************************-- Description:--ParallelPortIOFaceDove contains the IORegion (IOPage equivalent on the Dlion)--   which is a region of memory that is permanently mapped into contiguous Real--   Memory. This IORegion houses the well defined structures in shared memory--   and allows communication between Mesa's ParallelPort Head and the IOP's --   Parallel Port Handler software.  This Mesa interface is for the Printer--   Scanner Option (PSO) of Dove --*****************************************************************************DIRECTORYDoveInputOutput USING [Byte, ByteSwappedWord, ClientCondition, IOPCondition,	IOPShortBoolean, NotifyMask, OpieAddress, TaskContextBlock ];ParallelPortIOFaceDove: DEFINITIONS =BEGIN---------------------------------------------------------------------   FUNCTION  CONTEXT  BLOCK  DEFINITION  FOR  PARALLEL PORT    ---------------------------------------------------------------------FunctionContextBlock: TYPE =  MACHINE DEPENDENT RECORD [  psoMainTaskTcb:	DoveInputOutput.TaskContextBlock,  psoIntrpTaskTcb:	DoveInputOutput.TaskContextBlock,  dma1IntrpTaskTcb:	DoveInputOutput.TaskContextBlock,  psoClientCondition:	DoveInputOutput.ClientCondition,  psoWorkCondition:	DoveInputOutput.IOPCondition,  psoLockMask:		WORD,  psoWorkMask:		DoveInputOutput.NotifyMask,    dma1CntrlWrdVal:	DoveInputOutput.ByteSwappedWord,  psoDMATransferCount: 	DoveInputOutput.ByteSwappedWord,	-- in WORDS  psoDMASourcePtr: 	DoveInputOutput.OpieAddress,		-- 2 WORDS  psoCmdRegrVal:	PSOCommandRegrRec,  psoConfigRegrVal:	PSOConfigRegrRec,  psoIntrpRegrVal:	DoveInputOutput.ByteSwappedWord,  psoCommand:		PSOCommandRec,  psoTransferConfig:	PSOTransferConfigRec,  psoPortStatus:	PSOPortStatusRec,  psoBoardStatus:	PSOBoardStatusRec,  psoCommandStatus:	PSOCommandStatusType,  			--  byte size    psoConfigRegrImage:	PSOConfigRegrRec,  psoCmdRegrImage:	PSOCommandRegrRec,			--  copy of command regr value    psoByteIO:		DoveInputOutput.ByteSwappedWord,    psoEEPROMImage:	DoveInputOutput.ByteSwappedWord,    psoDiagTestPattern:	DoveInputOutput.ByteSwappedWord,  psoDiagReturnPattern:	DoveInputOutput.ByteSwappedWord,  --** all locations below are for debug only **  psoIntrpCnt:		DoveInputOutput.Byte,			   badPSOIntrpCnt:	DoveInputOutput.Byte,  badDMA1IntrpCnt:	DoveInputOutput.Byte,  debugByte0:		DoveInputOutput.Byte,  debugWord0:		DoveInputOutput.ByteSwappedWord,  debugWord1:		DoveInputOutput.ByteSwappedWord   ];	   ---------------------------------------------------------------------- ConstantsDMACntrlWrdByteOut:  WORD = 1786H;DMACntrlWrdBlockOut: WORD = 1787H;   << DMA Channel 1 set up:   	* Word or Byte transfer, depending if block or byte transfer	* Start bit enabled	* Allow Change start/stop 	* DMA request from Timer2 disabled	* Low priority with respect to DMA channel 0	* Destination synchronization	* Interrupt of CPU on transfer count = 0	* Stop DMA2 on transfer count = 0	* Source is memory	* Increment source pointer	* Destination is IO space	* Do not increment or decrement destination pointer  >>PROMError: DoveInputOutput.Byte = 0FFH;		-- PROM state ID indicating PROM error-- TYPES AND TYPE DEFS   << Notes On Byte Swapping:  ParallelPortHeadDove performs a minimum of byte   	swapping.  Only word quantities are byte swapped.  Machine Independent	records HAVE BEEN properly ordered, in this IO Face, to match Intel format. 	No further byte swapping is required in ParallelPortHeadDove.	>>PSOTransferMode: TYPE = MACHINE DEPENDENT {	outputBlock(0), outputByte(1), inputByte(2), inputBlock(3),	unusud(0FFH) };PSOCommandStatusType: TYPE = MACHINE DEPENDENT {		-- transfer status to the Head	notReady(0), ready(1), inProgress(2), incomplete(3), exceptional(4), unused(0FFFFH) };PSOCommandRec: TYPE = MACHINE DEPENDENT RECORD [		-- word record	unusedNibble: [0..0FH] _ 0,	diagnosticCmd: BOOLEAN _ FALSE,	transferCmd: BOOLEAN _ FALSE,	resetCmd: BOOLEAN _ FALSE,	updateStatusCmd: BOOLEAN _ FALSE,	commandPending: DoveInputOutput.IOPShortBoolean _ False ];PSOConfigRegrRec: TYPE = MACHINE DEPENDENT RECORD [		-- word record	psoDMAEnable: BOOLEAN _ TRUE,	enableIntrp: BOOLEAN _ TRUE,	maintMode: BOOLEAN _ FALSE,	useAck: BOOLEAN _ FALSE,	clockCounter: [0..0FH) _ 0, 	     			-- clock counter for 1uS 	useScanPort: BOOLEAN _ FALSE,				-- selects printer or scanner 	doScan: BOOLEAN _ FALSE,				-- selects printer or scanner	unused0: BOOLEAN _ FALSE,	unused1: BOOLEAN _ FALSE,	unusedNibble: [0..0FH] _ 0 ];				-- counter for 1uS clock		PSOCommandRegrRec: TYPE = MACHINE DEPENDENT RECORD [		-- word record	unused0: BOOLEAN _ FALSE,	unused1: BOOLEAN _ FALSE,	unused2: BOOLEAN _ FALSE,	unused3: BOOLEAN _ FALSE,	psoGo: BOOLEAN _ TRUE,			       		-- enable PSO board operations	enforce20uSecRule: BOOLEAN _ TRUE,			-- enforce 20uS rule	psoNotClearIntrp: BOOLEAN _ TRUE,			-- toggle clear intrp bit	psoNotReset: BOOLEAN _ TRUE,				-- toggle reset bit	unusedByte: [0..0FFH] _ 0 ];PSOTransferConfigRec: TYPE = MACHINE DEPENDENT RECORD [		-- word record	transferMode: PSOTransferMode,	psoTransferConfigUnused: [0..0FFH] _ 0 ];-- This register reflects signals from PSO Output Port	PSOPortStatusRec: TYPE = MACHINE DEPENDENT RECORD [		-- word record	psoPortStatusBit7: BOOLEAN,	psoPortStatusBit6: BOOLEAN,	psoPortStatusBit5: BOOLEAN,	psoPortStatusBit4: BOOLEAN,	acknowledge: BOOLEAN,	busy: BOOLEAN,	select: BOOLEAN,	fault: BOOLEAN,	psoPortStatusBit15: BOOLEAN,	psoPortStatusBit14: BOOLEAN,	pin36Signal: BOOLEAN,	pin34Signal: BOOLEAN,	pin33Signal: BOOLEAN,	pin18Signal: BOOLEAN,	pin15Signal: BOOLEAN,	pin12Signal: BOOLEAN ];-- This register indicates the PSO board status; client is only interested on the state IDPSOBoardStatusRec: TYPE = MACHINE DEPENDENT RECORD [		-- word record	stateID: [0..0FH],					-- stateID of FF indicates PROM error	boardStatusUnused0: BOOLEAN,	hasHiByte: BOOLEAN,	hasLoByte: BOOLEAN,	psoDMARequest: BOOLEAN,					-- board is ready for a DMA transfer	boardStatusUnusedByte: [0..0FFH] ];	END.	-- ParallelPortIOFaceDove.mesa	