-- File: EthernetHardFaceDove.mesa - last edit:-- AOF                 24-Feb-87 20:52:48-- Copyright (C) 1987 by Xerox Corporation. All rights reserved.DIRECTORY  Environment USING [Byte],  EtherMAC USING [EthernetPacketType],  HostNumbers USING [HostNumber],  Inline USING [HighByte, LowByte];EthernetHardFaceDove: DEFINITIONS IMPORTS Inline = BEGIN  IOPRealAddress: TYPE = MACHINE DEPENDENT RECORD [    lowByte(0:0..7): Environment.Byte,    midByte(0:8..15): Environment.Byte,    highByte(1:0..7): Environment.Byte,    unused(1:8..15): [0..256) _ 0    ];  << INITIALIZATION >>  scpAddr: IOPRealAddress = [lowByte: 0F6H, midByte: 0FFH, highByte: 0FFH];  SystemConfigPtr: TYPE = MACHINE DEPENDENT RECORD [    unusedA(0:0..7): [0..256) _ 0,    sysBus(0:8..15): [0..1],    unusedB(1): LONG UNSPECIFIED _ 0,    iscp(3): IOPRealAddress    ];  IntermediateSystemConfigPtr: TYPE = MACHINE DEPENDENT RECORD [    unused(0:0..7): [0..256) _ 0,    busy(0:8..15): [0..1],    scbOffset(1): SCBBase RELATIVE POINTER TO SystemControlBlock,    scbBase(2): IOPRealAddress    ];  << SYSTEM CONTROL BLOCK >>  SCBBase: TYPE = LONG BASE POINTER;    SystemControlBlock: TYPE = MACHINE DEPENDENT RECORD [    stat(0:0..3): I82586Status,    zeroA(0:4..4): [0..2),    cus(0:5..7): CommandUnitStatus,    zeroB(0:8..8): [0..2),    rus(0:9..11): ReceiveUnitStatus,    zeroC(0:12..15): [0..16),    ack(1:0..3): AcknowledgeInt,    unusedA(1:4..4): [0..2) _ 0,    cuc(1:5..7): CommandUnitCommand,    reset(1:8..8): BOOLEAN,    ruc(1:9..11): ReceiveUnitCommand,    unusedB(1:12..15): [0..16) _ 0,    cblOffset(2): SCBBase RELATIVE POINTER TO CommandBlock,    rfaOffset(3): SCBBase RELATIVE POINTER TO ReceiveFrameDescriptor,    crcErrs(4): CARDINAL,    alnErrs(5): CARDINAL,    rscErrs(6): CARDINAL,    ovrnErrs(7): CARDINAL    ];  InterruptReason: TYPE = {cx, fr, cnr, rnr};  AcknowledgeInt: TYPE = PACKED ARRAY InterruptReason OF BOOLEAN;  CommandUnitCommand: TYPE = MACHINE DEPENDENT {    nop(0), start(1), resume(2), suspend(3), abort(4), (7)};  CommandUnitStatus: TYPE = MACHINE DEPENDENT {    idle(0), suspended(1), ready(2), (7)};  I82586Status: TYPE = PACKED ARRAY InterruptReason OF BOOLEAN;  ReceiveUnitCommand: TYPE = CommandUnitCommand;  ReceiveUnitStatus: TYPE = MACHINE DEPENDENT {    idle(0), suspended(1), noResources(2), ready(4), (7)};  << DESCRIPTORS >>  CommandBlock: TYPE = MACHINE DEPENDENT RECORD [    status(0): command Status,    endOfList(1:0..0): BOOLEAN,    suspend(1:1..1): BOOLEAN,    interrupt(1:2..2): BOOLEAN,    unused(1:3..12): [0..1024) _ 0,    command(1:13..15): ActionCommand,    link(2): SCBBase RELATIVE POINTER TO CommandBlock,    select(3): CommandSelect    ];    ActionCommand: TYPE = MACHINE DEPENDENT {    nop(0), individualAddr(1), configure(2), multicastAddr(3),    transmit(4), timeDomainRfl(5), dumpStatus(6), diagnose(7)};    multicastIDLimit: [0..2730] = 2;  CommandSelect: TYPE = MACHINE DEPENDENT RECORD [    command(0): SELECT COMPUTED ActionCommand FROM      nop => NULL,      individualAddr => [id(0): HostNumbers.HostNumber],      configure => [	unusedA(0:0..3): [0..16) _ 0,	byteCount(0:4..7): [0..15],	unusedB(0:8..11): [0..16) _ 0,	fifoLimit(0:12..15): [0..15] _ 8,	saveBadFrames(1:0..0): BOOLEAN _ FALSE,	syncReady(1:1..1): BOOLEAN _ FALSE,	unusedC(1:2..7): [0..64) _ 0,	externalLoopback(1:8..8): BOOLEAN _ FALSE,	internalLoopback(1:9..9): BOOLEAN _ FALSE,	preambleLength(1:10..11): {two(0), four(1), eight(2), sixteen(3)} _ eight,	addrTypeLoc(1:12..12): {desc(0), buffer(1)} _ desc,	addrLength(1:13..15): [0..7] _ 6,	expBackoffMethod(2:0..0): {ethernet(0), alternate(1)} _ ethernet,	accContRes(2:1..3): [0..7] _ 0,	unusedD(2:4..4): [0..2) _ 0,	linearPriority(2:5..7): [0..7] _ 0,	interframeSpacing(2:8..15): [0..255] _ 96,	slotTimeLow(3:0..7): [0..255] _ Inline.LowByte[512],	retryNumber(3:8..11): [0..15] _ 15,	unusedE(3:12..12): [0..2) _ 0,	slotTimeHigh(3:13..15): [0..7] _ Inline.HighByte[512],	padding(4:0..0): BOOLEAN _ FALSE,	bitstuffing(4:1..1): BOOLEAN _ FALSE,	CRC16(4:2..2): BOOLEAN _ FALSE,	noCRCInsertion(4:3..3): BOOLEAN _ FALSE,	txNoCRS(4:4..4): BOOLEAN _ FALSE,	NRZEncoding(4:5..5): BOOLEAN _ FALSE,	broadcastDisable(4:6..6): BOOLEAN _ FALSE,	promiscuousMode(4:7..7): BOOLEAN _ FALSE,	internalCDT(4:8..8): BOOLEAN _ FALSE,	CDTFilter(4:9..11): [0..7] _ 0,	internalCRS(4:12..12): BOOLEAN _ FALSE,	CRSFilter(4:13..15): [0..7] _ 0,	minFrameLength(5:0..7): [0..255] _ 64,	unusedF(5:8..15): [0..256) _ 0	],      multicastAddr => [	unused(0:0..1): [0..2) _ 0,	byteCount(0:2..15): [0..16383] _ 0 --disable multicast reception--,	multicastID(1):	  PACKED ARRAY [0..multicastIDLimit) OF HostNumbers.HostNumber	],      transmit => [	bdPtr(0): SCBBase RELATIVE POINTER TO TransmitBufferDescriptor,	destAddr(1): HostNumbers.HostNumber,	type(4): EtherMAC.EthernetPacketType	],      timeDomainRfl => [	results(0): TDRTestResults _ NULL	],      dumpStatus => [buffer(0): SCBBase RELATIVE POINTER TO DumpStatusBlock],      diagnose => NULL,      ENDCASE    ];  TransmitBufferDescriptor: TYPE = MACHINE DEPENDENT RECORD [    endOfFrame(0:0..0): BOOLEAN,    unused(0:1..1): [0..2) _ 0,    actualCount(0:2..15): [0..16384),    next(1): SCBBase RELATIVE POINTER TO TransmitBufferDescriptor,    address(2): IOPRealAddress    ];    TDRTestResults: TYPE = MACHINE DEPENDENT RECORD [    linkOK(0:0..0): BOOLEAN _ NULL,    xcvrProblem(0:1..1): BOOLEAN _ NULL,    open(0:2..2): BOOLEAN _ NULL,    short(0:3..3): BOOLEAN _ NULL,    unused(0:4..4): [0..2) _ 0,    time(0:5..15): [0..2047] _ NULL    ];    dumpLength: CARDINAL = 170;  DumpStatusBlock: TYPE = PACKED ARRAY [0..dumpLength) OF Environment.Byte;  ReceiveFrameDescriptor: TYPE = MACHINE DEPENDENT RECORD [    status(0): receiveFrame Status,    endOfList(1:0..0): BOOLEAN,    suspend(1:1..1): BOOLEAN,    unused(1:2..15): [0..16384) _ 0,    link(2): SCBBase RELATIVE POINTER TO ReceiveFrameDescriptor,    bdPtr(3): SCBBase RELATIVE POINTER TO ReceiveBufferDescriptor,    destAddr(4): HostNumbers.HostNumber,    sourceAddr(7): HostNumbers.HostNumber,    type(10): EtherMAC.EthernetPacketType    ];  ReceiveBufferDescriptor: TYPE = MACHINE DEPENDENT RECORD [    endOfFrame(0:0..0): BOOLEAN,    filled(0:1..1): BOOLEAN,    actualCount(0:2..15): [0..16384),    next(1): SCBBase RELATIVE POINTER TO ReceiveBufferDescriptor,    address(2): IOPRealAddress --pointer TO ReceiveBuffer--,    endOfList(4:0..0): BOOLEAN,    unused(4:1..1): [0..2) _ 0,    size(4:2..15): [0..16384)    ];    ReceiveBuffer: TYPE = PACKED ARRAY OF Environment.Byte;  << STATUS >>  Status: TYPE = MACHINE DEPENDENT RECORD [    completion(0:0..0): BOOLEAN,    busy(0:1..1): BOOLEAN,    okay(0:2..2): BOOLEAN,    variant(0:3..15): SELECT COMPUTED * FROM      receiveFrame => [	unusedA(0:3..3): [0..2) _ 0,	crcErr(0:4..4): BOOLEAN,	alnErr(0:5..5): BOOLEAN,	rscErr(0:6..6): BOOLEAN,	ovrnErr(0:7..7): BOOLEAN,	frameTooShort(0:8..8): BOOLEAN,	noEOFFlag(0:9..9): BOOLEAN,	unusedB(0:10..15): [0..32) _ 0        ],      command => [        specific(0:3..15): SELECT COMPUTED ActionCommand FROM	  nop, timeDomainRfl, dumpStatus => [	    unused(0:3..15): [0..8192) _ 0	    ],	  individualAddr, configure, multicastAddr => [	    aborted(0:3..3): BOOLEAN,	    unused(0:4..15): [0..4096) _ 0	    ],	  transmit => [	    aborted(0:3..3): BOOLEAN,	    unusedA(0:4..4): [0..2) _ 0,	    noCRS(0:5..5): BOOLEAN,	    lossOfCTS(0:6..6): BOOLEAN,	    underrun(0:7..7): BOOLEAN,	    deferred(0:8..8): BOOLEAN,	    sqeTest(0:9..9): BOOLEAN,	    tooManyCollisions(0:10..10): BOOLEAN,	    unusedB(0:11..11): [0..2) _ 0,	    collisions(0:12..15): [0..16)	    ],	  diagnose => [	    unusedA(0:3..3): [0..2) _ 0,	    fail(0:4..4): BOOLEAN,	    unusedB(0:5..15): [0..2048) _ 0	    ],	  ENDCASE        ],      ENDCASE    ];  END.