-- File: DiagEtherEchoTest.mesa - last edit:-- MXT                 23-Jul-85 21:00:54-- Copyright (C) 1985 by Xerox Corporation. All rights reserved.-- This interface defines the Ethernet Echo Test for Offline Ethernet Diagnostic.-- Some TYPEs and PROCs are stolen from NS definitions and CommOnlineDiagnostics. This should be done to reduce the -- file size and to fit the boot file into DOVE floppy disk.DIRECTORY  OfflineDiagInterface,  System;DiagEtherEchoTest: DEFINITIONS =  BEGIN OPEN ODI: OfflineDiagInterface;  DiagEtherEchoTestPropertyImpl: PROGRAM;  DiagEtherEchoTestImpl: PROGRAM;  -- TYPEs  TestProperties: TYPE = RECORD [    domainAndOrganization: Name _ NIL,    echoSourceType: EchoSourceType _ local,    echoSource: LONG POINTER TO MachineIDRecord _ NIL,    echoDest: LONG POINTER TO MachineIDRecord _ NIL,    realTimeFeedBack: BOOLEAN _ FALSE,    localID: LONG POINTER TO MachineIDRecord _ NIL,    echoParams: EchoParamsPtr _ NIL];  -- These types are stolen from NSName.Name  Name: TYPE = LONG POINTER TO NameRecord;  NameRecord: TYPE = RECORD [    org: Organization _ NIL, domain: Domain _ NIL, local: Local _ NIL];  Organization: TYPE = LONG STRING;  Domain: TYPE = LONG STRING;  Local: TYPE = LONG STRING;  EchoSourceType: TYPE = {local, remote};  -- local => properties.echoSource.address = properties.localID.address   MachineIDRecord: TYPE = RECORD [    name: LONG STRING _ NIL,    address: System.NetworkAddress _ System.nullNetworkAddress];  DataPatternType: TYPE = {incrementing, all0, all1, constant};  EchoParamsPtr: TYPE = LONG POINTER TO EchoParams;  PropertyHandle: TYPE = LONG POINTER TO TestProperties;  EchoParams: TYPE = MACHINE DEPENDENT RECORD [    totalCount(0):             CARDINAL      ¬ LAST[CARDINAL],    safetyTOInMsecs(1):        LONG CARDINAL ¬ 60000,     minPacketSizeInBytes(3):   CARDINAL      ¬ 2,    maxPacketSizeInBytes(4):   CARDINAL      ¬ 512,    wordContents(5):           WordsInPacket ¬ incrWords,    constant(6):               CARDINAL      ¬ 125252B,    waitForResponse(7):        BOOLEAN       ¬ TRUE,    minMsecsBetweenPackets(8): CARDINAL      ¬ 0,    checkContents(9):          BOOLEAN       ¬ TRUE,    showMpCode(10):            BOOLEAN       ¬ FALSE];  EventReporter:  TYPE = PROC [event: EchoEvent];  EchoEvent: TYPE = MACHINE DEPENDENT {    success, late, timeout, badDataGoodCRC, sizeChange, unexpected};  WordsInPacket:  TYPE = MACHINE DEPENDENT {    all0s, all1s, incrWords, allConstant, dontCare};  EchoResults: TYPE = MACHINE DEPENDENT RECORD [    totalTime, totalAttempts, successes, timeouts, late, unexpected, bad,    avgDelayInMsecs: LONG CARDINAL,    -- stats    okButDribble, badAlignmentButOkCrc, packetTooLong, overrun, idleInput,    tooManyCollisions, lateCollisions, underrun, stuckOutput,    spare: LONG CARDINAL];  -- Variables  sourceAddress, destAddress: System.NetworkAddress;  echoParams: EchoParams;  properties: PropertyHandle;  numberOfPropItems: CARDINAL = 12;  itermedResultIntervalInSec: CARDINAL = 45;  mySocketNumber: System.SocketNumber = LOOPHOLE[80];  echoOptions: LONG POINTER TO ODI.OptionsRecord;  dataPatOptions: LONG POINTER TO ODI.OptionsRecord;  optionLinePtr: LONG POINTER TO ODI.AnOptionLine;  -- Global boolean  domainAndOrgOK: BOOLEAN;  -- PROCEDUREs  DeleteProps: PROCEDURE;  Initialize: PROCEDURE;  PutBadPropMessage: PROCEDURE;  ValidateProps: PROCEDURE RETURNS [ok: BOOLEAN];  ShowTestParameters: PROCEDURE;  StartInitialDialogue: PROCEDURE;  StartEchoUser: PROC [    targetSystemElement: System.NetworkAddress,    echoParams: EchoParams,    eventReporter: EventReporter ¬ NIL,    host: System.NetworkAddress ¬ System.nullNetworkAddress];                GetEchoResults: PROC [    stopIt: BOOLEAN,    host: System.NetworkAddress ¬ System.nullNetworkAddress]    RETURNS [totalsSinceStart: EchoResults];      EnterEchoTest: ODI.OfflineDiagnosticProc;  GetAProperties: ODI.OfflineDiagnosticProc;  ListServers: ODI.OfflineDiagnosticProc;  StartEchoTest: ODI.OfflineDiagnosticProc;  ShowTestProperty: ODI.OfflineDiagnosticProc;  ShowIntermediateStatus: ODI.OfflineDiagnosticProc;  ShowFinalStatus: ODI.OfflineDiagnosticProc;  END....  	Log	time		by	action29-Jan-85 20:02:05	MXT	Created.25-Feb-85 15:33:52	MXT	Changed TestProperties. 5-Mar-85 14:25:29	MXT	Removed EchoSourceType and changed TestProperties.echoSource to use MachineIDRecord instead of EchoSourceType. 8-Mar-85 11:21:37	MXT	Added StartInitialDialogue.15-Mar-85 12:27:19	MXT	Changed to use NSName. 9-Apr-85 17:37:42	MXT	Removed NSName and NSString.