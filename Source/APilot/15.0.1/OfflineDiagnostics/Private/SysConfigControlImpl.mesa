-- File SysConfigControlImpl.mesa-- Last edited by STC,  3-Oct-88 10:08:08<<	Copyright (C) 1985, 1986, 1987, 1988 by Xerox Corporation. All rights reserved.		The following program was created in 1985 but has not been published within the meaning of the	copyright law, is furnished under license, and may not be used, copied and/or disclosed except	in accordance with the terms of said license.	>>DIRECTORY  DiskUtilityMiscDove   USING [ InitStarted, ManufDskCkOut, RigidDiskDiag],  Runtime	        USING [ StartFault],  OfflineDiagInterface  USING [ OfflineDiagnosticProc, ClientPackage,			        TestItemsForThisNode, GetATestItemsForThisNode,			        TestItem, GetATestItem,				AMenuOfSelections, GetAMenuOfSelections,			        Selections, GetASelectionArray],   SysConfigChannelDefs  USING [ Status, Initialize ],  SysConfigControlDefs,  SysConfigEEPromDefs	USING [ ReadEEProm ],  SysConfigHeadDove,  SysConfigMsgKeysDove  USING [ configMsg, SysConfigMessages ],  SysConfigMsgKeysDove1  USING [ configMsg, SysConfigMessages ],  SysConfigMsgKeysDove2  USING [ configMsg, SysConfigMessages ],  SysConfigMsgKeysImplDove,  SysConfigMsgKeysImplDove1,  SysConfigMsgKeysImplDove2,  SysConfigRigidDiskDefs USING [ SysConfigRigidDiskDefsImpl ],  SysConfigSubDefs;    SysConfigControlImpl: PROGRAM   IMPORTS         DiskUtilityMiscDove, OfflineDiagInterface, SysConfigMsgKeysDove,	SysConfigMsgKeysDove1, SysConfigMsgKeysDove2,	SysConfigHeadDove, Runtime,	SysConfigChannelDefs, SysConfigEEPromDefs,	Messages: SysConfigMsgKeysImplDove,	Messages1: SysConfigMsgKeysImplDove1,	Messages2: SysConfigMsgKeysImplDove2,	SysConfigRigidDiskDefs, SysConfigSubDefs		   EXPORTS OfflineDiagInterface, SysConfigControlDefs =	BEGIN OPEN Odi: OfflineDiagInterface;  -- ODI stands for OfflineDiagInterface.--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-- Declare pointers to the various structures that will be used.--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~  --   -- topLevelMenuNode points to a RECORD containing pointers to various   -- elements of a menu. Several may be needed depending on how many submenus  -- there are in any particular menu. The number of pointers needed equals the  -- largest number of submenus any menu has.   topLevelMenuNode: LONG POINTER TO Odi.AMenuOfSelections;    -- This points to a SEQUENCE containing pointers to all TestItems in tht top  -- menu.  topLevelMenuSelections: LONG POINTER TO Odi.TestItemsForThisNode;     -- pTestItem points to a RECORD containing all the components of a TestItem.  pTestItem: LONG POINTER TO Odi.TestItem;    -- The following pointers point to SEQUENCES specifying tests for the various  -- user classes.  pUserSelections, pProgrammerSelections: LONG POINTER TO Odi.Selections;  noneAllowed: LONG POINTER TO Odi.Selections = NIL;    --  These point to a SEQUENCE containing STRINGs of help text.  --sampleInputHelp, sampleConfirmationHelp: LONG POINTER TO Odi.HelpText;  -- Pointer to messages in SysConfigMsgKeysImplDove. This allows the-- implementation of SysConfigMsgKeysDove to take on foreign languages.   msgKey: PUBLIC LONG POINTER TO ARRAY SysConfigMsgKeysDove.SysConfigMessages  	  OF LONG STRING;  msgKey1: PUBLIC LONG POINTER TO ARRAY SysConfigMsgKeysDove1.SysConfigMessages  	  OF LONG STRING;  msgKey2: PUBLIC LONG POINTER TO ARRAY SysConfigMsgKeysDove2.SysConfigMessages  	  OF LONG STRING;  status: SysConfigChannelDefs.Status;  statusPtr: PUBLIC LONG POINTER TO SysConfigChannelDefs.Status ¬ @status;  showConfig: PUBLIC BOOLEAN ¬ FALSE;    initializationSwitch: BOOLEAN ¬ TRUE;  --~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-- Common global definitions --~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-- Cardinal to Hex Conversion --~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~NumberToHex: PUBLIC PROCEDURE [number:UNSPECIFIED, s: LONG STRING] =  BEGIN  NibbleType: TYPE = MACHINE DEPENDENT RECORD  	[nibble1: Nibble, nibble2: Nibble, nibble3: Nibble, nibble4: Nibble];    Nibble: TYPE = [0..15];  convertArray: ARRAY Nibble OF CHAR = ['0, '1, '2, '3, '4, '5, '6, '7,  					'8, '9, 'A, 'B, 'C, 'D, 'E, 'F];  junk: NibbleType;  junk ¬ LOOPHOLE[number];  s[0] ¬ convertArray[junk.nibble1];  s[1] ¬ convertArray[junk.nibble2];  s[2] ¬ convertArray[junk.nibble3];  s[3] ¬ convertArray[junk.nibble4];  s.length ¬ 4;  END;  --~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-- InitializePackage builds up all the data structures for this package.-- -- This package has one levels of menu. The top level has 18  selctions:--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~InitializePackage: PROCEDURE =   BEGIN    --~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-- Index of pointers to the above OfflineDiagnosticProcs in this menu node.--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~  configureBadMemPages: CARDINAL = 0;  configureBoot: CARDINAL = 1;  configureDefaultBoot: CARDINAL = 2;  configureDisplay: CARDINAL = 3;  configureFloppyDisk: CARDINAL = 4;  configureKeyboard: CARDINAL = 5;  configureMainMemory: CARDINAL = 6;  configureOptionBoards: CARDINAL = 7;  configureRigidDisk: CARDINAL = 8;  configureVMControlStore: CARDINAL = 9;  configureEEPromVersions: CARDINAL = 10;  verifyEEPROMCheckSum: CARDINAL = 11;  readSysConfig: CARDINAL = 12;  configureChangeAllEEprom: CARDINAL = 13;  configureShowAllEEprom: CARDINAL = 14;  configureManufacture: CARDINAL = 15;  writeEEPromImage: CARDINAL = 16;  configureUser: CARDINAL = 17;  configureUserShowAllEEprom: CARDINAL = 18;    status ¬ SysConfigEEPromDefs.ReadEEProm [];        showConfig ¬ TRUE;  -- There are 19 selections for this menu; so we need a TestItemsForThisNode that-- can hold 19 pointers to the different TestItems.  topLevelMenuSelections ¬ Odi.GetATestItemsForThisNode [19];  -- ConfigureBadMemPages  pTestItem ¬ Odi.GetATestItem [];  -- Container for ConfigureBadMemPages  pTestItem.itemName ¬ msgKey [configBadMemPages];  -- Test name     pTestItem.test ¬ SysConfigSubDefs.ConfigureBadMemPages;  -- Actual test procedure  pTestItem.itemExplanation ¬ msgKey [readModify]; -- Online help  topLevelMenuSelections.nodeItems [0] ¬ pTestItem; -- Store test item    -- ConfigureBoot  pTestItem ¬ Odi.GetATestItem [];  -- Container for ConfigureBoot  pTestItem.itemName ¬ msgKey [configBoot];  -- Test name     pTestItem.test ¬ SysConfigSubDefs.ConfigureBoot;  -- Actual test procedure  pTestItem.itemExplanation ¬ msgKey [readModify]; -- Online help  topLevelMenuSelections.nodeItems [1] ¬ pTestItem; -- Store test item    -- ConfigureDTEDCEPort  pTestItem ¬ Odi.GetATestItem [];  -- Container for ConfigureDTEPort  pTestItem.itemName ¬ msgKey [configDefaultBoot];  -- Test name     pTestItem.test ¬ SysConfigSubDefs.ConfigureDefaultBoot;  -- Actual test procedure  pTestItem.itemExplanation ¬ msgKey [readModify]; -- Online help  topLevelMenuSelections.nodeItems [2] ¬ pTestItem; -- Store test item    -- ConfigureDisplay  pTestItem ¬ Odi.GetATestItem [];  -- Container for ConfigureDisplay  pTestItem.itemName ¬ msgKey [configDisplay];  -- Test name     pTestItem.test ¬ SysConfigSubDefs.ConfigureDisplay;  -- Actual test procedure  pTestItem.itemExplanation ¬ msgKey [readModify]; -- Online help  topLevelMenuSelections.nodeItems [3] ¬ pTestItem; -- Store test item    -- ConfigureFloppyDisk  pTestItem ¬ Odi.GetATestItem [];  -- Container for ConfigureFloppyDisk  pTestItem.itemName ¬ msgKey [configFloppyDisk];  -- Test name     pTestItem.test ¬ SysConfigSubDefs.ConfigureFloppyDisk;  -- Actual test procedure  pTestItem.itemExplanation ¬ msgKey [readModify]; -- Online help  topLevelMenuSelections.nodeItems [4] ¬ pTestItem; -- Store test item    -- ConfigureKeyboard  pTestItem ¬ Odi.GetATestItem [];  -- Container for ConfigureKeyboard  pTestItem.itemName ¬ msgKey [configKeyboard];  -- Test name     pTestItem.test ¬ SysConfigSubDefs.ConfigureKeyboard;  -- Actual test procedure  pTestItem.itemExplanation ¬ msgKey [readModify]; -- Online help  topLevelMenuSelections.nodeItems [5] ¬ pTestItem; -- Store test item    -- ConfigureMainMemory  pTestItem ¬ Odi.GetATestItem [];  -- Container for ConfigureMainMemory  pTestItem.itemName ¬ msgKey [configMainMemory];  -- Test name     pTestItem.test ¬ SysConfigSubDefs.ConfigureMainMemory;  -- Actual test procedure  pTestItem.itemExplanation ¬ msgKey [readModify]; -- Online help  topLevelMenuSelections.nodeItems [6] ¬ pTestItem; -- Store test item    -- ConfigureOptionBoards  pTestItem ¬ Odi.GetATestItem [];  -- Container for ConfigureOptionBoards  pTestItem.itemName ¬ msgKey [configOptionBoards];  -- Test name     pTestItem.test ¬ SysConfigSubDefs.ConfigureOptionBoards;  -- Actual test procedure  pTestItem.itemExplanation ¬ msgKey [readModify]; -- Online help  topLevelMenuSelections.nodeItems [7] ¬ pTestItem; -- Store test item    -- ConfigureRigidDisk  pTestItem ¬ Odi.GetATestItem [];  -- Container for ConfigureRigidDisk  pTestItem.itemName ¬ msgKey [configRigidDisk];  -- Test name     pTestItem.test ¬ SysConfigSubDefs.ConfigureRigidDisk;  -- Actual test procedure  pTestItem.itemExplanation ¬ msgKey [readModify]; -- Online help  topLevelMenuSelections.nodeItems [8] ¬ pTestItem; -- Store test item    -- ConfigureVMControlStoreHardwareVersion  pTestItem ¬ Odi.GetATestItem [];  -- Container for ConfigureVMControlStore  pTestItem.itemName ¬ msgKey [configVMControlStore];  -- Test name     pTestItem.test ¬ SysConfigSubDefs.ConfigureVMControlHardwareVersion;  -- Actual test procedure  pTestItem.itemExplanation ¬ msgKey [readModify]; -- Online help  topLevelMenuSelections.nodeItems [9] ¬ pTestItem; -- Store test item    -- ConfigureEEPromVersions  pTestItem ¬ Odi.GetATestItem [];  -- Container for configureEEPromVersions  pTestItem.itemName ¬ msgKey [configEEPromVersion];  -- Test name     pTestItem.test ¬ SysConfigSubDefs.ConfigureEEPromVersions;  -- Actual test procedure  pTestItem.itemExplanation ¬ msgKey [readModify]; -- Online help  topLevelMenuSelections.nodeItems [10] ¬ pTestItem; -- Store test item    -- VerifyEEPROMCheckSum  pTestItem ¬ Odi.GetATestItem [];  -- Container for VerifyEEPROMCheckSum  pTestItem.itemName ¬ msgKey [verifyEEPROMCheckSum];  -- Test name     pTestItem.test ¬ SysConfigSubDefs.VerifyEEPROMCheckSum;  -- Actual test procedure  pTestItem.itemExplanation ¬ msgKey [readModify]; -- Online help  topLevelMenuSelections.nodeItems [11] ¬ pTestItem; -- Store test item    -- ReadSysConfig  pTestItem ¬ Odi.GetATestItem [];  -- Container for ReadSysConfig  pTestItem.itemName ¬ msgKey [readSysConfig];  -- Test name     pTestItem.test ¬ SysConfigSubDefs.ReadSysConfig;  -- Actual test procedure  pTestItem.itemExplanation ¬ msgKey [readModify]; -- Online help  topLevelMenuSelections.nodeItems [12] ¬ pTestItem; -- Store test item    -- ConfigChangeAllEEprom  pTestItem ¬ Odi.GetATestItem [];  -- Container for ConfigureChangeAllEEprom  pTestItem.itemName ¬ msgKey [configChangeAllEEprom];  -- Test name     pTestItem.test ¬ SysConfigSubDefs.ConfigureChangeAllEEprom;  -- Actual test procedure  pTestItem.itemExplanation ¬ msgKey [readModify]; -- Online help  topLevelMenuSelections.nodeItems [13] ¬ pTestItem; -- Store test item    -- ConfigShowAllEEprom  pTestItem ¬ Odi.GetATestItem [];  -- Container for ConfigureShowAllEEprom  pTestItem.itemName ¬ msgKey [configShowAllEEprom];  -- Test name     pTestItem.test ¬ SysConfigSubDefs.ConfigureShowAllEEprom;  -- Actual test procedure  pTestItem.itemExplanation ¬ msgKey [readModify]; -- Online help  topLevelMenuSelections.nodeItems [14] ¬ pTestItem; -- Store test item    -- ConfigureManufactureUser  pTestItem ¬ Odi.GetATestItem [];  -- Container for WriteEEPromImage  pTestItem.itemName ¬ msgKey [configureManufactureUser];  -- Test name     pTestItem.test ¬ SysConfigSubDefs.ConfigureManufactureUser;  -- Actual test procedure  pTestItem.itemExplanation ¬ msgKey [readModify]; -- Online help  topLevelMenuSelections.nodeItems [15] ¬ pTestItem; -- Store test item    -- WriteEEPromImage  pTestItem ¬ Odi.GetATestItem [];  -- Container for WriteEEPromImage  pTestItem.itemName ¬ msgKey [writeEEPromImage];  -- Test name     pTestItem.test ¬ SysConfigSubDefs.WriteEEPromImage;  -- Actual test procedure  pTestItem.itemExplanation ¬ msgKey [readModify]; -- Online help  topLevelMenuSelections.nodeItems [16] ¬ pTestItem; -- Store test item    -- ConfigureUser  pTestItem ¬ Odi.GetATestItem [];  -- Container for ConfigureShowAllEEprom  pTestItem.itemName ¬ msgKey [configureUser];  -- Test name     pTestItem.test ¬ SysConfigSubDefs.ConfigureUser;  -- Actual test procedure  pTestItem.itemExplanation ¬ msgKey [readModify]; -- Online help  topLevelMenuSelections.nodeItems [17] ¬ pTestItem; -- Store test item    -- ConfigureUserShowAllEEprom  pTestItem ¬ Odi.GetATestItem [];  -- Container for WriteEEPromImage  pTestItem.itemName ¬ msgKey [configureUserShowAllEEprom];  -- Test name     pTestItem.test ¬ SysConfigSubDefs.ConfigureUserShowAllEEprom;  -- Actual test procedure  pTestItem.itemExplanation ¬ msgKey [readModify]; -- Online help  topLevelMenuSelections.nodeItems [18] ¬ pTestItem; -- Store test item    -- Assign top level menu tests for the different classes of users.-- Normal Users  pUserSelections ¬ Odi.GetASelectionArray [2]; --  All 15 selection.  pUserSelections.selections[0] ¬ configureUser;  pUserSelections.selections[1] ¬ configureUserShowAllEEprom;  -- Programmers  pProgrammerSelections ¬ Odi.GetASelectionArray [17]; --  All 17 selection.  pProgrammerSelections.selections[0] ¬ configureBadMemPages;  pProgrammerSelections.selections[1] ¬ configureBoot;  pProgrammerSelections.selections[2] ¬ configureDefaultBoot;  pProgrammerSelections.selections[3] ¬ configureDisplay;  pProgrammerSelections.selections[4] ¬ configureFloppyDisk;  pProgrammerSelections.selections[5] ¬ configureKeyboard;  pProgrammerSelections.selections[6] ¬ configureMainMemory;  pProgrammerSelections.selections[7] ¬ configureOptionBoards;  pProgrammerSelections.selections[8] ¬ configureRigidDisk;  pProgrammerSelections.selections[9] ¬ configureVMControlStore;  pProgrammerSelections.selections[10] ¬ configureEEPromVersions;  pProgrammerSelections.selections[11] ¬ verifyEEPROMCheckSum;  pProgrammerSelections.selections[12] ¬ readSysConfig;  pProgrammerSelections.selections[13] ¬ configureChangeAllEEprom;  pProgrammerSelections.selections[14] ¬ configureShowAllEEprom;  pProgrammerSelections.selections[15] ¬ configureManufacture;  pProgrammerSelections.selections[16] ¬ writeEEPromImage;     -- Wrap up all the items in topLevelMenuNode ­. This will be assigned to-- the subMenu field of the selection that will select the Bad Page Utilities-- menu.  topLevelMenuNode ¬ Odi.GetAMenuOfSelections [];  -- Allocate space  topLevelMenuNode.menuTitle ¬ msgKey [topLevelMenuTitle];  topLevelMenuNode.userSelections ¬ pUserSelections;  topLevelMenuNode.adminSelections ¬ pProgrammerSelections;  topLevelMenuNode.seSelections ¬ pProgrammerSelections;  topLevelMenuNode.manufacturingSelections ¬ pProgrammerSelections;  topLevelMenuNode.programmerSelections ¬ pProgrammerSelections;  topLevelMenuNode.testItemsForThisNode ¬ topLevelMenuSelections;    -- Fill in the Help Text  --sampleConfirmationHelp ¬ Odi.GetAHelpText [3]; Just for illustration  --sampleConfirmationHelp.helpTitle ¬ msgKey [confirmHelpTitle];  --sampleConfirmationHelp.textBody[0] ¬ msgKey [confirmHelp0];  --sampleConfirmationHelp.textBody[1] ¬ msgKey [confirmHelp1];  --sampleConfirmationHelp.textBody[2] ¬ msgKey [confirmHelp2];    --sampleInputHelp ¬ Odi.GetAHelpText [2]; Just for illustration  --sampleInputHelp.helpTitle ¬ msgKey [sampleTitle];  --sampleInputHelp.textBody[0] ¬ msgKey [sample0];  --sampleInputHelp.textBody[1] ¬ msgKey [sample1];    END;  -- InitializePackage.  --~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-- PUBLIC PROCEDURE exported to the Control Module.--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~RunSystemConfigurator: PUBLIC Odi.ClientPackage =  BEGIN    DiskUtilityMiscDove.InitStarted ¬ FALSE;    DiskUtilityMiscDove.RigidDiskDiag ¬ FALSE;    DiskUtilityMiscDove.ManufDskCkOut ¬ FALSE; -- so virginDisk is correct    InitializePackage [];  -- Build up the menu procedural data bases    RETURN [topLevelMenuNode];  -- Pass pointer of root node to Control Module  END;    --~~~~~~~~~~~~~~~~~    -- Main line code.    --~~~~~~~~~~~~~~~~~        START Messages [! Runtime.StartFault => CONTINUE]; -- Fire up Msg Key System    START Messages1 [! Runtime.StartFault => CONTINUE]; -- Fire up Msg Key System    START Messages2 [! Runtime.StartFault => CONTINUE]; -- Fire up Msg Key System	    START SysConfigRigidDiskDefs.SysConfigRigidDiskDefsImpl [! Runtime.StartFault => CONTINUE];    START SysConfigHeadDove [! Runtime.StartFault => CONTINUE];    msgKey ¬ SysConfigMsgKeysDove.configMsg;    msgKey1 ¬ SysConfigMsgKeysDove1.configMsg;    msgKey2 ¬ SysConfigMsgKeysDove2.configMsg;      IF initializationSwitch THEN  	{initializationSwitch ¬ FALSE;   	SysConfigChannelDefs.Initialize; };    status ¬ SysConfigEEPromDefs.ReadEEProm [];  END...  SysConfigControlImpl.mesa    LOGCreated on 18-Jun-85 14:27:56 by Allen Roberts16-Sep-85  9:41:00, by: AMR19-Sep-85: Made AdminSelections, TechRepSelections, pManufacturingSelections	   and pProgrammerSelections all the same.  -- KL19-Sep-85  7:46:22	by: KL19-Sep-85 11:11:16	by: KL17-Oct-85 15:02:24	by: AMR4-May-87: Move STARTs and some other initialization into mainline code. -- JPM12-May-87: Call proc in new SysConfigEEPromDefs to initialize EEProm image. -- JPM16-Oct-87 16:36:17, STC, convert to 14.022-Oct-87 10:58:41, STC, rearrange Initiation 2-Mar-88 15:03:54, STC, add InitStarted, ManufDskCkOut ¬ FALSE11-Mar-88  9:58:38, STC, add RigidDiskDiag ¬ FALSE 3-Oct-88  9:45:48, STC, Labelless add msgKey2