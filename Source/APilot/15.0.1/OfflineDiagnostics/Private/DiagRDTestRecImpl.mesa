-- File: DiagRDTestRecImpl.mesa-- Copyright (C) 1984, 1985, 1986, 1987, 1988  by Xerox Corporation. All rights reserved. -- Last edited by STC, 4-Oct-88 17:10:07------~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~--Subtest abreviation definitions:--	Dt=	Data--	Cmp=	Compare read label and or data--	Cyl=	Cylinder--	Fmt=	Format--	Head=	Head--	Hd=	Header--	Lb=	Label--	Lst=	Last--	Np=	Nop (no Operation)--	Ptn=	Pattern--	Rd=	Read--	Rndm=	Random--	Sc=	Sector--	Stnd=	Standard--	ST=	Subtest--	Trk=	Track--	Vd=	Verify data after a read--	Vl=	Verify label after a read--	Vr=	Verify--	Wr=	Write--	5A7=	Writen Data--	0s=	Writen Data all 0's--	1s=	Writen Data all 1's----~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ DIRECTORY DiagDiskCmdDrive	USING	[ExecuteCommands], DiagDiskMkMisc		USING	[mkMisc], DiagDiskMkSubtest	USING	[mkSubtest], DiagRDTests 		USING	[Switch], DiagDiskTestControl 	USING	[SetUpTestControl,--				 TCPassedLstCyl,				 TCRecal,				 TCRecalCn,				 TCRndRd,				 TCRndWrRdVrCnt,				 TCStndLstScTrk0,				 TCVrRdRdCyl0,				 TCVrRdRdCmpLbDtCylLstEx,				 TCVrRdRdCmpLbDtLstScTrk0,				 TCVrRdRdCyl0VlVdFmtDt,				 TCVrRdRdAllCyls,				 TCVrRdRdCylLstVlVd,--				 TCVrWrWrDiagDtCylLst,				 TCVrRdRdAllCylsFmtDt,				 TCVrWrWrCylLstEx,				 TCVrWrWrDiagDtCyl0,--				 TCVrWrWrDiagDtDisk,				 TCWrOrRd1CylLstCn,				 TCWrOrRd2CylLstCn,				 TCWrWrWrDisk,				 --TCWrWrWrDisk2,				 TCWrWrWrLstCyl,				 TCWrWrWrCyl,				 TCVrWrWrsCyl,				 TCVrVrWrsCyl,				 TCVrVrVrCyl,				 TCZipControl], DiagRDTestCmdArrays	USING	[Cmds], DiagRDErrorCheck 	USING	[--ECDtVrErr, ECLbVrErr,-- ECStandard1,				 --ECIllegalCylErr,-- ECIllegalOpr,				 PublicErrorCheckArray, ResetIntermediateResults--, ShowIntermediateResults--], OfflineDiagInterface	USING	[GetYesNo, PutMessage], DiagRDTestRec		USING	[Subtest, SubTestRecord];    DiagRDTestRecImpl: PROGRAM    IMPORTS	DiagDiskCmdDrive,	DiagDiskMkMisc,	DiagDiskMkSubtest,	DiagDiskTestControl,	DiagRDErrorCheck,	DiagRDTestCmdArrays,	DiagRDTests,	OfflineDiagInterface    EXPORTS  	DiagRDTestRec  = BEGIN      OPEN	DiagDiskTestControl,	DiagRDTestCmdArrays,	DiagRDErrorCheck,	Odi: OfflineDiagInterface; SubTestBeingExecuted:		PUBLIC DiagRDTestRec.Subtest; Subtests: PUBLIC LONG POINTER TO ARRAY DiagRDTestRec.Subtest OF				DiagRDTestRec.SubTestRecord ¬ @mySubTests; mySubTests: ARRAY DiagRDTestRec.Subtest OF DiagRDTestRec.SubTestRecord ¬   [	--this subtest performs no operation  	STNoOp:	[title:			NIL,	 testControl:		TCZipControl,	 testCommands:		Cmds[CANoOp],	 statusCheck:		NIL],	 	--error log and trace commands  	STClearLog:	[title:			DiagDiskMkSubtest.mkSubtest[clearLog],	 testControl:		TCZipControl,	 testCommands:		Cmds[CAClearLog],	 statusCheck:		NIL],	STClearTrace:	[title:			DiagDiskMkSubtest.mkSubtest[clearTrace],	 testControl:		TCZipControl,	 testCommands:		Cmds[CAClearTrace],	 statusCheck:		NIL],	STStartLog:	[title:			DiagDiskMkSubtest.mkSubtest[startLogging],	 testControl:		TCZipControl,	 testCommands:		Cmds[CAStartLog],	 statusCheck:		NIL],	STStartTrace:	[title:			DiagDiskMkSubtest.mkSubtest[startTracing],	 testControl:		TCZipControl,	 testCommands:		Cmds[CAStartTrace],	 statusCheck:		NIL],	STStopLog:	[title:			DiagDiskMkSubtest.mkSubtest[stopLogging],	 testControl:		TCZipControl,	 testCommands:		Cmds[CAStopLog],	 statusCheck:		NIL],	STStopTrace:	[title:			DiagDiskMkSubtest.mkSubtest[stopTracing],	 testControl:		TCZipControl,	 testCommands:		Cmds[CAStopTrace],	 statusCheck:		NIL],	--format entire disk		(exerciser/manuf) 	STWrWrWrDisk:	[title:			DiagDiskMkSubtest.mkSubtest[format],	 testControl:		TCWrWrWrDisk,	 testCommands:		Cmds[CAWrWrWrDisk],	 statusCheck:		DESCRIPTOR [ECStandard1]],	--format last cylinger		(confidence test) 	STWrWrWrLstCyl:	[title:			DiagDiskMkSubtest.mkSubtest[formatLstCyl],	 testControl:		TCWrWrWrLstCyl,	 testCommands:		Cmds[CAWrWrWrLstCyl],	 statusCheck:		DESCRIPTOR [ECStandard1]],	--tag the entire disk		(hardware test)--	STVrWrWrDiagDtDisk:--	[title:			DiagDiskMkSubtest.mkSubtest[vrWrWrDiagDtDisk],--	 testControl:		TCVrWrWrDiagDtDisk,--	 testCommands:		Cmds[CAVrWrWrDiagDtDisk],--	 statusCheck:		DESCRIPTOR[ECStandard1]],	--tag cylinder 0		(exerciser) 	STVrWrWrDiagCyl0:	[title:			DiagDiskMkSubtest.mkSubtest[vrWrWrDiagCyl0],	 testControl:		TCVrWrWrDiagDtCyl0,	 testCommands:		Cmds[CAVrWrWrDiagCyl0],	 statusCheck:		DESCRIPTOR [ECStandard1]],	--read cylinder 0 		(confidence test)	STVrRdRdCyl0:	[title:			DiagDiskMkSubtest.mkSubtest[vrRdRdCyl0],	 testControl:		TCVrRdRdCyl0,	 testCommands:		Cmds[CAVrRdRdCyl0],	 statusCheck:		DESCRIPTOR[ECStandard1]],	--				(exerciser, uses format data)	--read cylinder 0 and verify the formatted data	STVrRdRdCyl0FmtDt:	[title:			DiagDiskMkSubtest.mkSubtest[vrRdRdCyl0Ex],	 testControl:		TCVrRdRdCyl0VlVdFmtDt,	 testCommands:		Cmds[CAVrRdRdCyl0],	 statusCheck:		DESCRIPTOR[ECStandard1]],	--tag last cylinder		(exerciser/confidence test)-- 	STVrWrWrDiagCylLst:--	[title:			DiagDiskMkSubtest.mkSubtest[vrWrWrDiagCylLst],--	 testControl:		TCVrWrWrDiagDtCylLst,--	 testCommands:		Cmds[CAVrWrWrDiagCylLst],--	 statusCheck:		DESCRIPTOR [ECStandard1]],	--verify last cylinder		(exerciser)	STVrRdRdCylLstVlVd:	[title:			DiagDiskMkSubtest.mkSubtest[vrRdRdCylLstVlVd],	 testControl:		TCVrRdRdCylLstVlVd,	 testCommands:		Cmds[CAVrRdRdCylLstVlVd],	 statusCheck:		DESCRIPTOR[ECStandard1]],	--verify cylinder addr		(exerciser, uses format data)	STVrRdRdAllCylsFmtDt:	[title:			DiagDiskMkSubtest.mkSubtest[vrRdRdAllCylsEx],	 testControl:		TCVrRdRdAllCylsFmtDt,	 testCommands:		Cmds[CAVrRdRdAllCyls],	 statusCheck:		DESCRIPTOR[ECStandard1]],	--*** this test is of no used without a read/read/read command	--verify cylinder addr		(confidence test)	STVrRdRdAllCyls:	[title:			DiagDiskMkSubtest.mkSubtest[vrRdRdAllCyls],	 testControl:		TCVrRdRdAllCyls,	 testCommands:		Cmds[CAVrRdRdAllCyls],	 statusCheck:		DESCRIPTOR[ECStandard1]],	--Error logic checking	--check label verify error logic(exerciser/confidence test)--	STVrVrRdLstScTrk0:--	[title:			DiagDiskMkSubtest.mkSubtest[chkLbVrErr],--	 testControl:		TCStndLstScTrk0,--	 testCommands:		Cmds[CAVrVrRdLstScTrk0],--	 statusCheck:		DESCRIPTOR[ECLbVrErr]],	--check data error logic	(exerciser/confidence test)--	STVrVrVrLstScTrk0:--	[title:			DiagDiskMkSubtest.mkSubtest[chkDtVrErr],--	 testControl:		TCStndLstScTrk0,--	 testCommands:		Cmds[CAVrVrVrLstScTrk0],--	 statusCheck:		DESCRIPTOR[ECDtVrErr]],	--check passed cylinder error logic(exerciser/confidence test)--	STPassedLstCyl:--	[title:			DiagDiskMkSubtest.mkSubtest[illegalCylChk],--	 testControl:		TCPassedLstCyl,--	 testCommands:		Cmds[CAPassedLstCyl],--	 statusCheck:		DESCRIPTOR[ECIllegalCylErr]],	--check illegal command(exerciser/confidence test)	STIllegalOpr:	[title:			DiagDiskMkSubtest.mkSubtest[illegalCmdChk],	 testControl:		TCStndLstScTrk0,	 testCommands:		Cmds[CANpNpNpLstScTrk0],	 statusCheck:		DESCRIPTOR[ECIllegalOpr]],	 	 --different legal commands	STVrRdNpLstScTrk0:	[title:			DiagDiskMkSubtest.mkSubtest[vrRdNpCmdChk],	 testControl:		TCStndLstScTrk0,	 testCommands:		Cmds[CAVrRdNpLstScTrk0],	 statusCheck:		DESCRIPTOR[ECStandard1]],	STVrVrWrLstScTrk0:	[title:			DiagDiskMkSubtest.mkSubtest[vrVrWrCmdChk],	 testControl:		TCStndLstScTrk0,	 testCommands:		Cmds[CAVrVrWrLstScTrk0], --self contained	 statusCheck:		DESCRIPTOR[ECStandard1]],	--test recalibrate	(confidence test)	STRecalCn:	[title:			DiagDiskMkSubtest.mkSubtest[recalChk],	 testControl:		TCRecalCn,	 testCommands:		Cmds[CARecal],	 statusCheck:		DESCRIPTOR[ECStandard1]],	--test recalibrate	(exerciser)	STRecal:	[title:			DiagDiskMkSubtest.mkSubtest[recalChkEx],	 testControl:		TCRecal,	 testCommands:		Cmds[CARecal],	 statusCheck:		DESCRIPTOR[ECStandard1]],	--test data last sector on track 0	(exerciser/confidence test)	STVrWrWr0sLstScTrk0:	[title:			DiagDiskMkSubtest.mkSubtest[vrWrWr0sCyl0],	 testControl:		TCStndLstScTrk0,	 testCommands:		Cmds[CAVrWrWr0sTrk0],	 statusCheck:		DESCRIPTOR[ECStandard1]],	STVrWrWr1sLstScTrk0:	[title:			DiagDiskMkSubtest.mkSubtest[vrWrWr1sCyl0],	 testControl:		TCStndLstScTrk0,	 testCommands:		Cmds[CAVrWrWr1sTrk0],	 statusCheck:		DESCRIPTOR[ECStandard1]],	STVrWrWr5sLstScTrk0:	[title:			DiagDiskMkSubtest.mkSubtest[vrWrWr5sCyl0],	 testControl:		TCStndLstScTrk0,	 testCommands:		Cmds[CAVrWrWr5sTrk0],	 statusCheck:		DESCRIPTOR[ECStandard1]],	STVrWrWrAsLstScTrk0:	[title:			DiagDiskMkSubtest.mkSubtest[vrWrWrAsCyl0],	 testControl:		TCStndLstScTrk0,	 testCommands:		Cmds[CAVrWrWrAsTrk0],	 statusCheck:		DESCRIPTOR[ECStandard1]],	STVrRdRdCmpLbDtLstScTrk0:	[title:			DiagDiskMkSubtest.mkSubtest[vrRdRdCmpLbDtCyl0],	 testControl:		TCVrRdRdCmpLbDtLstScTrk0,	 testCommands:		Cmds[CAVrRdRdCmpLbDtTrk0],	 statusCheck:		DESCRIPTOR[ECStandard1]],	--test data last cylinder 	(exerciser)	STVrWrWr0sCylLstEx:	[title:			DiagDiskMkSubtest.mkSubtest[vrWrWr0sCylLstEx],	 testControl:		TCVrWrWrCylLstEx,	 testCommands:		Cmds[CAVrWrWr0sCylLst],	 statusCheck:		DESCRIPTOR[ECStandard1]],	STVrWrWr1sCylLstEx:	[title:			DiagDiskMkSubtest.mkSubtest[vrWrWr1sCylLstEx],	 testControl:		TCVrWrWrCylLstEx,	 testCommands:		Cmds[CAVrWrWr1sCylLst],	 statusCheck:		DESCRIPTOR[ECStandard1]],	STVrWrWr5sCylLstEx:	[title:			DiagDiskMkSubtest.mkSubtest[vrWrWr5sCylLstEx],	 testControl:		TCVrWrWrCylLstEx,	 testCommands:		Cmds[CAVrWrWr5sCylLst],	 statusCheck:		DESCRIPTOR[ECStandard1]],	STVrWrWrAsCylLstEx:	[title:			DiagDiskMkSubtest.mkSubtest[vrWrWrAsCylLstEx],	 testControl:		TCVrWrWrCylLstEx,	 testCommands:		Cmds[CAVrWrWrAsCylLst],	 statusCheck:		DESCRIPTOR[ECStandard1]],	STVrRdRdCmpLbDtCylLstEx:	[title:			DiagDiskMkSubtest.mkSubtest[vrRdRdCmpLbDtCylLstEx],	 testControl:		TCVrRdRdCmpLbDtCylLstEx,	 testCommands:		Cmds[CAVrRdRdCmpLbDtCylLst],	 statusCheck:		DESCRIPTOR[ECStandard1]],	--test data last cylinder 	(confidence test)	STVrWrWr0sCylLstCn:	[title:			DiagDiskMkSubtest.mkSubtest[vrWrWr0sCylLst],	 testControl:		TCWrOrRd1CylLstCn,	 testCommands:		Cmds[CAVrWrWr0sCylLst],	 statusCheck:		DESCRIPTOR[ECStandard1]],	STVrWrWr1sCylLstCn:	[title:			DiagDiskMkSubtest.mkSubtest[vrWrWr1sCylLst],	 testControl:		TCWrOrRd1CylLstCn,	 testCommands:		Cmds[CAVrWrWr1sCylLst],	 statusCheck:		DESCRIPTOR[ECStandard1]],	STVrWrWr5sCylLstCn:	[title:			DiagDiskMkSubtest.mkSubtest[vrWrWr5sCylLst],	 testControl:		TCWrOrRd1CylLstCn,	 testCommands:		Cmds[CAVrWrWr5sCylLst],	 statusCheck:		DESCRIPTOR[ECStandard1]],	STVrWrWrAsCylLstCn:	[title:			DiagDiskMkSubtest.mkSubtest[vrWrWrAsCylLst],	 testControl:		TCWrOrRd1CylLstCn,	 testCommands:		Cmds[CAVrWrWrAsCylLst],	 statusCheck:		DESCRIPTOR[ECStandard1]],	STVrAndRDAndCmpCylLstCn:	[title:			DiagDiskMkSubtest.mkSubtest[vrRdRdCmpLbDtCylLst],	 testControl:		TCWrOrRd1CylLstCn,	 testCommands:		Cmds[CAVrRdRdCmpLbDtCylLst],	 statusCheck:		DESCRIPTOR[ECStandard1]],	--test data last cylinder 	(confidence test)	STWrAndRdAndVrCylLstCn:	[title:			DiagDiskMkSubtest.mkSubtest[WrAndRdAndVrCylLst],	 testControl:		TCWrOrRd2CylLstCn,	 testCommands:		Cmds[CAWrAndRdAndVrCylLst],	 statusCheck:		DESCRIPTOR[ECStandard1]], 	--random seek test	(confidence test)	STSeekRand1Cn:	[title:			DiagDiskMkSubtest.mkSubtest[rndVrRdRd1],	 testControl:		TCRndRd,	 testCommands:		Cmds[CARndVrRdRd1],	 statusCheck:		DESCRIPTOR [ECStandard1]],	STSeekRand2Cn:	[title:			DiagDiskMkSubtest.mkSubtest[rndVrRdRd2],	 testControl:		TCRndRd,	 testCommands:		Cmds[CARndVrRdRd2],	 statusCheck:		DESCRIPTOR [ECStandard1]], 	--random seek test	(exerciser)	STRndWrVr1Ex:	[title:			DiagDiskMkSubtest.mkSubtest[rndWrRd1],	 testControl:		TCRndWrRdVrCnt,	 testCommands:		Cmds[CARndWrVr1],	 statusCheck:		DESCRIPTOR [ECStandard1]],	STRndWrVr2Ex:	[title:			DiagDiskMkSubtest.mkSubtest[rndWrRd2],	 testControl:		TCRndWrRdVrCnt,	 testCommands:		Cmds[CARndWrVr2],	 statusCheck:		DESCRIPTOR [ECStandard1]],	STRndWrVr3Ex:	[title:			DiagDiskMkSubtest.mkSubtest[rndWrVr2],	 testControl:		TCRndWrRdVrCnt,	 testCommands:		Cmds[CARndWrVr3],	 statusCheck:		DESCRIPTOR [ECStandard1]],	STRndWrVr4Ex:	[title:			DiagDiskMkSubtest.mkSubtest[rndWrVr1],	 testControl:		TCRndWrRdVrCnt,	 testCommands:		Cmds[CARndWrVr4],	 statusCheck:		DESCRIPTOR [ECStandard1]], 	--random seek test	(manufacturing)	STRndWrVr1Mf:	[title:			DiagDiskMkSubtest.mkSubtest[rndWrRdVr],	 testControl:		TCRndWrRdVrCnt,	 testCommands:		Cmds[CARndWrVr1Mf],	 statusCheck:		DESCRIPTOR [ECStandard1]], 	-- format a cylinder	(diagnostics)	STWrWrWrCyl:	[title:			DiagDiskMkSubtest.mkSubtest[WrWrWrCyl],	 testControl:		TCWrWrWrCyl,	 testCommands:		Cmds[CAWrWrWrCyl],	 statusCheck:		DESCRIPTOR [ECStandard1]], 	-- write Labels & Data	(diagnostics)	STVrWrWrsCyl:	[title:			DiagDiskMkSubtest.mkSubtest[vrWrWrCyl],	 testControl:		TCVrWrWrsCyl,	 testCommands:		Cmds[CAVrWrWrsCyl],	 statusCheck:		DESCRIPTOR [ECStandard1]], 	-- write Data		(diagnostics)	STVrVrWrsCyl:	[title:			DiagDiskMkSubtest.mkSubtest[vrvrWrCyl],	 testControl:		TCVrVrWrsCyl,	 testCommands:		Cmds[CAVrVrWrsCyl],	 statusCheck:		DESCRIPTOR [ECStandard1]], 	-- verify Labels/Data	(diagnostics)	STVrVrVrCyl:	[title:		      DiagDiskMkSubtest.mkSubtest[vrvrvrCyl],	 testControl:		TCVrVrVrCyl,	 testCommands:		Cmds[CAVrVrVrCyl],	 statusCheck:		DESCRIPTOR [ECStandard1]]	 ]; -- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -- to run an array of tests -- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ RunTestArray: PUBLIC PROCEDURE [    subtestSelectArray: DESCRIPTOR FOR ARRAY OF DiagRDTestRec.Subtest    ¬ DESCRIPTOR[NIL, 0]] = BEGIN count:   CARDINAL ¬ 0; subtest: DiagRDTestRec.Subtest; IF BASE[subtestSelectArray] = NIL THEN RETURN;  --IF DiagRDTests.Switch[28] THEN ShowIntermediateResults[];  ResetIntermediateResults[]; UNTIL count = LENGTH[subtestSelectArray] DO   -- get subtests to run   subtest ¬ subtestSelectArray[count];   RunSubtest[subtest: subtest];   count ¬ count + 1; ENDLOOP;  --IF DiagRDTests.Switch[29] THEN ShowIntermediateResults[];   END; --RunTestArray -- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -- to run test -- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ RunSubtest: PUBLIC PROCEDURE [subtest: DiagRDTestRec.Subtest] = BEGIN yes: BOOLEAN ¬ TRUE;  SubTestBeingExecuted¬ subtest;  -- display title Odi.PutMessage[message: DiagDiskMkMisc.mkMisc[subtesT],		clearMessageAreaFirst: TRUE]; Odi.PutMessage[message: Subtests[subtest].title, 		startWithNewLine: FALSE,		blankSpaces: 1]; IF DiagRDTests.Switch[1] THEN  yes ¬  Odi.GetYesNo[prompt: "Run this subtest? (Yes/No): "L]; IF yes THEN { DiagDiskTestControl.SetUpTestControl[    controlData: Subtests[subtest].testControl];    DiagRDErrorCheck.PublicErrorCheckArray ¬ Subtests[subtest].statusCheck;    DiagDiskCmdDrive.ExecuteCommands[Subtests[subtest].testCommands] }; END;--  InitializeSubtests[];  END....-- of DiagRDTestRecImpl.mesa10-Dec-85 12:26:13	MXT	Commented out some debuggin codes15-Mar-87 15:16:00 by STC, add STWrWrWrCyl, STVrWrWrsCyl, STVrVrWrsCyl, STVrRdRdCmpLbDtCyl.  18-Mar-87 12:47:09 by STC, remove STVrWrWrDiagDtDisk, STVrWrWrDiagCylLst, STVrVrVrLstScTrk0, STPassedLstCyl. 4-Oct-88 16:04:55, STC Labelless removed STVrVrRdLstScTrk0 