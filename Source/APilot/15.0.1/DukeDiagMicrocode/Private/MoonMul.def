;MoonMul.def;;last edited by TXM		21-Sep-87  9:08:13;;definitions for multiple testE0StackLoc  equ  TestCodeLoc3-300HE2StackLoc  equ  E0StackLoc+IOPStackSize/2E3StackLoc  equ  E2StackLoc+IOPStackSize/2E4StackLoc  equ  E3StackLoc+IOPStackSize/2E5StackLoc  equ  E4StackLoc+IOPStackSize/2E6StackLoc  equ  E5StackLoc+IOPStackSize/2E1StackLoc  equ  480HE0Task		equ	01HE1Task		equ	02HE2Task		equ	04HE3Task		equ	08HE4Task		equ	10HE5Task		equ	20HE6Task		equ	40HE7Task		equ	80HAnyDevice	equ	0FFHAnyActive	equ	03FHEXTCBSize	equ  42MemTCBSize	equ  38DVTCBSize	equ  16RSTCBSize	equ  26FTCBSize	equ  24ETCBSize	equ  8MemTCBLoc	equ  EXTCBSizeDVTCBLoc	equ  MemTCBLoc+MemTCBSizeRSTCBLoc	equ  DVTCBLoc+DVTCBSizeFTCBLoc	equ  RSTCBLoc+RSTCBSizeETCBLoc	equ  FTCBLoc+FTCBSize;Error ControlEStopOnError		equ 1ENoIncBanks		equ 2ENoIncMap	        equ 4ENoMemoryParityErrors	equ 80h ;;-----------------------------------------------------------------ETCBlock  STRUC  EErrorControl 		DB  0EDeviceControl  	DB  0EPageParity 		DB  0EBankParity 		DB  0EActiveDevices		DB  0EDevicesNeedService	DB  0EPassCount		DB  0ECurrentPassCount	DB  0E0IntCount		DB  0E1IntCount		DB  0E2IntCount		DB  0E3IntCount		DB  0E4IntCount		DB  0E5IntCount		DB  0EMap			DB  0E6IntCount		DB  0EEndBank		DB  0EBank			DB  0EIntWaitTime		DW  0E0IntWaitTime		DW  0E1IntWaitTime		DW  0E2IntWaitTime		DW  0E3IntWaitTime		DW  0E4IntWaitTime		DW  0E5IntWaitTime		DW  0E6IntWaitTime		DW  0E0SP  			DB  0E1SP  			DB  0E2SP  			DB  0E3SP  			DB  0E4SP  			DB  0E5SP  			DB  0E6SP  			DB  0ESYSPSP  		DB  0ETCBlock ENDSMTCBlock  STRUC  MMesaIntCount 		DB  0MInterFaceControl 	DB  0MMemoryControl 		DB  0MDisplayControl 	DB  0MCSAddress 		DW  0MPassCount		DB  0MSpare0			DB  0MStartPage		DB  0MStartBank		DB  0MEndPage		DB  0MEndBank		DB  0MEndWord		DB  0MStartWord		DB  0MStartMapPage		DB  0MStartMapBank		DB  0MEndMapPage		DB  0MEndMapBank		DB  0MStartData		DW  0MTestControl		DB  0MStartDataType		DB  0MMesaErrorControl	DB  0MDataControl		DB  0MDelayTime		DW  0MEndMesaPage		DB  0MEndMesaBank		DB  0MEndMesaWord		DB  0MEndMesaDataType	DB  0MMesaStartPassData	DW  0MMesaExpectedData	DW  0MMesaObservedData	DW  0MSpare1			DB  0MMesaFault		DB  0MTCBlock ENDSSMTCBlock  STRUC  SSMTCBPattern		DW  0SInterFaceControl	DB  0SPassCount		DB  0SStartBank		DB  0SStartPage		DB  0SEndBank		DB  0SEndPage		DB  0SStartWord		DB  0SEndWord		DB  0SStartMapBank		DB  0SStartMapPage		DB  0SEndMapBank		DB  0SEndMapPage		DB  0SStartData		DW  0SStartDataType		DB  0STestControl		DB  0SDataControl		DB  0SMesaErrorControl	DB  0SDelayTime		DW  0SMemSize		DW  0SMemSize1		DW  0SMTCBlock ENDSRMTCBlock  STRUC  RRMTCBPattern		DW  0REndMesaBank		DB  0REndMesaPage		DB  0REndMesaDataType	DB  0REndMesaWord		DB  0RMesaStartPassData	DW  0RMesaExpectedData	DW  0RMesaObservedData	DW  0RSpare1			DB  0RMesaFault		DB  0RMTCBlock ENDS;InterFace ControlMRunMesaOnly	equ 0MRunMesaAndIOP	equ 1MNoStopStartMesa	equ 40H;State CounterMNoInterrupts	equ 0;Display ControlMDisplayOn		equ 1;Memory Control;SMCTBPatternSMCTBPattern		equ 0E88EH ;8EE8H in Memory;RMCTBPatternRMCTBPattern		equ 0C44CH ;4CC4H in Memory;Data Type ControlMBlockType		equ 0MAddressType		equ 1MRandomPlusType		equ 2MRandomXORType		equ 3MBankType		equ 4;Test ControlMStore			equ 0MCheck			equ 1MStoreAndCheck		equ 2MMapStore		equ 3MMapCheck		equ 4MMapStoreAndCheck	equ 5MSizeStore		equ 6MSizeCheck		equ 7MSizeStoreAndCheck	equ 8;Data ControlMIncData		equ 1MIncDataType		equ 2;Fault ControlMNoError		equ 0MDataError		equ 1MMapDataError		equ 2MMemSizeError		equ 8MemDataInc equ 01h;-----------------------------------------------------------------DVTCBlock  STRUC  DVIntCount DW  0DVObservedIntCount DW  0DV17IntCountH DW  0DV17IntCountL DW  0DV19IntCountH DW  0DV19IntCountL DW  0DVSpare0 DB  0DVSpare1 DB  0DVFault DB  0DVErrorControl DB  0DVTCBlock ENDSDVNoCount equ 0DVCheckCount equ 1;Fault ControlDVNoError equ 0DVNointerrups equ 1DVIntTooLow equ 2DVIntTooHigh equ 4DVIntInBetween equ 8;-----------------------------------------------------------------         	error13			equ	13   ;ChA ExtStat Int	error14			equ	14   ;A Receive Data Error	error15			equ	15   ;ChA Special Int	error16			equ	16   ;ChB ExtStat Int        error17			equ	17   ;B Receive Data Error	error18			equ	18   ;ChB Special Int	  ;these are the parameters for wr0 and other miscleneous        	RstTxIntPending		equ	028h	RstExtInterupt		equ	010h	RstCrcCheck		equ	040h	RstCrcGenerator		equ	080h	RstTxEomLatch		equ	0c0h	  ;these are the parameters for wr1 register 		ExtIntEnable		equ	01	VarVector		equ	04	RxInteruptAll		equ	018h	TxIntEnable		equ	02 	 ;these are the parameters for the wr2 register  	BothInterupt		equ	0	Mode8086		equ	010h	VectorInterupt		equ	020h	NoInterupt		equ	0	RxPriority	        EQU	004h	;these are constants for wr3 register	receiver section        RxCRCEnable	EQU	008h	Hunt			EQU	010h	RxEnable		equ	1 	AutoEnable		equ	020h	RxFiveBitChar		equ	0h	RxSixBitChar		equ	080h	RxSevenBitChar		equ	040h	RxEightBitChar		equ	0c0h	AddressSrch		equ	4h	 ;these are constants for wr4 register 	ParityEnable		equ	01	EvenParity		equ	02h	OddParity		equ	0 	OneStopBit		equ 	04h	OneAndHalfStopBit	equ	08h	TwoStopBit		equ	0ch	X1Clock			equ	0h	X16Clock       		equ	040h 	X32Clock		equ	080h	X64Clock		equ	0c0h 	SyncMode		equ	0	SDLCFlagMode		equ	020h	  ;these are parameters for wr5 register transmit section        CRC16		EQU	004h        TxCRCEnable	EQU	001h  	EnableRts		equ	02h	EnableDtr		equ	080h	EnableRtsDtr		equ	082h	TxEnable		equ	08h	TxFiveBitChar		equ	0h 	TxSevenbitChat		equ	020h	TxSixBitChar		equ	040h	TxEightBitChar		equ	060h ;these are constants for wr7 register 	SDLCFlag		equ	07Eh  ;these are parameters for rr0 register    	RxCharReady		equ	01h	TxBufferEmpty		equ	04h	  ;these are parameters for  rr1  register      	AllSent         	equ	01	RecOverRun		equ	020h	CrcError		equ	040h  	CarrierDetect		equ 	08	ClearToSend		equ	020h			;---------------------------------------------------------------------------- ;this is the testblock for the rs232 program RSTCBlock	STRUCRSSpare0		db	0  				RsTest			db	0RsDataA			db	0 RsDataB			db	0 RsACount	 	dW	0 RsBCount		dW	0RsCTxACount	 	dW	0 RsCRxBCount		dW	0RsCTxBCount		dW	0RsCRxACount	 	dW	0 RsTxABufP	 	dW	0 RsRxBBufP		dW	0RsTxBBufP		dW	0RsRxABufP	 	dW	0 RsTimerValue		db	0RsFault			db	0				  RSTCBlock	 ENDS   ;---------------------------------------------------------------------	       ;this is the timer macro        ;agr1 is the  channel address for the format of the timer       ;arg2 is the  the division rate port address 2 bytes           %*define(timer(arg1,arg2))(    	 mov	al,%arg1+i8254lsbthenMsb+i8254Sqwave+I8254BinaryCount	 out	i8254Ctlr,al	 mov	al,[bx].RsTimerValue	 out	%arg2,al	 mov	al,0	 out	%arg2,al	 ) 	        ;this is the rs232 macro        ;arg1 is the chanel address       ;arg2 is the  internal register address  wr0..wr5       ;arg3 is the   actual  register format             %*define(rs232command(arg1,arg2,arg3))(           mov	dx,%arg1 	   mov	al,%arg2	   out	dx,al	   mov	al,%arg3	   out	dx,al 	   )	   ;-----------------------------------------------------------------; Interrupt  Controller -- Master i8259A;; [Programming information on Page 2-120 of ; the Intel '84 Microsystem Components Handbook];;;  Other 80186 Internal Control registers addressesFDDnotConnected	EQU 40H;FDC test KindRecalKind	EQU 01H			;ReadID		EQU 02H			;WriteSector	EQU 04H			;ReadSector	EQU 08H			;WrtDelSector	EQU 10H			;RdDelSector	EQU 20H			;FormatCyc	EQU 40H			;MoreHeads	EQU 01H			;MoreCylinders	EQU 02H			;MoreUnits	EQU 04H			;;FDC commandsfdcReadCmd	EQU 06H			;Read Command.ReadATrackCmd	EQU 02H			;Read a Track Command.ReadIDCmd	EQU 0AH			;Read ID Command.fdcSpecify	EQU 03H			;Holds the Specify Command.fdcRecal	EQU 07H			;Holds the Recalibrate Command.StepRate	EQU 0D0H		;Holds the Step Rate @ 6mS neg number.;FDC parametersHUT		EQU 01H			;Holds the Head Unload Time @16mS.;fdcRWGapLength	EQU 2AH			;Holds the Read/Write gap length.DmaMode	 	EQU 00H			;Holds the to DMA or not to DMA = 0 + HLT bit 0 = 1HLTime		EQU 0AH			;HLTime = 20 mSfdcMinCylinder	EQU 00H			;Minimum cylinder numberfdcMinHead	EQU 00H			;Minimum head numberfdcMaxHead	EQU 04H			;Maximum head numberfdcMinSector	EQU 01H			;Minimum sector number;fdcMaxSector	EQU 09H			;Maximum sector numberFloppyIntEnable EQU 0DFEFH		;FloppyInterruptEnable;;FDC test parametersfdcNoStop	EQU 01H			;Don't stop for ErrorfdcIncDataByte	EQU 02H			;Inc daya each bytefdcNoheader	EQU 04H			;No header in datafdcIncDataSec	EQU 08H			;Inc data each secfdcNoMemParity	EQU 80H			;Don't Log Parity Errors;;*******************************************************;  	FDCTCBlock	STRUC			;FDC Test Control Block Structure StartfdcDataAndErrCtl	DB 00H			;Error Control					;Bits 0= 0= Stop on Error					;40H= Initilize FDC										fdcTstCtl	DB 00H			;Holds the test to be performed					;01H= Recalibrate					;02H= Read ID					;04H= Write A Track					;08H= Read A Track                                        ;01H= Write A Deleted Sector					;02H= Read A Deleted Sector					;04H= Format a Cyc					fdcSHead	DB 00H			;Holds the Starting Head number.fdcSUnit	DB 00H			;Holds the Starting Unit number.					;00H= Unit 0				        ;01H= Unit 1				        ;02H= Unit 2				        ;03H= Unit 3					fdcSSector	DB 01H			;Holds the Starting Sector number.fdcSCylinder	DB 00H			;Holds the Starting Cylinder number.fdcEHead	DB 00H			;Holds the Ending Head number.fdcEUnit	DB 00H			;Holds the Ending Unit number.					;00H= Unit 0				        ;01H= Unit 1				        ;02H= Unit 2				        ;03H= Unit 3					fdcESector	DB 01H			;Holds the Ending Sector number.fdcECylinder	DB 00H			;Holds the Ending Cylinder number.fdcCHead	DB 00H			;Holds the Current Head number.fdcCUnit	DB 00H			;Holds the Current Unit number.					;00H= Unit 0				        ;01H= Unit 1				        ;02H= Unit 2				        ;03H= Unit 3					fdcCSector	DB 01H			;Holds the Current Sector number.fdcCCylinder	DB 00H			;Holds the Current Cylinder number.fdcSData	DB 01H			;Holds the Starting Data PatternfdcCData	DB 00H			;Holds the Current Data PatternfdcDriveType	DB 00H			;Holds the drive Type.					fdcSectorLength DB 02H			;Holds the Sector Length.				        ;00= (Sector Length=128)				        ;01= (Sector Length=256)				        ;02= (Sector Length=512)= IBM				        ;03= (Sector Length=1024)					fdcSkipDeletedData DB 00H		;To ignore Deleted Data (SK).				        ;00H= Do not ignore deleted Data				        ;20H= Ignore Deleted Data;;Returned information from diagnostics program;fdcST0		DB 0			;Status register 0	fdcST1		DB 0			;Status register 1fdcST2		DB 0			;Status register 2fdcRetries	DB 0			;Number of Read/Write missesfdcFault	DB 0			;Holds the Faults type					;1h= NoSeekStatus					;2h= WriteReadStatusCheck					;3h= ReadDataCheck					;4h= FDCStackFault					;5h= CpuNoDataRespond					;6h= Recalibrate					;7h= CMFlagResetOnSkipReadDel					;8h= FDCNoStatusResp					;9h= WriteProtected					;0Ah= ExessInterrupt					;0BH= NoInterruptFDCTCBlock	ENDS			;FDC Test Control Block Structure End;-----------------------------------------------------------------;ConstatntsISCPBase	EQU	0A0H	;temporarily 4x28H, Types 028h-029h ISCP				;Types 02Ah-02Bh E-Net SCB;CommandsCmdAddSetup	EQU	1	;Setup Individual AddressCmdConfig	EQU	2	;ConfigureCmdXmit		EQU	4	;TransmitCmdDump		EQU	6	;DumpCmdDiag		EQU	7	;Diagnose;InitChip	EQU	1	;Flag of 586 Initialization, should use DBAckCXCNA	EQU	0A000HAckFR		EQU	4000HStartCU		EQU	100HStartRU		EQU	10HELIntr		EQU	0A0HRecBufSize	EQU	2C0H	;704DEthLoopBk	EQU	83FFHRstENetIntr	EQU	0C0H;ENet test parametersENetNoStop	EQU 01H			;Don't stop for ErrorENetNoMemParity	EQU 80H			;Don't Log Parity Errors;;RegistersENetAttn	EQU	0A0H	;ENet Channel Attention Reg;ENetBlock	STRUC		;Ethernet Test Control Block Structure startENetRetryCount	DB 00H		ENetTstCtl	DB 01H		;00H= perform one Test  				;01H= perform all Tests 				ENetErrCtl	DB 00H		;Error Control				;Bits 0= 0= Stop on Error				ENetTstType	DB 00H		;Holds the test to be performed				;00H= IA Setup				;01H= Configure Cmd, Dump Cmd				;02H= Transmit with Receive (controller loopback)				;03H= Transmit without Receive (controller loopback)				;04H= Transmit with Receive (Interface loopback)				;05H= Transmit without Receive (Interface loopback)				;06H= Transmit with Receive (Wire loopback)				;07H=Transmit without Receive (Wire loopback)ENetPacketSize	DW 00H		;Size of Packet								ENetIntCount	DB 00H		;number of interrupts received				;only valid with EthIntrHandler fault				;08H= Diagnose Cmd				ENetFault	DB 00H		;Holds the fault type				;01H= Interrupt Count Error				;02H= SetUpISCP				;03H= No Reset				;04H= CU Error				;05H= Dump verify				;06H= Recieve Buffer Data error				;07H= Recieve Buffer Bad On Xmit Only				;08H= Xmit Error				;09H= Recieve ErrorENetBlock	ENDS		;Ethernet Test Control Block Structure end