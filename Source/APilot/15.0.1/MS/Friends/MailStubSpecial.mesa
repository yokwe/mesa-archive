-- Copyright (C) 1984  by Xerox Corporation. All rights reserved. -- MailStubSpecial.mesa  -  tool/server-only use of MailStub.-- last edited by Wobber,   5-Jan-84 14:02:51  DIRECTORY  Auth USING [IdentityHandle],  Courier USING [Description],  MailAttributes USING [MessageStatus],  MailTransport USING [MessageID, Postmark],  NSDataStream USING [Source],  NSName USING [Name, NameRecord],  System USING [GreenwichMeanTime, NetworkAddress, nullNetworkAddress];  MailStubSpecial: DEFINITIONS =  BEGIN    -- TYPES    ForwardData: TYPE = LONG POINTER TO ForwardDataRecord;  ForwardDataRecord: TYPE = RECORD [    myName, destName: NSName.Name,    created: MailTransport.Postmark, id: MailTransport.MessageID,    size: LONG CARDINAL, status: MailAttributes.MessageStatus,    where: System.NetworkAddress, source: NSDataStream.Source];  ForwardResult: TYPE = MACHINE DEPENDENT {    done(0),    abortedByClient(1), serverNotAccepting(2), serverTooBusy(3),     destinationNotMe(10), credsInvalid(11), credsRefresh(12),    formatError(20), mediumTooFull(21), trySmallerMessage(22), messageTooBig(23),    other(30) };      MailboxPropertyRecord: TYPE = RECORD [    timestamp: System.GreenwichMeanTime,    servers: LONG DESCRIPTOR FOR ARRAY OF NSName.NameRecord];    -- format of mailbox property on user CH name.    ServerPollCallback: TYPE = PROCEDURE [addr: System.NetworkAddress,    willingness: CARDINAL, serverName: NSName.Name] RETURNS [continue: BOOLEAN];    TestMode: TYPE = MACHINE DEPENDENT {    off(0), test1(1), test2(2), test3(3), (177777B)};  nullAddress: System.NetworkAddress = System.nullNetworkAddress;      -- set/clear test flags for parametrizing stub    AllowLocalCalls: PROCEDURE;		-- reset for DisallowLocalCalls  DisallowLocalCalls: PROCEDURE;     -- forces stub to use courier machinery.  GetPostingSlot: PROC RETURNS [System.NetworkAddress];  SetPostingSlot: PROC [addr: System.NetworkAddress ¬ nullAddress];    SetTestMode: PROC [type: TestMode];  TestModeActive: PROC RETURNS [TestMode];      -- allow tools to do an expanding ring server poll broadcast    ServerPollBroadcast: PROCEDURE [    identity: Auth.IdentityHandle, callback: ServerPollCallback];    -- back door into normal stub ops (all generate Courier.Error    ForwardMsg: PROC [identity: Auth.IdentityHandle, data: ForwardData]    RETURNS [ForwardResult];  QueryUp: PROC [whatServer: NSName.Name, where: System.NetworkAddress]    RETURNS [up: BOOLEAN];  SendCacheFlush: PROC [where: System.NetworkAddress, who: NSName.Name];      -- description proc of mailbox CH property    MailboxPropertyDescription: Courier.Description;    END.       