-- File: CHStub.pack - last edit:-- AOF                 22-Apr-85  8:27:43-- last edit by BLyon,   5-Oct-83 13:09:03-- last edit by read,    9-Jul-84 15:19:11-- last edit by Gealy,  30-Aug-84  1:49:01-- Copyright (C) 1983, 1984, 1985 by Xerox Corporation. All rights reserved.CHStubCode: SEGMENT =  BEGIN    CommonSupportCHStubForStubs: CODE PACK =    BEGIN    NSAddrImpl [ENTRY VECTOR, DescribeAddress, FreeAddress, RhsToAddress,      FirstNearerThanSecond, SelectNearestAddress, CompareAddresses];    END;       -- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  -- The follow collection of code contains routines that are common to both  -- that Clearinghouse client and the Clearinghouse server.  (Some stuff  -- was put in her because it fit without overflowing a min page count.)  --  This is also the beginning of the "meat" of the Clearinghouse Stub.     CHStubServerCommon: CODE PACK =    BEGIN    CHSorter [ENTRY VECTOR, CATCH CODE, GetAHeap, ReleaseAHeap,      MakeATwig, DestroyATwig, MakeSorter, Destroy, DumpTree,      DumpElements, AddElement, AddElementToBalancedTree, SetLink,      GetLink, SingleRotate, DoubleRotate, ConnectRebalancedSubtreeToTree,      ExtractName, ExtractUserData, NullCallBack, FindElement, ValidateTree,      GetHeapParameters];    CHMUXer [ENTRY VECTOR, CATCH CODE, DescribeAuthResults, DescribeParm,      DescribeTimestamp, FreeParm, MakeCallParameter, DescribeNewResult,      DescribeOldResult, FreeResult, MakeReturnParameter, GetCourierInfo,      GetVersion, GetPreferredVersion, IsThereAnAlternateVersion,      GetAlternateVersion, AlterPreferredVersion];    CHStreamer [ENTRY VECTOR, CATCH CODE, BeginRead, EndRead,      BeginWrite, EndWrite, ActiveReadNames, ActiveWriteNames, WriteCHName];    CHStatsHot [ENTRY VECTOR, CATCH CODE, StatIncr];    StubImpl [ENTRY VECTOR, CopyNames, NameShift, CheckName, CheckString];    CHStubImpl2 [ENTRY VECTOR];    END;  -- four pages    -- - - - - - - - - - - - - - - - -    -- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  -- The follow collection of code contains routines that are the "meat"  -- of the Clearinghouse client.    CHStubHot: CODE PACK =    BEGIN    StubImpl [CommonDispatcher, StubDispatcher, FindAddress, ProcessResults,      MoveLocalToUserArea, RegisterServer];    CHNameToAddrMapper [ENTRY VECTOR, CATCH CODE, FindDomainAddr,      FindDomainAddrInternal, FindValidAddr, GetDefaultServerAddress,      GarbageCollect, AddressMappingsInFlux, FindOrgAddrInternal,      LookInDomainTree, IsDomainAvailable];    CHStreamer [ReadCHName, FreeName];    CHStubImpl2[LookupDistinguishedName];    END;  -- four pages     CHStubPacketExchanger: CODE PACK =    BEGIN    StubImpl [PacketExchangeControl, PokeTheStub];    CHStubImpl2 [LookupValueProperty];    END;  -- one pages max free 30    CHStubCourier: CODE PACK =    BEGIN    StubImpl [CATCH CODE, CourierControl, CommonDirectedCaller];    CHStubImpl2 [Enumerate, LookupAliasesOfName];    END;  -- three pages max    CHStubQuerySub1: CODE PACK =    BEGIN    StubImpl [AllocateProperties];    CHStubImpl2 [FreeProperties, GetProperties, IsMember, IsMemberClosure];    END;  -- free 60    CHStubQuerySub2: CODE PACK =    BEGIN    CHStubImpl2 [LookupGroupProperty, EnumerateAliases];    END;  -- free 90    CHStubQuerySub3: CODE PACK =    BEGIN    CHStubImpl2 [EnumerateDomains, EnumerateOrganizations];    CHNameToAddrMapper [FindOrgAddr]    END;  -- free 68    CHStubUpdates: CODE PACK =    BEGIN    CHStubImpl2 [AddDistinguishedName, AddAlias, AddValueProperty,      AddGroupMember, AddSelf, AddGroupProperty];    END;  --     CHStubDeletes: CODE PACK =    BEGIN    CHStubImpl2 [DeleteDistinguishedName, DeleteAlias, ChangeValueProperty,      DeleteProperty, DeleteGroupMember, DeleteSelf];    END;  -- free 258    CHACLHandler: CODE PACK =    BEGIN    CHStubImpl2 [CATCH CODE, LookupPropertyAccess, LookupDomainAccess,      LookupOrgAccess, IsMemberOfPropertyAccess, IsMemberOfDomainAccess,      IsMemberOfOrgAccess, AddPropertyAccessMember,      DeletePropertyAccessMember, AddDomainAccessMember,      DeleteDomainAccessMember, AddOrgAccessMember, DeleteOrgAccessMember];    END;    CHStubNameCacheHintProcessor: CODE PACK =    BEGIN    CHNameToAddrMapper [ProcessHint, NoteBusyServer, FindANewCloseCH,      InvalidateAddr, InvalidateAddrNode, FlushAddr, AddNewOrg,      AddNewDomain, AddNewAddr, FindAddrNode, MaybeValidateInvalidAddrNode,      ProbeServerList, InvalidateWrongServerAddr];    END;  -- ok (free 108)    CHStubNameCacheBuilder: CODE PACK =    BEGIN    CHNameToAddrMapper [RestartTheCache, NoteLocalServer,      BuildCHServerAddrList, BuildPreferredCHServerAddrList,      BuildCHServerAddrListInternal, FreeAddrList, EnumerateNearbyDomains];    StubImpl [EnumerateYourDomains, WhoAreYou];    END;  -- ok  -- - - - - - - - - - - - - - - - -    -- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  -- The follow collection of code has nothing to do with Clearinghouse stubs.  -- It implements higher level client routines.  (Some cooler routines  -- are put here just to fill in space).    CHStubClientUtilitiesHot: CODE PACK =    BEGIN    CHClientUtilities [ENTRY VECTOR, CATCH CODE, MakeRhs, FreeRhs,      SerializeIntoRhs, ScopedSerializeIntoRhs, MakeConversationHandle,      FreeConversationHandle, DeserializeFromBlock];    CHEntriesImpl [ENTRY VECTOR, CATCH CODE, DescribeUserData,      DescribeAddressList, DescribePrimary];    CHEntriesExtrasImpl [ENTRY VECTOR, CATCH CODE, DescribeAuthenticationLevel, DescribeCIUBack];    CHCommonLookupsImpl [ENTRY VECTOR, CATCH CODE, LookupAddress,      LookupStringProperty, LookupNameProperty, LookupAnyValueProperty];    CHSorter [GetElementCount];    END; -- ok, two pages max     CHStubClientUtilitiesSub1: CODE PACK =    BEGIN    CHEntriesImpl [DescribeAdobeSystemData, DescribeIBM3270HostData,      DescribeSiemens9750HostData, DescribeRS232CData, DescribeIBM3270Controller, DescribeIBM3270Device, DescribeIBM3270HostBack, DescribeSiemens9750Controller, DescribeRS232CBack];      CHEntriesExtrasImpl [DescribeSiemens9750HostData, DescribeSiemens9750Controller, DescribeSiemens9750Device];    NSAddrImpl [GetAddress];    END;  -- ok, one page max     -- - - - - - - - - - - - - - - - -    -- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  -- The parts of Clearinghouse stub that are cool to very cold.    CHStubCoolCrud: CODE PACK =    BEGIN    CHNameToAddrMapper [AddToUnavailableDomains];    CHSorter [SwapNodeToDeleteWithLeaf, DeleteElement, DeleteFromList];    NSAddrImpl [CATCH CODE, FreeRhsStorage, AddressToRhs];    END;    -- The follow collection of code has nothing to do with Clearinghouse stubs.  -- It implements the old Clearinghouse protocol translator.    VeryColdCHStub: CODE PACK =  -- but just in case we keep them away from MAINS    BEGIN    NSAddrImpl [Init];    CHStatsHot [StatBump, StatGetCounter];    CHMUXer [GetMUXHeap, SetTestMode];    CHClientUtilities [ShowDefaultName];    CHStreamer [ReadBlocks, WriteBlock];  -- not supported in services 5    StubImpl [      RemoteIHaveYourName, RemoteNewDumpObject, CompareObject, GetDomainSize,      EnumerateChecksumAndGts];        -- not supported in services 5    CHStubImpl2 [DumpObject, EnumerateObjects];    CHStubExtrasImpl; -- ??this is temporary for inhouse update    END;  -- - - - - - - - - - - - - - - - -    CHStubMAINS: CODE PACK =    BEGIN    CHMUXer [MAIN];    NSAddrImpl [MAIN];    StubImpl [MAIN];    CHStubImpl2 [MAIN];    CHNameToAddrMapper [MAIN];    CHStreamer [MAIN];    CHSorter [MAIN];    CHStatsHot [MAIN];    CHClientUtilities [MAIN];    CHCommonLookupsImpl [MAIN];    CHEntriesImpl [MAIN];    CHEntriesExtrasImpl [MAIN];    END;    END;CHStubFrames: FRAME PACK =  BEGIN  CHStub.NSAddrImpl;  CHStub.StubImpl;  CHStub.CHMUXer;  CHStub.CHStubImpl2;  CHStub.CHStubExtrasImpl;  CHStub.CHStreamer;  CHStub.CHStatsHot;  CHStub.CHClientUtilities;  CHStub.CHNameToAddrMapper;  CHStub.CHSorter;  CHStub.CHCommonLookupsImpl;  CHStub.CHEntriesImpl;  CHStub.CHEntriesExtrasImpl;  END;