-- Copyright (C) 1983  by Xerox Corporation. All rights reserved. -- ResidentHeap.mesa    1-Apr-83 13:47:11 by AWL      -- This interface provides a Zone (small object allocator) for resident (non-swapping) storage in HeapLocations parts of VM.  Objects can be accessed via 16-bit relative pointers.DIRECTORY  Environment USING [Base, first64K],  PSB USING [PDA],  Zone USING [Alignment, BlockSize, Handle, Status];ResidentHeap: DEFINITIONS =  BEGIN  Location: TYPE = {  -- regions of virtual memory.    first64K,  -- Used for I/O control blocks, etc.    pda,  -- Process Data Area. Used for state vectors, etc.    mds,  -- Main Data Space. Used for local frames, etc.    hyperspace};  -- Used for data whose location is unimportant.  HeapLocation: TYPE = Location [first64K..pda];  -- Regions of VM for which Resident Heaps exist.  Alignment: TYPE = Zone.Alignment;  --	Alignment of allocated objects.  -- = {a1 (word aligned), a2 (double word aligned), a4 (quad word aligned),  --    a8 (eight-word aligned), a16 (16-word aligned)}  -- Base pointers for the Zones (both individual and indexable copies):  first64K: Environment.Base = Environment.first64K;  pda: Environment.Base = PSB.PDA;  base: ARRAY HeapLocation OF Environment.Base = [first64K, pda];  -- Handles for the Zones (not normally needed by clients):  residentZone: READONLY ARRAY HeapLocation OF Zone.Handle;  MakeNode: PROCEDURE [    n: Zone.BlockSize, alignment: Alignment ¬ a1,    location: HeapLocation ¬ first64K]    RETURNS [node: Environment.Base RELATIVE POINTER, s: Zone.Status];  -- Allocates a resident node in the given Zone.  -- Nodes less than a half page in size are guaranteed not to cross a page boundary.  FreeNode: PROCEDURE [    p: Environment.Base RELATIVE POINTER, location: HeapLocation ¬ first64K]    RETURNS [s: Zone.Status];  -- Frees a node in the given Zone.  SplitNode: PROCEDURE [    p: Environment.Base RELATIVE POINTER, n: Zone.BlockSize,    location: HeapLocation ¬ first64K] RETURNS [s: Zone.Status];  END.LOGMay 31, 1979  2:56 PM	HXL     Created file.July 18, 1979  2:54 PM	WDK       Promoted Base and first64K into Environment.29-Sep-82  9:59:11	AWL         Added Locations and HeapLocations.  Added location argument to all procedures.28-Oct-82  9:36:47   WDK        Added pda and base. residentZone becomes an array. Improved documentation. 1-Apr-83 13:47:07	AWL         Deleted NodeSize - it is unused.