-- Copyright (C) 1983, 1986  by Xerox Corporation. All rights reserved. -- KernelFile.mesa  17-Nov-86 16:23:22 by RSV      -- This Private interface supplies File-level facilities to higher level parts of PilotKernel and OthelloOpsImpl.DIRECTORY  BackingStore USING [Run],  Boot USING [BootFileType],  Device USING [Type],  File USING [File, ID, PageCount, PageNumber, Type],  PilotDiskFace USING [DiskAddress],  Volume USING [ID, PageNumber];KernelFile: DEFINITIONS =  BEGIN  -- TYPEs:  FilePtr: TYPE = LONG POINTER TO Descriptor;  ReadOnlyFilePtr: TYPE = LONG POINTER TO READONLY Descriptor;  Descriptor: TYPE = RECORD [    fileID: File.ID,    volumeID: Volume.ID,    temporary: BOOLEAN,    size: File.PageCount,    type: File.Type];  PageGroup: TYPE = RECORD [    filePage: File.PageNumber,    volumePage: Volume.PageNumber,    nextFilePage: File.PageNumber];  -- Procedures:  GetBackingStoreRunWithCache: PROCEDURE [    file: File.File, page: File.PageNumber, type: File.Type,    cache: Cache]    RETURNS [run: BackingStore.Run, resultType: File.Type];  -- Same semantics as SpecialFile.GetBackingStoreRun except for the presence  -- of cache, which provides imporoved performance when it "hits".  -- If cache = NIL, then the semantics are identical.  -- If cache is not NIL, then cache will be used to satisfy the request  -- without bothering the ETable files.  In this case, the cache is updated  -- with the best information (either the new run or the old run).    Cache: TYPE = LONG POINTER TO BackingStore.Run;    GetBootLocation: PROCEDURE [file: File.File, filePage: File.PageNumber]    RETURNS [deviceType: Device.Type, deviceOrdinal: CARDINAL,     diskAddress: PilotDiskFace.DiskAddress];  -- Returns Device ordinal, Device type, and disk address of given boot  -- file and page.    GetFileAttributes: PROCEDURE [file: File.File]    RETURNS [size: File.PageCount, readOnly: BOOLEAN];  -- readOnly reflects the status of file.volume.  -- May raise File.Unknown, Volume.Unknown,  --   Volume.NotOnline,Volume.NeedsScavenging, Volume.NotOpen.  GetRootFile: PROCEDURE [volume: Volume.ID, type: File.Type]    RETURNS [file: File.ID];  -- Gets file of given (Root) type from volume root page  --   type must be IN PilotFileTypes.PilotRootFileType.  -- May raise File.Unknown, Volume.Unknown,  --   Volume.NotOnline,Volume.NeedsScavenging, Volume.NotOpen.  MakeBootable: PROCEDURE [    file: File.File, firstPage: File.PageNumber, count: File.PageCount,    type: Boot.BootFileType]    RETURNS [link: PilotDiskFace.DiskAddress];  -- Establish mechanism for identifying page groups of bootfile, starting with  -- the specified first page and continuing for the length of the contained  -- Pilot boot file.  -- Returns value appropriate for whatever loads that type of bootfile.  -- If firstPage+count > size of file, InvalidParameters is raised;  -- Also File.Unknown, File.MissingPages, Volume.Unknown, Volume.NotOnline,  -- Volume.NotOpen, Volume.NeedsScavenging, and Volume.ReadOnly may be raised.  MakeUnbootable: PROCEDURE [    file: File.File, firstPage: File.PageNumber, count: File.PageCount];  -- Remove mechanism for identifying page groups of bootfile.  -- firstPage must be the same file page that was given to MakeBootable.   -- If firstPage+count > size of file, InvalidParameters is raised;  -- Also File.Unknown, Volume.Unknown, Volume.NotOpen,  -- Volume.ReadOnly may be raised.  PutRootFile: PROCEDURE [file: File.File, type: File.Type];  -- Remembers file in volume's root page.  file's type must be IN  --   PilotFileTypes.PilotRootFileType  -- May raise File.Unknown, File.MissingPages, Volume.Unknown,  --   Volume.NotOnline,Volume.NeedsScavenging, Volume.NotOpen.  END.LOG   (for earlier entries, see Mesa 8.0 archive version) 7-June 82 15:52:00   LXD         Deleted CreateWithID, ExistingFile, GetFilePoint, LogContents, MakeMutable,   Pin,  SetRoot File,  Unpin;  added PutRootFile.   File.Capability becomes File.ID, Volume.ID pair instead in Klamath.30-Nov-82 11:48:10   JXP      Remove GetNextFile (moved to VolFileMap). Add contents of old FileInternal;   namely, AllocationStatus, FilePtr, Descriptor, and PageGroup. Use File.File13-Dec-82 15:45:18   JXP      Remove AllocationStatus (not used). Don't default filePage in GetBootLoc.30-Mar-83 14:35:48   WDK        MakeBootable etc moved here from SpecialFile. Improved doc.25-Oct-83 11:38:02   AWL         Add GetBackingStoreRunWithCache. 3-Jul-86 10:58:31   CAJ         Add type parameter to MakeBootable; comments no longer describe "boot chain link" mechanism.17-Nov-86 16:23:22   RSV   Changed comment for GetBackingStoreRunWithCache to talk about ETables.