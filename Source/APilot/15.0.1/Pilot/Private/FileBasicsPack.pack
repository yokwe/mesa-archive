-- Copyright (C) 1982, 1983, 1984, 1986, 1987, 1988  by Xerox Corporation. All rights reserved. --21-Jun-88 18:40:31  RSV--   Added FinishWithSequence to FileCreateDelete.  Added BugV to--   FileBasicsBugAndCatchCode.--20-Nov-87 10:13:57  KEK per RSV--   Moved GetNextLV from VolTableSeldomUsed to VolTableCommon.  Moved FreeLV--   and CreateLVEntry from OtherAccess to VolTableCommon.  Moved GetNextPV and--   GetNextSV from VolTableSeldomUsed into new pack BackingStoreRunSupport.--   Moved PVAccess from OtherAccess to BackingStoreRunSupport.  Moved--   GetBSChannel from ManipulateVolumeData to BackingStoreRunSupport.-- 1-May-87 10:15:27  RSV--   Added ReplaceOldETableInternal to FileSetSize.--12-Mar-87 16:41:58  RSV--   Deleted RealUpdatePhysicalMarkerPages from BuildingVolumes.-- 6-Feb-87 16:10:22  RSV--   Deleted OldMakeFileList and OldMakeFileListInternal.--29-Jan-87 16:09:10  RSV--   Added OldMakeFileList and OldMakeFileListInternal.--17-Nov-86 17:37:42  RSV--   Added GetVolumeIndex.-- 5-Nov-86 16:38:56  RSV--   Added SetTemporaryInternal and GetPageGroupInternal from ETableImplB.--22-Oct-86  9:49:18  RSV--   Deleted UnmapImageLog from ETableImplA.--20-Oct-86 15:47:02  RSV--   Deleted MapLVRootPage, Verifier, MapImageLog, and UnmapLVRootPage from--   ETableImplA.-- 7-Oct-86 13:52:22  RSV--   Added CreateETableInternal from ETableImplB.-- 2-Sep-86 11:46:09  RSV--   Added ETableImplC stuff, took out MakeFileList from ETableImplA.--26-Aug-86 13:49:09  RSV --   Added MapDuplicatePVRootPage and UnmapDuplicatePVRootPage to--   BuildingVolumes.  Added ReadPVLabelAndData to SeldomUsedLabelOperations.--   Get rid of LabelTransferImpl operation and change them to reflect--   DataTransferImpl.  Also get rid of SimpleFileImpl.ReadLabel.  Added--   MakeFileListInternal to FileMapSeldomUsed.  Finally, added ClearLog--   to FileMapSeldomUsed.--12-Jun-86 12:53:22--   Deleted VolFileMapImpl and add ETableImplA and ETableImplB entries in packs.--   Added GetLVHandle and GetLVID from VolTableImpl to VolTableSeldomUsed pack.--   Delete ReadLabel (since labels will no longer exist) from SimpleFileImpl.--   Delete HandleBSError from SimpleFileImpl (was in FileBasicsBugAndCatchCode).--   Added ReadPVLabelAndData to LabelOperationsSeldomUsed.  Changed names of--   GetVFMContext and SetVFMContext to GetETableContext and SetETableContext--   respectively. --13-Nov-84 17:36:21   Added FindSVInternal to VolTableCommon.--17-Sep-84 15:54:45   Added RealVerifyLabelsAndData to CommonLabelOperations. --12-Jan-84 13:45:55   Split FileAttributes to FileAttributes and FileGetFileDescriptor-- 4-Jan-84 13:45:57	CATCH CODE now exists for VolFileMapImpl-- 4-Sep-83 15:00:35   Shuffle things around to improve working--   set. Also add HandleBSError from module SimpleFileImpl.--28-Jul-83 10:58:00--   Remove ReportErrorToDebugger from VolBackingStoreImpl's code.--21-Jul-83 10:29:33--   Remove ReportErrorToDebugger from LabelTransferImpl's code.--23-May-83 11:25:21   Refinements to many of the code packs.--23-May-83 11:25:21--   Move Begin and End OperationSequenceInternal to VolTableCommon.--16-May-83 19:00:57   Refinements to many of the code packs.--10-May-83 14:18:24--   Put ReadLabel from SimpleFileImpl in Mapping CODE PACK (no longer an--   embedded proc). --28-Mar-83 11:42:48--   DiskBackingStoreImpl.GetDiskChannel moves to a resident code pack. The--   SwappableDiskBackingStore CODE PACK goes away.-- 3-Mar-83 10:10:50--   New Procedure, Open, in VolFileMapImpl. VolTableImpl.GetStatus=>GetLVStatus--16-Feb-83 13:42:16--   New VolTableImpl procs: TableLockStatus, LockStatus, AcquireLock, Unlock, UnlockSVInternal, LockRemainingSVs, UnlockRemainingSVs, EndOperationSequence, EndOperationSequenceInternal, BeginOperationSequence, BeginOperationSequenceInternal, ForceConsistencyInternal, GetOperationSequenceCount, CreateLVEntry, FreeLV. Some VolTableImpl procs disappeared. Moved Mapping earlier as dictated by loc of EV. Moved Get, Lower, Find, GetBuffer, ReleaseBuffer, GetVFMContext to Mapping; RealReadLabelAndData to SeldomUsedLabelOperations. Split FileCreateDelete out of FileSetSize. Split frames into swappable and resident. Reordered code packs. Moved some frames to resident.--12-Jan-83 11:52:42	Name Changes in VolTableImpl.-- 4-Jan-83 20:27:36	Add RegisterPVMarkerID.--24-Dec-82 11:32:39	Twiddles.--20-Dec-82 17:51:35	Created File.FileBasics: SEGMENT =BEGINSpecialResident: CODE PACK =  -- Must be first.  BEGIN  DiskBackingStoreImpl [    ENTRY VECTOR, AwaitError, GetHandleRec, NewChannelRecord,    RegisterChannel, RegisterErrorProcess, ReleaseHandle,    RemoveErrorProcess, ReportErrorToDebugger, Restart, Transfer];  VolBackingStoreImpl [ENTRY VECTOR, Transfer];  VolTableImpl [ENTRY VECTOR, Bug, BugV, GetID];  END;ResidentRunFast: CODE PACK =  -- This code is put in normal memory so it will run faster. Should be second.  -- GetDiskChannel is included since it is called from VolBackingStore.Transfer  BEGIN  DiskBackingStoreImpl [    GetDiskChannel, GetDiskChannelInternal, TransferInternal];  END;VolTableCommon: CODE PACK =  BEGIN  VolTableImpl [    AcquireLock, BeginOperationSequenceInternal, ConstructSVDesc,    CreateLVEntry,  -- (usually called from CreateSVEntry)    DecrementLocksOutstanding, EndOperationSequenceInternal, FindLV, FindSV,    FindSVInternal, ForceConsistencyInternal,    FreeLV, -- (usually called from UnlockSVInternal)    GetETableContext, GetLVStatus,    GetNextLV, GetSVToken, GetVolumeIndex, LVAccess,    LockStatus, SetETableContext, SVFromLVID, TableLockStatus, Unlock];  END;FileMapOftenUsed: CODE PACK =  BEGIN  ETableImplA [    ENTRY VECTOR, AcquireLVBucketInfo, ConvertTypeToID,    FindBucketInfoByLVID, ReleaseLVBucketInfo];  ETableImplB [    ENTRY VECTOR, DoBucketIO, DoOverflowIO, FindETable, Hash,    SearchOverflow, WhereIsFilePageOnVolume];  VolAllocMapImpl [ENTRY VECTOR, RealClose];  END;BasicGetBSData: CODE PACK =  BEGIN  SimpleFileImpl [ENTRY VECTOR, GetBackingStoreData];  END;BackingStoreRunSupport: CODE PACK =  BEGIN  VolTableImpl [    GetNextPV, GetNextSV, PVAccess, GetBSChannel];       -- GetBSChannel is called by SpecialFile.InterpretBackingStoreRun  END;CommonDataOperations: CODE PACK =  BEGIN  DataTransferImpl [    ENTRY VECTOR, Perform, RealVerifyData, RealWriteData, SubmitRequest];  END;FileCreateDelete: CODE PACK =  BEGIN  VolAllocMapImpl [FreePageGroup, GetBackwardPool, GetPool, MapVamPage];  ETableImplA [FinishWithSequence, GrowOverflow];  ETableImplB [AddToOverflow, CreateETable, CreateETableInternal, DeleteETable,    DeleteETableInternal, MakeNewETable, ReplaceOldETable];  END;FileCreate: CODE PACK =  BEGIN  VolAllocMapImpl [    AllocPageGroup, BitState, SearchVamRange, SetPageGroupInternal];  END;FileMapSeldomUsed: CODE PACK =  BEGIN  ETableImplA [    AddBuckets, ClearLog, CopyPrimariesToCopies, DoHeaderIO, UnmapHeader,    MapETFETable, MapRuns, GetBSRuns, ETFileETableCopyOut, GetPages,    GetLongerSequence, MapBucketHandle, Logger, UnmapETFETables,    MapOverflowWindow, UnmapOverflowWindow, WriteBucketHeaders];  ETableImplB [    GetCurrentETFileSize, ReplacePage, ReplacePageInternal, SetBootable,    SetTemporary, SetTemporaryInternal];  ETableImplC [    ENTRY VECTOR, MakeFileList, MakeFileListInternal];  END;FileSetSize: CODE PACK =  BEGIN  -- separating this from FileCreateDelete makes it a page smaller.  ETableImplB [InsertPageGroup, ReplaceOldETableInternal, ShrinkLastPageGroup];  SimpleFileImpl [SetSize, SetSizeInternal, GrowFile, ShrinkFile];  VolAllocMapImpl [ExpandAllocation];  END;FileAttributes: CODE PACK =  BEGIN  ETableImplB [    GetFileAttributes, GetFileAttributesInternal, GetPageGroup,    GetPageGroupInternal, GetSize];  SimpleFileImpl [    GetAttributes, GetAttributesInternal, GetPageGroup,    GetSize, GetSizeInternal];  END;FileGetFileDescriptor: CODE PACK =  BEGIN  SimpleFileImpl [GetFileDescriptor];  END;OtherAccess: CODE PACK =  BEGIN  VolTableImpl [    CreateSVEntry, FindPV, -- (usually called from UnlockSVInternal)    SVAccess, TableAccess, UnlockSVInternal];  END;ManipulateVolumeData: CODE PACK =  BEGIN  VolTableImpl [    AssertRootPageReadability,    GetClientData, GetDiskChannel, GetDrive, SetClientData, SetClosed,    SetOpen, SetReadOnlyStatus];  END;VolTableSeldomUsed: CODE PACK =  BEGIN  VolTableImpl [    BeginOperationSequence, ChangeSubVolume, EndOperationSequence,    ForceConsistency, GetLVHandle, GetLVID,    GetOperationSequenceCount, LockEntireLV, LockRemainingSVs,    UnlockRemainingSVs];  END; VolumeOpen: CODE PACK =  BEGIN  ETableImplA [Open];  END;VolumeClose: CODE PACK =  BEGIN  ETableImplA [Close];  END;BuildingVolumes: CODE PACK =  BEGIN  ETableImplA [CreateFile, DeleteFile, MinPagesForETables];  SimpleFileImpl [RealUpdateLogicalMarkerPages];  VolAllocMapImpl [PagesForVam, RealSetPageGroup];  VolTableImpl [    MapDuplicatePVRootPage, MapMarkerPage, MapPVRootPage,     UnmapDuplicatePVRootPage, UnmapMarkerPage, UnmapPVRootPage];  END;OnlineOffline: CODE PACK =  BEGIN  VolTableImpl [    MapLVRootPage, RegisterPVMarkerID,    SetLVOffline, SetPVOffline, SetSVOffline, SetLVOnline,  SetPVOnline,    SetSVOnline];  END;SeldomUsedDataOperations: CODE PACK =  BEGIN  DataTransferImpl [    DiskStatusToDataStatus, Log, ReadPVData, RealReadData];  END;FileBasicsBugAndCatchCode: CODE PACK =  BEGIN  DataTransferImpl [CATCH CODE, Bug, BugV];  SimpleFileImpl [CATCH CODE, Bug];  VolAllocMapImpl [Bug, CATCH CODE];  ETableImplA [Bug, BugV, CATCH CODE];  ETableImplB [Bug, CATCH CODE];  ETableImplC [CATCH CODE];  VolTableImpl [CATCH CODE];  END;FileBasicsInitialization: CODE PACK =  BEGIN   DiskBackingStoreImpl [InitDiskBackingStore, MAIN];  DataTransferImpl [InitDataTransfer, MAIN];  SimpleFileImpl [InitSimpleFile, MAIN];  VolAllocMapImpl [InitVolAllocMap, MAIN];  VolBackingStoreImpl [InitVolBackingStore, MAIN];  ETableImplA [InitETable, MAIN];  ETableImplB [MAIN];  ETableImplC [MAIN];  VolTableImpl [InitializeFileBasics, MAIN];  END;END;FileBasicsResidentFrames: FRAME PACK =  BEGIN  DiskBackingStoreImpl;  VolBackingStoreImpl;  VolTableImpl;  END;FileBasicsSwappableFrames: FRAME PACK =  BEGIN  DataTransferImpl;  SimpleFileImpl;  VolAllocMapImpl;  ETableImplA;  ETableImplB;  ETableImplC;  END;-- End of FileBasicsPack.pack