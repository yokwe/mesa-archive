-- Copyright (C) 1983  by Xerox Corporation. All rights reserved. -- TimeServerFormat.mesa-- last edited: KAM  	22-Sep-83 21:19:04DIRECTORY  Mopcodes USING [zEXCH],  System USING [GreenwichMeanTime, NetworkAddress, WestEast];  TimeServerFormat: DEFINITIONS =BEGINWireLong: TYPE = MACHINE DEPENDENT RECORD [high, low: WORD];GMTToWire: PROCEDURE [gmt: System.GreenwichMeanTime]  RETURNS [WireLong] = MACHINE CODE {Mopcodes.zEXCH};WireToGMT: PROCEDURE [wire: WireLong]  RETURNS [System.GreenwichMeanTime] = MACHINE CODE {Mopcodes.zEXCH};LongToWire: PROCEDURE [long: LONG INTEGER]  RETURNS [WireLong] = MACHINE CODE {Mopcodes.zEXCH};WireToLong: PROCEDURE [wire: WireLong]  RETURNS [LONG INTEGER] = MACHINE CODE {Mopcodes.zEXCH};  PacketType: TYPE = MACHINE DEPENDENT {    timeRequest(1), timeResponse(2), statisticRequest(3), statisticResponse(4),     resetRequest(5), resetResponse(6), stopRequest(7), stopResponse(8),    startRequest(9), startResponse(10), internalTimeRequest(11),    internalTimeResponse(12), noteNewVersion(13), (LAST[CARDINAL]-1)};-- These formats are done to conform with Packet Exchange, so they must start--     at packetExchange.exchangeBody.  The packetExchange.exchangeID is--     preserved by the time server, and the packetExchange.exchangeType is--     OISCPTypes.ExchangeClientType[timeService].-- In order to make this backwards compatable, a request with the wrong length--     is treated as an old-style time request.  The reply is cast in an old-style--     time reply format.  TSPacket: TYPE = MACHINE DEPENDENT RECORD [    version(0): WORD,    tsBody(1): SELECT type(1): PacketType FROM      timeRequest => NULL,      timeResponse => [        time(2): WireLong,        zoneS(4): System.WestEast,        zoneH(5): [0..177B],        zoneM(6): [0..377B],        beginDST(7): WORD,        endDST(8): WORD,        errorAccurate(9): BOOLEAN,        absoluteError(10): WireLong],      statisticRequest => NULL,      statisticResponse => [        numberRequests(2): WireLong,        active(4): BOOLEAN,        resetting(5): BOOLEAN,        timeSet(6): WireLong,        lastChange(8): WireLong,        source(10): System.NetworkAddress],      startRequest, startResponse => NULL,      stopRequest, stopResponse => NULL,      resetRequest => [timeSource(2): System.NetworkAddress],      resetResponse => NULL,      internalTimeRequest => NULL,      internalTimeResponse => [        time(2): WireLong,        absoluteError(4): WireLong,	timeVersion(6): WireLong],      noteNewVersion => [timeVersion(2): WireLong],      ENDCASE];        OldTimeResponse: TYPE = MACHINE DEPENDENT RECORD [    time(0): WireLong,    zoneS(2:0..0): System.WestEast,    zoneH(2:1..7): [0..177B],    zoneM(2:8..15): [0..377B],    beginDST(3): WORD,    endDST(4): WORD,    spare(5): ARRAY [0.. 3) OF WORD];    Version: WORD = 2;  -- version of this protocolEND.