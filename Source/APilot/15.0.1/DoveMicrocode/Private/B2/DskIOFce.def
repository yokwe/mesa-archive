;$MOD186;$PAGELENGTH (95);$PAGEWIDTH  (136);Copyright (C) 1984, 1985 by Xerox Corporation. All rights reserved.;-- IORegion locations for the rigid disk handler.;-- stored as [Idun]<WDLion>Dove>DskIOFce.def;;-- last edited by:;--	DEG		20-Aug-84 10:35:36	:created;--	DEG		12-Sep-84 16:59:34	:edited for initial cut.;--	DEG		30-Sep-84 22:55:49	:edited for use SIZE operator.;--	DEG		 2-Oct-84  0:40:21	:fixed DOB definition.;--	DEG		 4-Oct-84 16:29:13	:fixed some constant declarations.;--	DEG		14-Oct-84  0:11:59	:introduce new values and change definitions.;--	DEG		18-Oct-84  4:27:25	:introduce new values.;--	DEG		25-Oct-84 10:01:31	:change disk operation constants.;--	DEG		26-Oct-84 11:14:18	:change layout of a few records..;--	DEG		10-Dec-84  2:02:44	:Edited for Opie 17 compatibility.;--	DEG		16-Dec-84 23:34:50	:Add; complementDOB to DiskDataRec RECORD so that the client can specify whether; complementing is necessary or not.;--	DEG		 9-Jan-85 15:35:20	:changed name to DskIOFce.def from DskIOFce.asm;--	DEG		13-Jan-85  0:42:02	:add handler states 6 & 7.;--	DEG		14-Jan-85  2:39:20	:add HNH   for getting EEPROM data to disk handler clients.;--	DEG		15-Jan-85 23:03:30	:remove contention in naming.;--	DEG		16-Jan-85 10:11:32	:place hook for testing both etch1 and etch2 boards.;--	DEG		20-Jan-85 16:37:04	:correct some definitions of STRUCtures.;--	DEG		22-Jan-85  4:10:12	:added another condition variable.;--	DEG		 2-Feb-85 18:39:22	:switched dataPtr high and low in IOCB.;--	DEG		25-Feb-85 18:47:55	:use defined EEPROM indices.;--	DEG		 2-Mar-85 23:13:53	:size of DOB was; in words instead of in bytes as it should have been.  Add HNH   for the LEDs to; be used to display page count.;--	DEG		 4-Mar-85  1:57:23	:Add ; diskPresentCylinder to the DiskDCBRecord so that we can maintain the correct; cylinder information.;--	DEG		 8-Mar-85  1:51:57	:Adjust double ; word quantities such that the low word appears first.;--	DEG		27-Mar-85  2:35:02	:remove INCLUDEs. ;--	DEG		29-Mar-85 15:54:38	:convert to Opie!19. ;--	DEG		16-Apr-85 13:43:22	:make changes to data structures ; for proper synchronization between the head and the handler; correct a typo as well.;--	BKI		10-May-85 20:47:07	:Add controllerErrorType and dmaErrorType. ; All sizeMumbles are in bytes.$NOGEN$INCLUDE		(DskHdFce.def); Disk data structures; DiskClientType: TYPE = MACHINE DEPENDENT;   {drive0MesaClient, drive0IOPClient, drive1MesaClient, drive1IOPClient,;   drive2MesaClient, drive2IOPClient, drive3MesaClient, drive3IOPClient}DiskDCBRecord		STRUCdiskMesaHead		DW	?diskMesaNext		DW	?diskMesaTail		DW	?diskBlockMesaQueue	DW	?diskIOPHeadLow		DW	?diskIOPHeadHigh		DW	?diskIOPNextLow		DW	?	diskIOPNextHigh		DW	?diskIOPTailLow		DW	?diskIOPTailHigh		DW	?diskBlockIOPQueue	DW	?diskCurrentDriveMask	DB	?diskCommand		DB	?diskMesaClientCondition	DB	(SIZE ClientCondition) DUP (?)	;ClientCondition	<>diskIOPClientCondition	DB	(SIZE ClientCondition) DUP (?)	;ClientCondition	<>diskCurrentIOCBLow	DW	?diskCurrentIOCBHigh	DW	?diskMisc		DW	?	;word used exclusively by the Client.diskSpare0		DB	?diskDriveType		DB	?diskSectorsPerTrack	DB	?diskHeadsPerCylinder	DB	?diskCylindersPerDrive	DW	?diskReducedWriteCurrentCylinder	DW	?diskPreCompensationCylinder	DW	?DiskDCBRecord		ENDSsizeDiskDCBRecord	EQU	SIZE DiskDCBRecordDiskFCBRecord		STRUCdiskTask		DB	SIZE taskContextBlock DUP (?)		;TaskContextBlock	<>diskDMATask		DB	SIZE taskContextBlock DUP (?)		;TaskContextBlock	<>diskConditionDMAWork	DB	SIZE Condition DUP (?)		;Condition		<>diskConditionDMADone	DB	SIZE Condition DUP (?)		;Condition		<>diskConditionWork	DB	SIZE Condition DUP (?)		;Condition		<>diskWorkMask		DW	?		;work maskdiskLockMask		DW	?		;lock maskdiskMesaCleanupRequest	DW	?diskIOPCleanupRequest	DW	?diskHandlerStoppedForMesa		DW	?diskHandlerStoppedForIOP		DW	?diskHandlerStoppedForMesaCleanup	DW	?diskHandlerStoppedForIOPCleanup		DW	?diskStartHandlerForMesa	DW	?diskStartHandlerForIOP	DW	?diskHandlerState	DW	?diskCurrentClient	DB	?		;DiskClientTypediskClientsToTest	DB	?		;CARDINAL[0..numDiskClients]diskNumPossibleClients	DB	?diskLastDriveMask	DB	?diskCurrentDrivePtr	DW	?		;Used by handler to save ptr to current drive.diskStatusRegister	DB	?diskCommandRegister	DB	?diskTaskRetryCount	DB	?diskBadInterruptReason	DB	?diskDMAStatusRegister	DB	?diskBadDMAInterruptReason	DB	?unexpectedDiskInterruptCount	DW	?unexpectedDiskDMAInterruptCount	DW	?rd0			DB	SIZE DiskDCBRecord DUP (?)	;DiskDCBRecord	<>rd1			DB	SIZE DiskDCBRecord DUP (?)	;DiskDCBRecord	<>DiskFCBRecord		ENDSsizeDiskFCBRecord	EQU	SIZE DiskFCBRecordDiskDataRec	RECORD	incrementDataPtr:1, complementDOB: 1, etch2: 1, ddrunu1: 2, diskUseLEDs: 1, diskHalt: 1, diagDiskCmd: 1, dataCommandTransfer: 1, unused2: 6, commandDirection: 1DiskIOCBRecord		STRUCdiskPrivateStuff	DW	35 DUP (?)diskDataPtrLow		DW	?diskDataPtrHigh		DW	?diskDataInfoRec		DW	?		;actually of type DiskDataRec.diskPageCount		DW	?diskStopHandlerOnCompletion	DB	?diskOnlyDOBFromController	DB	?diskError		DB	?diskOperationBlockError	DB	?controllerErrorType	DB	?dmaErrorType		DB	?diskComplete		DB	?diskInProgress		DB	?diskDataXferDirection	DB	?diskDMATimedOut		DB	?diskNextLow		DW	?diskNextHigh		DW	?diskOperationBlock	DB	SIZE DiskDOB DUP (?)DiskIOCBRecord		ENDSsizeDiskIOCBRecord	EQU	SIZE DiskIOCBRecord;------------------------------------fromMesa	EQU	0toMesa		EQU	MASK commandDirection;------------------------------------NILPtr			EQU	0NILOpieAddressHigh	EQU	nilOpieAddress*100hNILOpieAddressLow	EQU	0mesaShortPtrOpieAddressType	EQU	mesaEnvBaseWord*100h;------------------------------------;  --> Handler states <--normalDiskHandlerState	EQU	0diskControllerNotIdling	EQU	1badDiskInterrupt	EQU	2badDiskDMAInterrupt	EQU	3;diskDMAError		EQU	4resettingDiskDMATask	EQU	5initialStartDiskDMATask	EQU	6resettingHandler	EQU	-1;------------------------------------diskControllerError	EQU	1diskDMAError		EQU	1diskInterruptTimeout	EQU	2controllerNotInIdleLoop	EQU	3fifoNotEmpty		EQU	3;------------------------------------DiskClientType	RECORD	dctUnused: 5, diskDrive: 2, diskClient: 1, dctZero: 1diskClientMask		EQU	MASK	diskClientdiskDriveMask		EQU	MASK	diskDrivediskMesaClient		EQU	0diskIOPClient		EQU	2diskDriveRD0		EQU	0diskDriveRD1		EQU	4 * 1diskDriveRD2		EQU	4 * 2diskDriveRD3		EQU	4 * 3drive0MesaClient	EQU	diskMesaClient + diskDriveRD0drive0IOPClient		EQU	diskIOPClient + diskDriveRD0drive1MesaClient	EQU	diskMesaClient + diskDriveRD1drive1IOPClient		EQU	diskIOPClient + diskDriveRD1drive2MesaClient	EQU	diskMesaClient + diskDriveRD2drive2IOPClient		EQU	diskIOPClient + diskDriveRD2drive3MesaClient	EQU	diskMesaClient + diskDriveRD3drive3IOPClient		EQU	diskIOPClient + diskDriveRD3lastDriveClient		EQU	drive0IOPClient;------------------------------------;	Indexes for EEPROMeeDiskTypeIndex			EQU	eePromRigidTypeeeDiskSectorsPerTrackIndex	EQU	eePromRigidSctPerTrkeeDiskHeadsPerCylinderIndex	EQU	eePromRigidHdPerCyleeDiskCylinderCountIndex	EQU	eePromRigidCylCteeDiskReducedWriteCylinderIndex	EQU	eePromRigidRWCeeDiskPreCompCylinderIndex	EQU	eePromRigidPCC;------------------------------------;	MiscellanynumSupportedDiskDrives	EQU	1numPossibleDiskDrives	EQU	2maxNumOfDiskDrives	EQU	4numDiskClientsPerDrive	EQU	2numDiskClients		EQU	numSupportedDiskDrives * numDiskClientsPerDrivenumPossibleDiskClients	EQU	numPossibleDiskDrives * numDiskClientsPerDrivedefaultInitialDiskCylinder	EQU	-1start		EQU	0read		EQU	0write		EQU	1execute		EQU	2noDataOp	EQU	3wordSize	EQU	2noWatchDogTimeOuts	EQU	255tenMilliseconds		EQU	10UnexpectedInterrupt	EQU	1