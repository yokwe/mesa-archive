$MOD186$PAGELENGTH (72)$PAGEWIDTH  (136);Copyright (C) 1984, 1985 by Xerox Corporation. All rights reserved.;-- Beep.asm;--stored as [Iris]<WMicro>Dove>Beep.asm;--created on     29-Oct-84 13:43:40;;--created by AxR    ;--last edited by:;--    JPM	22-Jul-85  9:49:22;--		Change IOPEInROM alignment to WORD;--    JPM	18-Jul-85 11:09:10;--		Opie redesign conversion;--    AxR	11-Feb-85  9:50:41;--		Moved control bits from 8000H to 4000H for Etch 2;;	NAME	Beep$NOLIST$INCLUDE	(IOPDefs.asm)$INCLUDE	(IOPMacro.asm)$INCLUDE	(HardDefs.asm)$LIST;	EXTRN			BeepHandlerID: ABS	BeepIOR			SEGMENT		COMMON	ASSUME			DS:BeepIOR	EXTRN			BeepTask: TaskContextBlock	EXTRN			BeepCndt: CONDITION	EXTRN			BeepMask: WORD	EXTRN			Frequency: WORD	BeepIOR			ENDS	BeepSTK			SEGMENT		COMMON	ASSUME			SS:BeepSTK	EXTRN			BeepStack: WORD	BeepSTK			ENDS	IOPEInROM        	SEGMENT   WORD PUBLIC	;ROM	ASSUME			CS:IOPEInROM	PUBLIC		BeepInit	;CODE:	BeepTaskInit:	MOV	AX, 0				;Set the counter to 0			MOV	DX, i186Timer0CountRegAddr			OUT	DX, AX			MOV	AX, 0C003H			;Enable and Set to Interrupt and Continue			MOV	DX, i186Timer0MCWAddr			OUT	DX, AX				%GetWorkMaskForCondition (OFFSET BeepCndt)			MOV	BeepMask, AX	beepEntry:	%WaitForCondition (OFFSET BeepCndt,noTimeout)	;Wakeup with a down Notify			MOV	AX, Frequency			;Get frequency IF 0 Turn off			CMP	AX, 0			JE	TurnOff			MOV	DX, i186Timer0CountAAddr	;store frequency			OUT	DX, AX			MOV	DX, i186Timer0CountBAddr	;store frequency			OUT	DX, AX			%ControlRegister (CREnableTimer0,CREnableTimer0)			JMP	beepEntry	TurnOff:	%ControlRegister (CREnableTimer0,0)			JMP	beepEntry	BeepInit	PROC	FAR			%InitializeTask (BeepHandlerID,OFFSET BeepTask,BeepTaskInit,OFFSET BeepStack)				RET	BeepInit	ENDP	IOPEInROM	ENDS			END