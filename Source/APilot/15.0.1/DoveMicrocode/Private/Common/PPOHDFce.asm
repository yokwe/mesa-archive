;Copyright (C) 1985 by Xerox Corporation. All rights reserved.;;-- stored as [BamBam:Osbu North]<WMicro>Dove>PPOIOFce.asm;-- PPO IOFace;;-- created on  6-Jul-86 13:36:06;;-- Last edited by:;--	JMA		23-Jun-87 20:49:36	:added DataRegrEmptyBit;;;=============================  PPO HARD FACE  =================================;-----------------------------  Definitions  --------------------------------------------; Bitwise definitions;Command Register  -- Head down to HandlerPPOResetCmd		EQU	0001H	;Peform a board resetPPOTransferCmd		EQU	0002H	;Transfer modePPOUpdateStatCmd	EQU	0004H	;Update Status, NowPPODiagCmd		EQU	0008H	;Place board on maintenance modeCmdListLocked		EQU	0080H	;CommandList is locked by HeadCmdPending		EQU	0FF00H	;Set command pending flagPPOAllCmds		EQU	000FH	;All commands setClrUpdateCmdMask	EQU	NOT PPOUpdateStatCmd			;Mask valueClrResetCmdMask		EQU	NOT (CmdPending OR PPOResetCmd)		;ClrTransferCmdMask	EQU	NOT (CmdPending OR PPOTransferCmd)	;clear cmd bitsClrDiagCmdMask		EQU	NOT (CmdPending OR PPODiagCmd)		;ClrNoCmdMask		EQU	CmdPending OR PPOAllCmds		;clears none of the cmdsClrAllCmdMask		EQU	NOT ClrNoCmdMask			;clears all command bits				;Transfer ModeOutPutBlock		EQU	00H	;Perform a block output, use DMAOutPutByte		EQU	01H	;Perform a byte output, use DMA;InputByte		EQU	02H	;Perform a byte input, use DMA;InputBlock		EQU	03H	;Perform a block input, use DMAControlIn		EQU	0300H	;Data'/Control & Out'/In (ControlIn);IOCB StatusiocbReady		EQU	00H	;iocbSuccess		EQU	01H	;iocbEndOfScanLine	EQU	02H	;iocbInProgress		EQU	03H	;iocbPending		EQU	04H	;iocbAborted		EQU	05H	;iocbIncomplete		EQU	06H	;;Handler StatusHandlerError		EQU	8000H	;HandlerInitialized	EQU	4000H	;PPOBoardInstalled	EQU	2000H	;BoardIsPPO		EQU	1000H	;HandlerBusy		EQU	0800H	;PPOBoardBusy		EQU	0400H	;IdleStateMask		EQU	NOT (HandlerBusy OR PPOBoardBusy OR PPOAllCmds)	;BOOLEANSlocalTRUE		EQU	0FFH	;locaLFALSE		EQU	00H	;MaxBufferSize		EQU	200H	;max buffer size is 512 bytes;-----------------------------  CONSTANTS  --------------------------------------;PPO RegistersPPOIOBaseAddrs		EQU	4000H			;LPO/PPO base addressPPOConfigRegr		EQU	PPOIOBaseAddrs		;Configuration RegrPPOCommandRegr		EQU	PPOIOBaseAddrs+02H	;Command RegrPPOPortStatusRegr	EQU	PPOIOBaseAddrs+04H	;Port Status RegrPPOStatusRegr		EQU	PPOIOBaseAddrs+06H	;Status RegrPPOIntrpSelectRegr	EQU	PPOIOBaseAddrs+08H	;Interrupt Select RegrPPODataRegr		EQU	PPOIOBaseAddrs+0AH	;Data RegrPPOMaintenanceRegr	EQU	PPOIOBaseAddrs+0CH	;Maintenance Regr;Definitions for i186 internal DMA 1	- from HardDefs.asm;i186DMA1IntCtlAddr	EQU	PCBbase+036h	;DMA 1 Interrupt Control Register;i186DMA1LowSourcePtr	EQU	PCBbase+0D0h	;DMA 1 Low order source pointer;i186DMA1HighSourcePtr	EQU	PCBbase+0D2h	;DMA 1 High order source pointer;i186DMA1LowDestPtr	EQU	PCBbase+0D4h	;DMA 1 Low order destination pointer;i186DMA1HighDestPtr	EQU	PCBbase+0D6h	;DMA 1 High order destination pointer;i186DMA1TransferCount	EQU	PCBbase+0D8h	;DMA 1 transfer count;i186DMA1ControlWord	EQU	PCBbase+0DAh	;DMA 1 control wordResetConfigRegrVal	EQU	0018H	;reset command value					; bit0-3 - period (1000B) 1uSecClk					; bit4   - useAck					; bit5   - maintenance mode (inactive)					; bit6   - interrupt (disabled)						; bit7   - PPO DMA (disabled)					; bit8	 - direction is OUT					; bit10  - byteMode disabled					; bit9	 - data is DATA					; bit14  - Print mode					; bit15  - Port0									ResetCmdRegrVal		EQU	0000H	;reset command value					; bit0   - PPOReset (active)					; bit1   - ClearIntrp (active)					; bit2   - Enforce20uSecRule (inactive)					; bit3   - PPOGO (inactive)					; bit7   - Port1DeviceReset (inactive)					DefaultCmdRegrVal	EQU	0003H	;initial command value 					; bit0   - PPOReset (inactive)					; bit1   - ClearIntrp (inactive)					; bit2   - Enforce20uSecRule (inactive)					; bit3   - PPOGO (inactive)					; bit7   - Port1DeviceReset (inactive)DefaultConfigRegrVal	EQU	0058H	;initial command value 					; bit0-3 - period (1000B) 1uSecClk					; bit4   - useAck					; bit5   - maintenance mode (inactive)					; bit6   - interrupt (enabled)						; bit7   - PPO DMA (disabled)					; bit8	 - direction is OUT					; bit9	 - data is DATA					; bit10  - byteMode disabled					; bit14  - Print mode					; bit15  - Port0				IntrpMaskVal		EQU	0002H	;Interrupt Mask Register ValueDMA1DefaultCntrlWrd	EQU	1A85H	;Default Value for the DMA1 control wordDestIsMem		EQU	8000H	;bit15 of i186 DMA1 Control WordStopDMABitMask		EQU	0FFFDH	;stop DMA transferDMAByteXfer		EQU	0001H	;DMA set bit0 to 0PPODiagCnfgVal0		EQU	0C066H	;6-BusyforEOX-Maintmode-Int-NonDMA-					;  DirectOut-Data-Scan-P1PPODiagCnfgVal		EQU	0C166H	;6-BusyforEOX-Maintmode-Int-NonDMA					;  DirectIn-Data-Scan-P1LPODiagCnfgVal		EQU	0066H	;6-BusyforEOX-Maintmode-Int-NonDMASMMaskBits		EQU	03F0H	;State Machine A-B mask bits, for PPO only				;-----------------------------  Definitions  ------------------------------------; Bitwise definitions;PPO Configuration RegisterEnableMaintBit		EQU	0020H		;Enable loopback/enable maintenance modePPOIntrpEnablebit	EQU	0040H		;Enable interrupts on PPO boardPPODMAEnablebit		EQU	0080H			;Allow PPO to make DMA requestsDisableIntrpBitMask	EQU	NOT PPOIntrpEnablebit	;Disable Interrupt bit maskDisableDMABitMask	EQU	NOT PPODMAEnablebit	;Disable DMA Enable bit maskInBit			EQU	0100H	;Data direction bitControlBit		EQU	0200H	;Control Or Data bitByteModeBit		EQU	0400H	;Byte Mode bitScanModeBit		EQU	4000H	;Print Or Scan bitPort1ModeBit		EQU	8000H	;Port0 Or Port 1 bit;PPO Command RegisterNotClearIntrpBit	EQU	0002H	;clear interrupt bitOptionOnBit		EQU	0008H	;Turn on LPO or SPO board;Port Status Register -- Parallel Port StatusFaultBit		EQU	0001H	;Fault line indicator (active low)SelectBit		EQU	0002H	;Select lineBusySyncBit		EQU	0004H	;Busy lineAcknowledgeBit		EQU	0008H	;Acknowledge line (active low)ScanLineSync		EQU	0002H	;Active low, end of scan line detectedAttention		EQU	0100H	;Attention line from scannerInOrOutEcho		EQU	1000H	;In'/Out echo bit, OPPOSITE polarity of cnfg bitDataOrCntrlEcho		EQU	4000H	;Data or control echo bitBoardInstalledBit	EQU	8000H	;0 = board installed, 1 = not sureQualifiedEOSMask	EQU	InOrOutEcho OR DataOrCntrlEcho					;a qualified EOS mask;PPO Status RegisterPPODMARequestBit	EQU	0001H	;indicates PPO is ready for DMA transferDataRegrEmptyBit	EQU	0002H	;indicates if Data Regr is emptySendIntrpBit		EQU	0008H	;indicates option board sent a intrpSMReadyBit		EQU	0400H	;state machine ready bitPPOAlwaysOneBit		EQU	0800H	;this bit always ONE if PPO installedPPOAlwaysZeroBit	EQU	1000H	;this bit always ZERO if PPO installed	PROMErrorBit		EQU	2000H	;indicates PROM error state