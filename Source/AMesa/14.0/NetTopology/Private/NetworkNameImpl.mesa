-- Copyright (C) 1984  by Xerox Corporation. All rights reserved. -- NetworkNameImpl.mesa last edit: AOF 28-Dec-84 13:30:51DIRECTORY  Auth USING [CallProblem, IdentityHandle],  CH USING [    ConversationHandle, LookupDistinguishedName, MakeConversationHandle,    ReturnCode],  Format USING [StringProc, NetworkNumber],  Heap USING [systemZone],  NetworkName USING [maxNetworkNameLength, Status],  NSName USING [Name, FreeName, MakeName],  NSString USING [AppendToMesaString, AppendString, StringFromMesaString],  Profile USING [GetID],  System USING [NetworkNumber];  NetworkNameImpl: MONITOR   IMPORTS CH, Format, Heap, NSName, NSString, Profile  EXPORTS NetworkName =  BEGIN    -- constants  systemZ: UNCOUNTED ZONE = Heap.systemZone;  resetLocalNameLength: CARDINAL = 8;  -- variables    chName: NSName.Name ¬ NIL;  netName: NSName.Name ¬ NIL;  identity: Auth.IdentityHandle ¬ NIL;  conversation: CH.ConversationHandle ¬ [NIL, NIL];    -- procedures    GetNetName: PUBLIC ENTRY PROCEDURE [net: System.NetworkNumber,    z: UNCOUNTED ZONE]    RETURNS [name: LONG STRING, status: NetworkName.Status] =    -- name is allocated out of the client's zone. Client must free the storage    BEGIN ENABLE UNWIND => NULL;        rc: CH.ReturnCode;    msp: Format.StringProc = {chName.local ¬ NSString.AppendString [      to: chName.local, from: NSString.StringFromMesaString[s]]};        IF chName = NIL THEN RETURN [NIL, domainAndOrgNotSet];    chName.local.length ¬ resetLocalNameLength; -- reset    Format.NetworkNumber [msp, net, productSoftware];        rc ¬ CH.LookupDistinguishedName [conversation, chName, netName];    IF rc.code = done THEN       BEGIN      name ¬ z.NEW [StringBody [netName.local.length]];      NSString.AppendToMesaString [to: name, from: netName.local];      END;    status ¬ SELECT rc.code FROM done => done, noSuchLocal => notFound,      ENDCASE => chProblem;    END;    GetNetNameSP: PUBLIC ENTRY PROCEDURE [sp: Format.StringProc, net: System.NetworkNumber,    clientData: LONG POINTER ¬ NIL]    RETURNS [status: NetworkName.Status] =    BEGIN ENABLE UNWIND => NULL;        rc: CH.ReturnCode;    name: LONG STRING = [NetworkName.maxNetworkNameLength];    msp: Format.StringProc = {chName.local ¬ NSString.AppendString [to: chName.local,      from: NSString.StringFromMesaString[s]]};        IF chName = NIL THEN RETURN [domainAndOrgNotSet];    chName.local.length ¬ resetLocalNameLength; -- reset    Format.NetworkNumber [msp, net, productSoftware];        rc ¬ CH.LookupDistinguishedName [conversation, chName, netName];    IF rc.code = done THEN       BEGIN      NSString.AppendToMesaString [to: name, from: netName.local];      sp [name, clientData];      END;    status ¬ SELECT rc.code FROM done => done, noSuchLocal => notFound,      ENDCASE => chProblem;    END;  SetDomainAndOrg: PUBLIC ENTRY PROCEDURE [domain, org: LONG STRING] =    -- the strings will be copied.    -- This proc is used to set the domain & org that holds the network    -- information. Get the domain info from the user    BEGIN ENABLE UNWIND => NULL;    IF chName # NIL THEN NSName.FreeName [systemZ, chName];    chName ¬ NSName.MakeName [systemZ];    chName.domain ¬ NSString.AppendString [to: chName.domain,      from: NSString.StringFromMesaString[domain]];    chName.org ¬ NSString.AppendString [to: chName.org,      from: NSString.StringFromMesaString[org]];    chName.local ¬ NSString.AppendString [to: chName.local,      from: NSString.StringFromMesaString["Network "L]];    IF chName.local.length # resetLocalNameLength THEN ERROR;    IF netName = NIL THEN netName ¬ NSName.MakeName [systemZ];    END;  Initialize: PROC =    BEGIN    ok: BOOLEAN;    auth: Auth.CallProblem;     GetIdentity: PROCEDURE [id: Auth.IdentityHandle] = {identity ¬ id};    Profile.GetID[simple, GetIdentity];    [conversation, ok, auth] ¬ CH.MakeConversationHandle [identity, systemZ];    END;  --Initialize  Initialize[];          END.  << log24-Mar-84 19:44:37	Kluger	Created file25-Mar-84 16:14:59	Kluger	Added GetNameSP>>    