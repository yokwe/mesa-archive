-- Copyright (C) 1985  by Xerox Corporation. All rights reserved. -- FixOneSystemElement.mesa-- JCS		 3-Dec-85 20:21:43-- RLC		 2-Mar-88 13:12:41 DIRECTORY  AdobeOps,  AdobeServerOps,  NSExec,  NSFile,  NSFilingGlobal USING [FlushServiceCache],  NSName,   NSString,  String,  TextInput;FixOneSystemElement: PROGRAM  IMPORTS AdobeServerOps, NSExec, NSFile, NSName, NSFilingGlobal, NSString, String, TextInput =    BEGIN    data: AdobeServerOps.Data =@AdobeServerOps.data;    S: PROC [s: LONG STRING] RETURNS [NSString.String] = INLINE {    RETURN[NSString.StringFromMesaString[s]]};    FixIt: NSExec.ExecProc ={    arSH:AdobeOps.ARSystemHandle ¬ NIL;    remoteService: NSFile.ServiceRecord;    i:CARDINAL;      twoattributes: ARRAY [0..2) OF NSFile.Attribute;    --oneattribute: ARRAY [0..1) OF NSFile.Attribute;    remoteDirectory: NSFile.Handle;    remoteDirRef: NSFile.Reference;    msg: LONG STRING ¬ [150];    versionIDType: NSFile.ExtendedAttributeType =      ORD[LAST[NSFile.AttributeType]] + 1;    submitNumberType: NSFile.ExtendedAttributeType = versionIDType + 1;    locOfARsType: NSFile.ExtendedAttributeType = submitNumberType + 1;      <<  NSExec.PutMessage[exec, S["Flushing service cache."L]];    NSFilingGlobal.FlushServiceCache[];    NSExec.PutMessage[exec, S["Done."L]];>>        i ¬ TextInput.GetDecimal[      tty: NSExec.GetTTY[exec], prompt: S["   Adobe System Number"L],      min: 0, max: data.systems.length-1];      << FOR i: CARDINAL IN [0..data.systems.length) DO >>      arSH ¬ AdobeServerOps.RetrieveSystemDescriptionInternal[        data.systems[i].dfH, data.z];      NSName.NameFieldsFromString[	z: data.z, s: S[arSH.host],	destination: @remoteService.name];      twoattributes ¬ [[service[@remoteService]], [pathname[S[arSH.directory]]]];      remoteDirectory ¬ NSFile.Open[        attributes: DESCRIPTOR[twoattributes], session: data.fileSession];      remoteDirRef ¬ NSFile.GetReference[        file: remoteDirectory, session: data.fileSession];      <<oneattribute ¬ [[extended[	type: locOfARsType, value: NSFile.EncodeReference[remoteDirRef]]]];      NSFile.ChangeAttributes[        data.systems[i].dfH, DESCRIPTOR[oneattribute], data.fileSession];      NSFile.ClearAttributeList[DESCRIPTOR[oneattribute]];>>      AdobeServerOps.PutLocationOfARsInternal[arSH.name, remoteDirRef];      --change version number      msg.length ¬ 0;      String.AppendString[msg, "Resetting location of ARs for "L];      String.AppendString[msg, arSH.name];      NSExec.PutMessage[exec, S[msg]];      --arSH.version ¬ arSH.version + 1;      --AdobeServerOps.PutVersionIDInternal[arSH.name, arSH.version];      AdobeServerOps.FreeSystemDescriptionInternal[arSH, data.z];      NSFile.Close[remoteDirectory, data.fileSession];   <<   ENDLOOP; >>    NSExec.PutMessage[exec, S["Flushing service cache."L]];    NSFilingGlobal.FlushServiceCache[];    NSExec.PutMessage[exec, S["Done."L]];      };    Init: PROCEDURE = {   NSExec.AddExecCommand[     command:[name: S["FixOneSystemElement"L], proc:FixIt]]};      --main line code  Init[];  END. -- of FixSystemElement 