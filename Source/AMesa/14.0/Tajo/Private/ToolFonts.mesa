-- Copyright (C) 1981, 1982, 1983, 1984  by Xerox Corporation. All rights reserved. -- File: ToolFonts.mesa - last edit by:-- BXM  	21-Oct-81 11:29:54-- PXK    	Aug 5, 1980 12:07 PM-- SXW   	10-Jul-81 13:35:50-- Mark		22-May-81 11:43:51-- SXS   	22-Sep-82 19:21:52-- BGY     	22-Feb-83 17:51:49-- AXD    	 8-Jun-84 16:43:29DIRECTORY  MFile USING [Handle],  MSegment USING [Address, Create, Delete, Handle],  ToolFont,  Heap USING [systemZone],  WindowFont USING [CharWidth, defaultFont, Handle, Initialize, Object];ToolFonts: PROGRAM  IMPORTS MSegment, Heap, WindowFont EXPORTS ToolFont =  BEGIN  -- declarations  FontHandle: TYPE = LONG POINTER TO FontObject;  FontObject: TYPE = MACHINE DEPENDENT RECORD [    font: WindowFont.Object, fs: MSegment.Handle];  -- Procedures  Create: PUBLIC PROCEDURE [file: MFile.Handle] RETURNS [WindowFont.Handle] =    BEGIN    myFont: FontHandle ¬ Heap.systemZone.NEW[FontObject];    BEGIN ENABLE UNWIND => Heap.systemZone.FREE[@myFont];    myFont.fs ¬ MSegment.Create[file: file, release: []];    myFont.font.address ¬ MSegment.Address[myFont.fs];    WindowFont.Initialize[      LOOPHOLE[myFont] ! UNWIND => MSegment.Delete[myFont.fs]];    END;    RETURN[LOOPHOLE[myFont]]    END;  Destroy: PUBLIC PROCEDURE [font: WindowFont.Handle] =    BEGIN    myFont: FontHandle ¬ LOOPHOLE[font];    MSegment.Delete[myFont.fs];    Heap.systemZone.FREE[@font]    END;  StringWidth: PUBLIC PROCEDURE [string: LONG STRING, font: WindowFont.Handle]    RETURNS [width: [0..LAST[INTEGER]]] =    BEGIN    i: CARDINAL;    IF font = NIL THEN font ¬ WindowFont.defaultFont;    width ¬ 0;    IF string = NIL THEN RETURN;    FOR i IN [0..string.length) DO      width ¬ width + WindowFont.CharWidth[string[i], font] ENDLOOP;    END;  END.