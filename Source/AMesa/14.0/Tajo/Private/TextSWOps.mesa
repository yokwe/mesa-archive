-- Copyright (C) 1981, 1982  by Xerox Corporation. All rights reserved. -- File: TextSWOps.mesa - last edit:-- PXK    ,	 4-Nov-81 20:30:41-- SXW   ,	 6-Jul-81 18:00:09-- JGS,		19-Aug-81 11:31:06-- Mark,	Sep 2, 1980 5:49 PM-- SXS   ,	 5-Jan-82 15:03:29-- BXM  ,	 8-Oct-81 16:17:42-- BGY     ,	15-Dec-82 16:48:23-- AXD    	13-Dec-82 12:24:09DIRECTORY  Caret USING [Action],  Context USING [Type],  Environment: TYPE USING [Block],  Scrollbar USING [ScrollProcType, ScrollbarProcType],  Selection USING [Action, Target],  System: TYPE USING [Pulses],  TextData USING [InsertionObject, Selection, SelectionObject, SelectionType],  TextDisplay USING [Handle],  TextSource USING [Position],  TextSW USING [OnOff, Options],  TIP: TYPE USING [NotifyProc],  ToolWindow USING [DisplayProcType],  UserInput USING [CaretProcType, StringProcType],  Window USING [Handle, Place, Dims];TextSWOps: DEFINITIONS =  BEGIN  SelectionClass: TYPE = {primary, secondary};    -- EXPORTED var to communicate between TextSWsB and TextSWsD  sSource: TSWSource;  clearingInMonitor: BOOLEAN;    -- Text Subwindow and Support  margin: CARDINAL = 4;  boundarySize: CARDINAL = 8;  halfBoundarySize: CARDINAL = boundarySize/2;  lock: MONITORLOCK;  textSWContext: Context.Type;  TSWContext: TYPE = LONG POINTER TO TSWContextObject;  TSWContextObject: TYPE = RECORD [    sw: Window.Handle,    splits: Splits,    scroller: TextDisplay.Handle,    output: LONG STRING,    options: TextSW.Options,    caret: TextSW.OnOff,    allowTypeIn, mySink, setOnNext: BOOLEAN,    startPos, endPos, curPos: TextSource.Position,    selection: TextData.SelectionObject,    insertion: TextData.InsertionObject,    otherSels: OtherSelections,    oldDims: Window.Dims];  TSWSource: TYPE = LONG POINTER TO TSWSourceObject;  TSWSourceObject: TYPE = RECORD [    tsw: TSWContext,    left, insert: TextSource.Position,    right: LONG POINTER TO TextSource.Position,    crossedInsert: BOOLEAN];  InsertSource: TYPE = LONG POINTER TO InsertSourceObject;  InsertSourceObject: TYPE = RECORD [    tsw: TSWContext,    left, right: TextSource.Position];  OtherSelections: TYPE = LONG POINTER TO OtherSelectionsObject;  OtherSelectionsObject: TYPE = RECORD [    array: SEQUENCE length: CARDINAL OF TextData.Selection];  Splits: TYPE = LONG POINTER TO SplitsObject;  SplitsObject: TYPE = RECORD [    array: SEQUENCE length: CARDINAL OF TextDisplay.Handle];  -- Private Stuff (just in case)  ActivateCaret: UserInput.CaretProcType;  DisplayProc: ToolWindow.DisplayProcType;  ScrollVertical: Scrollbar.ScrollProcType;  SelectExtend: PROC [TSWContext, TextData.SelectionType];  TypeIn, TypeOut: UserInput.StringProcType;  VerticalScrollbar: Scrollbar.ScrollbarProcType;  -- Internal Stuff used between modules  InOp: TYPE = {append, change, clear, unknown};  ActOnSelection: PROC [data: TSWContext, action: Selection.Action];  AppendWhiteSpace: PROC [s: LONG STRING, count: CARDINAL];  BlankCount: PROC [    tsw: TSWContext, p: TextDisplay.Handle, insert, pos: TextSource.Position]    RETURNS [count: CARDINAL];  ChangeCase: PROC [window: Window.Handle, upper: BOOLEAN];  ModifyInsertionState: PROC [    tsw: TSWContext, op: InOp, pos: TextSource.Position];  DeleteSplit: PROC [tsw: TSWContext, where: CARDINAL]    RETURNS [deleted: TextDisplay.Handle];  InsertBlockInternal: PROC [    sw: Window.Handle, block: Environment.Block, pos: TextSource.Position,    tsw: TSWContext];  InternalDeleteText: PROC [    tsw: TSWContext, pos: TextSource.Position, count: LONG CARDINAL,    keepTrash: BOOLEAN ¬ TRUE];  InternalForceOutput: PROC [tsw: TSWContext];  InternalValidate: PROC [window: Window.Handle];  InsertionAtSelection: PROC [tsw: TSWContext, pos: TextSource.Position];  MarkOtherSelections: PROC [p: TextDisplay.Handle, s: OtherSelections];  MarkSplitBoundary: PROC [    tsw: TSWContext, split: CARDINAL, clear: BOOLEAN ¬ FALSE];  SetSecondaryInternal: PROC [tsw: TSWContext, s: TextData.Selection];    StartMoveSplit, MoveSplitBoundary, FinishMoveSplit: PROC [tsw: TSWContext];  StartSelection: PROC [TSWContext, SelectionClass];  TrackSelection, FinishSelection: PROC [tsw: TSWContext];  StartExtend, TrackExtend, FinishExtend: PROC [tsw: TSWContext];      NewSplitsObject: PROC [old: Splits, n: CARDINAL, copy: BOOLEAN]    RETURNS [new: Splits];  OutputString: PROC [tsw: TSWContext, s: LONG STRING];  PToUse: PROC [tsw: TSWContext, y: INTEGER, nilOK: BOOLEAN]    RETURNS [TextDisplay.Handle];  SearchForSelection: --INTERNAL-- PROC [    tsw: TSWContext, place: Window.Place, backward: BOOLEAN];  Split: PROC [tsw: TSWContext, y: INTEGER];  RealActOnCaret: PROC [tsw: TSWContext, action: Caret.Action];  ConvertSelection: PROC [data: TSWContext, target: Selection.Target]    RETURNS [LONG POINTER];  TakeInputFocus: PROC [tsw: TSWContext];    TIPMe: TIP.NotifyProc;    -- Used by editor    lastPlace: Window.Place;  lastTime: System.Pulses;  clickTimeout: System.Pulses;    DisplayHandleFromPlace: PROC [sw: Window.Handle, place: Window.Place]    RETURNS [display: TextDisplay.Handle];  END. -- of TextSWOps