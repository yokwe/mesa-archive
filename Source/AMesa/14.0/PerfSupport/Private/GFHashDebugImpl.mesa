-- Copyright (C) 1983  by Xerox Corporation. All rights reserved. -- GFHashDebugImpl.mesa, last edited by-- AXD    	25-Aug-83 16:21:29DIRECTORY  DebugUsefulDefs: TYPE USING [LongCopyREAD, LongCopyWRITE, LongREAD],  Environment: TYPE USING [wordsPerPage],  GFHash: TYPE USING [],  GFHashDebug: TYPE USING [],  GFHashFormat: TYPE USING [Base, TableRep],  Space: TYPE USING [ScratchMap, Unmap];GFHashDebugImpl: PROGRAM  IMPORTS Debugger: DebugUsefulDefs, Space  EXPORTS GFHash, GFHashDebug =   BEGIN OPEN GFHashFormat;    Table: PUBLIC TYPE = Base;  LocalTable: TYPE = RECORD [address: Table, table: TableRep];    Acquire: PUBLIC PROC [client: Table] RETURNS [local: Table] = {    size: CARDINAL = Debugger.LongREAD[@client.tableSize];    lt: LONG POINTER TO LocalTable = Space.ScratchMap[      (size + Table.SIZE +         Environment.wordsPerPage - 1)/Environment.wordsPerPage];    Debugger.LongCopyREAD[from: client, to: @lt.table, nwords: size];    lt.address ¬ client;    RETURN[@lt.table]};    Release: PUBLIC PROC [local: Table, write: BOOLEAN] = {    lt: LONG POINTER TO LocalTable = LOOPHOLE[local - Table.SIZE];    IF write THEN Debugger.LongCopyWRITE[      from: local, to: lt.address, nwords: local.tableSize];    [] ¬ Space.Unmap[lt]};    END.