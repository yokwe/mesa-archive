-- Copyright (C) 1983  by Xerox Corporation. All rights reserved. -- InstallBootFiles.mesa (last edited by: EKN    on: 18-Apr-83 11:05:06)DIRECTORY  Ascii USING [CR, SP],  Command USING [Action, Confirm, Entry, InstallTopLevel, Scan],  File USING [Create, File, MakePermanent],  FileTypes USING [tUntypedFile],  Floppy USING [BootFilePointer, Close, CopyToPilotFile,     GetBootFiles, GetFileAttributes, Open, PageCount, VolumeHandle],  OthelloOps USING [BootFileType, SetPhysicalVolumeBootFile, SetVolumeBootFile],  PilotCommand USING [defaultWindow, GetVIDCur, StorageCatch],  TemporaryBooting USING [BootFromVolume, MakeBootable],  TTY USING [GetNumber, Handle, PutChar, PutString];  InstallBootFiles: PROGRAM   IMPORTS Command, File, Floppy, OthelloOps, PilotCommand, TemporaryBooting, TTY =  BEGIN    entries: ARRAY [0..2) OF Command.Entry ¬ [    ["get bootFiles onto volume", GetBootFilesFromFloppyCmd],    ["boot logical volume", BootLogicalVolumeCmd]];  tty: TTY.Handle ¬ PilotCommand.defaultWindow;      BootLogicalVolumeCmd: Command.Action =    BEGIN    Command.Confirm[tty];    TemporaryBooting.BootFromVolume[PilotCommand.GetVIDCur[]];    END;          CopyInitialmcode: PROC [initialmcode: Floppy.BootFilePointer] =    BEGIN    END;          CopyBootFileFromFloppy: PROC [      volume: Floppy.VolumeHandle, bootFilePointer: Floppy.BootFilePointer, bootFileType: OthelloOps.BootFileType] =    -- creates a  pilot file of appropiate size on the system volume,    -- copies a bootfile from a floppy into it,    -- sets it as the default bootfile on the logical and physical volume     BEGIN    size: Floppy.PageCount ¬ Floppy.GetFileAttributes[[volume, bootFilePointer.file]].size;    file: File.File ¬       File.Create[PilotCommand.GetVIDCur[], size, FileTypes.tUntypedFile];    Floppy.CopyToPilotFile[      [volume, bootFilePointer.file], file, bootFilePointer.page, 0, size];    IF bootFileType = pilot THEN TemporaryBooting.MakeBootable[file];    File.MakePermanent[file];    OthelloOps.SetVolumeBootFile[file, bootFileType, 0];    OthelloOps.SetPhysicalVolumeBootFile[file, bootFileType, 0];    END;      GetBootFilesFromFloppyCmd: Command.Action =    -- gets bootfiles of floppy and calls a procedure to copy them to a pilot file    -- on the system volume.    BEGIN    diagmcode, germ, initialmcode, pilotBootFile, pilotmcode: Floppy.BootFilePointer;    drive: CARDINAL;    volume: Floppy.VolumeHandle;        TTY.PutChar[tty, Ascii.CR];    TTY.PutString[tty,"drive: "L];    drive ¬ TTY.GetNumber[tty, 0, 10, TRUE];    volume ¬ Floppy.Open[drive];    [initialmcode, pilotmcode, diagmcode, germ, pilotBootFile] ¬      Floppy.GetBootFiles[volume];     CopyInitialmcode[initialmcode];    CopyBootFileFromFloppy[volume, pilotmcode, softMicrocode];    CopyBootFileFromFloppy[volume, diagmcode, hardMicrocode];    CopyBootFileFromFloppy[volume, germ, germ];    CopyBootFileFromFloppy[volume, pilotBootFile, pilot];    Floppy.Close[volume];    END;          InstallBootFilesCmd: Command.Action =    BEGIN    TTY.PutChar[tty, Ascii.SP];    Command.Scan[tty, DESCRIPTOR[entries], PilotCommand.StorageCatch];    END;          --main code  Command.InstallTopLevel[tty, ["installBootFiles", InstallBootFilesCmd]];      END...    LOG  18-Mar-83 11:23:51	EKN   		Created File    18-Apr-83 11:05:16	EKN   		Fixed Bug: TemporaryBooting.MakeBootable added to CopyBootFileFromFloppy procedure