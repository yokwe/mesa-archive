-- Copyright (C) 1981, 1982, 1983  by Xerox Corporation. All rights reserved. -- MBLoaderOps.mesa   -- BTL		17-Sep-81 11:01:30-- Levin	16-Mar-82 15:58:56-- JGS		19-Jul-82 16:14:50-- BJD		22-Jun-83 15:32:15-- BGY		 2-Jul-86 14:43:55DIRECTORY  BcdDefs USING [EXPIndex, Link, MTIndex, NameRecord],  BcdOps USING [BcdBase, MTHandle, NameString],  LoadStateFormat USING [BcdInfo, Handle, Index, ModuleInfo],  PrincOpsExtras2 USING [ControlLink, GFTHandle, LongGlobalFrameHandle],  MB USING [BHandle, Handle];MBLoaderOps: DEFINITIONS =  BEGIN  Index: TYPE = LoadStateFormat.Index;  ModuleInfo: TYPE = LoadStateFormat.ModuleInfo;  -- from MBLoader  VirtualLinks: TYPE = LONG DESCRIPTOR FOR ARRAY OF BcdDefs.Link;  FindFiles: PROC [loadee: MB.BHandle];  -- find code files  FindCode: PROC [loadee: MB.BHandle];   -- load code into MBVM  FileNotFound: SIGNAL [name: STRING];  OpenLinkSpace: PROC [loadee: MB.BHandle, mth: BcdOps.MTHandle];  WriteLink: PROC [offset: CARDINAL, link: PrincOpsExtras2.ControlLink];  ReadLink: PROC [offset: CARDINAL] RETURNS [link: PrincOpsExtras2.ControlLink];  CloseLinkSpace: PROC;    WriteLinks: PROC [    loadee: MB.BHandle,    mth: BcdOps.MTHandle,    links: LONG POINTER TO ARRAY [0..0) OF PrincOpsExtras2.ControlLink];  LinkFragLength: PROC [loadee: MB.BHandle, mth: BcdOps.MTHandle]    RETURNS [nLinks: CARDINAL];  GetVirtualLinks: PROC [loadee: MB.BHandle, mth: BcdOps.MTHandle]    RETURNS [virtualLinks: VirtualLinks];  ProcessUnboundImports: PROC;  -- from MBLoaderCore  InitLoaderCore: PROC [h: MB.Handle];  FinishLoaderCore: PROC;  -- from MBLoaderExtra    InitLoaderExtra: PROC [h: MB.Handle];  FinishLoaderExtra: PROC;  Bind: PROC [loadee: MB.BHandle, config: Index];  GetSpace: PROC [nwords: CARDINAL] RETURNS [p: LONG POINTER];  FreeSpace: PROC [p: LONG POINTER];  AppendName: PROC [s: LONG STRING, ssb: BcdOps.NameString, name: BcdDefs.NameRecord];        -- from MBLoadState   -- bindings for an input Bcd's imports; BASE[Binding] biased by bcd.firstdummy   Binding: TYPE = LONG DESCRIPTOR FOR ARRAY --import gfi-- OF BindLink;  BindLink: TYPE = RECORD [    body: SELECT type: * FROM      interface => [eti: BcdDefs.EXPIndex],      module    => [mti: BcdDefs.MTIndex],      notbound  => NULL,      ENDCASE];    InitLoadState: PROC [h: MB.Handle];  FinishLoadState: PROC;  InputLoadState: PROC RETURNS [nbcds: Index];  UpdateLoadState: PROC [config: Index, handle: MB.BHandle];  WriteLoadState: PROC;    -- Loadstate ModuleInfo (gfi -> <resolved?, Bcd#, gfi>) management  EnterModule: PROC [module: ModuleInfo];  GetModule: PROC [gfi: PrincOpsExtras2.GFTHandle] RETURNS [module: ModuleInfo];  SetResolved: PROC [gf: PrincOpsExtras2.LongGlobalFrameHandle, resolved: BOOLEAN];      AcquireBcd: PROC [config: Index] RETURNS [handle: MB.BHandle];  ReleaseBcd: PROC [handle: MB.BHandle];    InitBinding: PROC [bcd: BcdOps.BcdBase] RETURNS [binding: Binding];  ReleaseBinding: PROC [bcd: BcdOps.BcdBase, binding: Binding]    RETURNS [null: Binding];  BcdUnresolved: PROC [bcd: Index] RETURNS [BOOLEAN];  BcdExports: PROC [bcd: Index] RETURNS [BOOLEAN];  BcdExportsTypes: PROC [bcd: Index] RETURNS [BOOLEAN];  -- Enumerators  EnumerationDirection: TYPE = {recentfirst, recentlast};  EnumerateModules: PROC [    proc: PROC [module: ModuleInfo] RETURNS [BOOLEAN]]    RETURNS [PrincOpsExtras2.LongGlobalFrameHandle];  EnumerateBcds: PROC [    dir: EnumerationDirection, proc: PROC [Index] RETURNS [BOOLEAN]]    RETURNS [config: Index];      -- used by MBLoadStateImpl, Implemented by MBLoadState    GetLoadState: PROC RETURNS [LoadStateFormat.Handle];  GetModules: PROC     RETURNS [LONG POINTER TO ARRAY OF LoadStateFormat.ModuleInfo];    GetBcds: PROC     RETURNS [LONG POINTER TO ARRAY OF LoadStateFormat.BcdInfo];  GrowLoadState: PROC [nModules, nBcds: CARDINAL ¬ 0];    END.