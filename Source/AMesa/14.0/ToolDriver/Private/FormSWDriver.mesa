-- File: FormSWDriver.mesa - last edit:  -- Mark, Dec 23, 1980 11:38 AM  -- Mike on: 30-Dec-81 11:20:05  -- Rhonda 18-Apr-83 15:55:23  DIRECTORY  Inline USING [LongNumber],  FormSW USING [EnumeratedHandle, ItemHandle],  Token USING [Handle],  Window USING [Handle];  FormSWDriver: DEFINITIONS =  BEGIN  -- TYPEs  KnownType: TYPE = {    -- Mesa built-in types    boolean, cardinal, character, empty, integer, pointer, string,     unspecified, longNumber, longPointer,    -- Tajo add-ons    formSWItem, unknown};  BuiltInType: TYPE = KnownType[boolean..longPointer];  SBuiltIn: TYPE = LONG POINTER TO string BuiltInValue;  BuiltIn: TYPE = LONG POINTER TO BuiltInValue;  BuiltInValue: TYPE = RECORD [    type: BuiltInType,    body: SELECT COMPUTED BuiltInType FROM      boolean => [b: BOOLEAN],      cardinal => [c: CARDINAL],      character => [c: CHARACTER],      empty => NULL,      integer => [i: INTEGER],      pointer => [p: POINTER],      string => [s: LONG STRING, inHeap: BOOLEAN],      unspecified => [u: UNSPECIFIED],      longNumber => [ln: Inline.LongNumber],      longPointer => [lp: LONG POINTER],      ENDCASE];        ItemSpec: TYPE = LONG POINTER TO ItemSpecObject;  ItemSpecObject: TYPE = RECORD [    sw: Window.Handle,    item: FormSW.ItemHandle,    index: CARDINAL];    -- Procedural Interface  RunFormSW: PROCEDURE [    Window.Handle, PROCEDURE[Token.Handle] RETURNS [LONG STRING, LONG STRING],    Token.Handle];    -- Miscellaneous Services  FindEnumVal: PROCEDURE [    FormSW.EnumeratedHandle, LONG STRING] RETURNS [UNSPECIFIED];  FindFormSWItem: PROCEDURE [Window.Handle, LONG STRING]    RETURNS [item: FormSW.ItemHandle, index: CARDINAL];  ModifyFormSWItem: PROCEDURE [dest: ItemSpec, source: FormSWDriver.BuiltIn];    -- does not do target type coercion on source  SetItemFromItem: PROCEDURE [dest: ItemSpec, source: FormSW.ItemHandle];  SetItemFromString: PROCEDURE [dest: ItemSpec, value: LONG STRING];  SetItemFromValue: PROCEDURE [dest: ItemSpec, source: BuiltIn];    -- does target type coercion on source  SetFormSWItem: PROCEDURE [formSW: Window.Handle, tag: LONG STRING, value: LONG STRING];  BuiltInFromItem: PROCEDURE [dest: BuiltIn, source: FormSW.ItemHandle];  -- Conversion  BuiltInToString: PROCEDURE [bi: BuiltIn, sbi: SBuiltIn];    -- sbi.inHeap is always TRUE  BuiltInTypeForItemType: PROCEDURE [source: FormSW.ItemHandle]    RETURNS [dest: BuiltInType];  ConvertBuiltIns: PROCEDURE [dest, source: FormSWDriver.BuiltIn];    -- Do not call this if you already have the same dest and source types  StringToBuiltIn: PROCEDURE [s: LONG STRING, inHeap: BOOLEAN, bi: BuiltIn];    -- IF inHeap THEN caller loses ownership of s    -- SIGNALs and ERRORs  ErrorCode: TYPE = {noSuchEnumVal, noSuchItem};  Error: SIGNAL [code: ErrorCode];    TypeMismatch: SIGNAL [src, dest: KnownType];  END.