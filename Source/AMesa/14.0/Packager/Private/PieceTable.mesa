-- Copyright (C) 1981, 1982  by Xerox Corporation. All rights reserved. -- File PieceTable.mesa  -- Edited by Sweet, 6-Nov-81 21:31:53-- Edited by JGS, 17-Sep-82 10:37:23DIRECTORY  MFile USING [Handle],  Stream USING [Handle];PieceTable: DEFINITIONS =  BEGIN  Piece: TYPE = RECORD [ -- carefully 8 words long    prev: PieceIndex,    length: CARDINAL, -- for this application, pieces are small    position: LONG CARDINAL,    next: PieceIndex,    file: MFile.Handle];    PieceIndex: TYPE = LONG POINTER TO Piece;  Place: TYPE = RECORD [pi: PieceIndex, pos: Position, filePos: LONG CARDINAL];  PlacePtr: TYPE = LONG POINTER TO Place;  NullPiece: PieceIndex = NIL;  PFS: TYPE = RECORD [    next: LONG POINTER TO PFS ¬ NIL,    file: MFile.Handle,    stream: Stream.Handle];  Position: TYPE = LONG CARDINAL;  PieceTableImpl: PROGRAM;  PTError: PUBLIC SIGNAL; -- something went wrong    Append: PROCEDURE RETURNS [Position]; -- go to EOF and return pos  AppendWord: PROCEDURE RETURNS [Position]; -- round pos to word, Append  AppendQuadWord: PROCEDURE RETURNS [Position]; -- round pos to Quadword  AppendPage: PROCEDURE RETURNS [Position]; -- round pos to page, Append  CopyFromFile: PROCEDURE [      file: MFile.Handle,       position: LONG CARDINAL,       length: CARDINAL];  Delete: PROCEDURE [count: INTEGER];  Finalize: PROCEDURE;  GetByte: PROCEDURE RETURNS [UNSPECIFIED [0..256)];  GetPlace: PROCEDURE RETURNS [Place]; -- of start of current piece  GetWord: PROCEDURE RETURNS [UNSPECIFIED];  GetVPos: PROCEDURE RETURNS [Position];  Initialize: PROCEDURE;  Length: PROCEDURE RETURNS [LONG CARDINAL];  Move: PROCEDURE [dist: LONG INTEGER];  PutByte: PROCEDURE [byte: UNSPECIFIED [0..256)];  PutWord: PROCEDURE [word: UNSPECIFIED];  PutZeros: PROCEDURE [count: CARDINAL];  SetVPos: PROCEDURE [pos: Position,  near: PlacePtr ¬ NIL];  Store: PROCEDURE [outStream: Stream.Handle];  END.