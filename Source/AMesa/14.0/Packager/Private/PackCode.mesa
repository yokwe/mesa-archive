-- Copyright (C) 1982, 1983  by Xerox Corporation. All rights reserved. -- file: PackCode.mesa-- Edited by Sweet, 28-Jun-83 16:15:24-- Edited by Lewis, 13-Jan-83 12:03:46-- Edited by JGS,   17-Sep-82 13:52:41DIRECTORY  Alloc USING [Notifier],  BcdOps USING [ENHandle],  PackageSymbols USING [WordIndex],  PieceTable USING [NullPiece, PieceIndex, Place],  PrincOps USING [BytePC],  MFile USING [Handle];PackCode: DEFINITIONS =  BEGIN    WordIndexSeqBody: TYPE = RECORD [SEQUENCE COMPUTED NATURAL OF WordIndex];  WordIndexSeq: TYPE = LONG POINTER TO WordIndexSeqBody;    SeenModuleSeqBody: TYPE = RECORD[    SEQUENCE COMPUTED [0..1024) OF SeenModuleHandle];  SeenModuleSeq: TYPE = LONG POINTER TO SeenModuleSeqBody;  Address: TYPE = [0..77777B];  -- max of 32K  WordIndex: TYPE = PackageSymbols.WordIndex;  NullWordIndex: WordIndex = LAST[WordIndex];    BodyDataRec: TYPE = RECORD [    oldPC: PrincOps.BytePC, bytes: CARDINAL,     newPC: PrincOps.BytePC ¬ [0], pending: FixupHandle ¬ NIL];    FixupRec: TYPE = RECORD [    next: FixupHandle,    loc: LONG CARDINAL,    target: PrincOps.BytePC];  FixupHandle: TYPE = LONG POINTER TO FixupRec;  SeenModuleRecord: TYPE = RECORD [    newOffset: Address, -- of entry vector within segment    newPiece: PieceTable.PieceIndex, -- of beginning of vector    ev: BcdOps.ENHandle,    oldCodeFile: MFile.Handle,    oldCodePosition: LONG CARDINAL,    nConstants: CARDINAL,    newConstants: WordIndexSeq ¬ NIL, -- of new constant values    enablePlace: PieceTable.Place ¬ [PieceTable.NullPiece, 0, 0],    discarded: BOOLEAN ¬ FALSE,    thisSeg: BOOLEAN ¬ TRUE,    body: SEQUENCE nBodies: CARDINAL OF BodyDataRec ¬ NULL];  SeenModuleHandle: TYPE = LONG POINTER TO SeenModuleRecord;  PackError: SIGNAL [reason: Problem];  Problem: TYPE = {    InvalidCodeOffset, SegmentTooBig, StrangeJI, StrangeLIO,    StrangeCatch, NonZeroBase, EVNotPlaced};-- implemented in PackCodeImplA  ComputeCodePlacement: PUBLIC PROC;  WriteBcdToFile: PUBLIC PROC;  WriteCodeToBcdFile: PUBLIC PROC;  Finalize: PROC;  -- in PackCodeImplB  NotifyB: Alloc.Notifier;  RemapOldBcd: PROC;-- implemented in PackagerBcdTabDriver  InitBcdTab, FinalizeBcdTab: PROC;  END.