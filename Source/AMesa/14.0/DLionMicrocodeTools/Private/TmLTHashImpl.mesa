-- Copyright (C) 1982, 1983  by Xerox Corporation. All rights reserved. -- File: TmLTHashImpl.mesa-- Last edit: JAC    22-Jul-83 14:55:08-- Last edit: JAC    22-Jul-83 13:02:09   -- Last edit: ETN    21-Jan-83 12:14:55DIRECTORY  Heap USING [Create, Delete, FreeNode],  TmAssembler USING [GetPassSpace],  TmLabel,  TmModule;TmLTHashImpl: PROGRAM IMPORTS TmAssembler, Heap EXPORTS TmLabel, TmModule =  BEGIN OPEN TmLabel;  -- GLOBAL VARIABLES  LHSize: CARDINAL = 201;  -- should be a prime  HashTable: TYPE = ARRAY [0..LHSize) OF HashEntryPtr;  hashTable: LONG POINTER TO HashTable;  LTtempHeap: PUBLIC UNCOUNTED ZONE;  InitGlobalLTHash: PUBLIC PROCEDURE = {hashTable ¬ NIL; LTtempHeap ¬ NIL};  BuildHashCode: PROCEDURE [str: LONG STRING] RETURNS [hc: CARDINAL] = INLINE    BEGIN    i: CARDINAL;    hc ¬ 0;    FOR i IN [0..str.length) DO hc ¬ (2*hc) + LOOPHOLE[str[i], CARDINAL]; ENDLOOP;    hc ¬ (hc + (hc/16)) MOD LHSize;    RETURN[hc];    END;  --  of Procedure BuildHashCode      ClearHashTable: PUBLIC PROCEDURE =    BEGIN    i: CARDINAL;    FOR i IN [0..LHSize) DO      hashTable[i] ¬ NIL;      ENDLOOP;    END;   -- of Procedure ClearHashTable  DisplayLabels: PUBLIC PROCEDURE [proc: PROCEDURE [HashEntryPtr]] =    BEGIN    i: CARDINAL;    p: HashEntryPtr;    pp: HashEntryPtr;    FOR i IN [0..LHSize) DO      p ¬ hashTable[i];      UNTIL p = NIL DO        pp ¬ p.next; 	proc[p];	Heap.FreeNode[LTtempHeap, p.ptr];	p ¬ pp;	ENDLOOP;      ENDLOOP;    END;  --  of Procedure DisplayLabels  EqualString: PROCEDURE [str1, str2: LONG STRING] RETURNS [BOOLEAN] = INLINE    BEGIN    i: CARDINAL;    IF str1.length # str2.length THEN RETURN[FALSE];    FOR i IN [0..str1.length) DO IF str1[i] # str2[i] THEN RETURN[FALSE]; ENDLOOP;    RETURN[TRUE];    END;  --  of Procedure EqualString  FindLabel: PUBLIC PROCEDURE [str: LONG STRING] RETURNS [h: HashEntryPtr] =    BEGIN    hashCode: CARDINAL;    p: HashEntryPtr;    hashCode ¬ BuildHashCode[str];    p ¬ hashTable[hashCode];    UNTIL p = NIL DO      IF EqualString[p.key, str] THEN RETURN[p]; p ¬ p.next; ENDLOOP;    RETURN[NIL];    END;  -- of procedure FindLabel  InitLTHeap: PUBLIC PROCEDURE [initPages, incrPages: CARDINAL] =    BEGIN    i: CARDINAL;    IF LTtempHeap # NIL THEN Heap.Delete[LTtempHeap];    LTtempHeap ¬ Heap.Create[      initial: initPages, increment: incrPages];    hashTable ¬ TmAssembler.GetPassSpace[SIZE[HashTable]];    FOR i IN [0..LHSize) DO hashTable[i] ¬ NIL; ENDLOOP;    END;  --  of Procedure InitLTHeap  InsertLabel: PUBLIC PROCEDURE [h: HashEntryPtr] RETURNS [error: BOOLEAN] =    BEGIN    hashCode: CARDINAL;    hp: LONG POINTER TO HashEntryPtr;    p: HashEntryPtr;    IF hashTable = NIL THEN InitLTHeap[16, 8];    hashCode ¬ BuildHashCode[h.key];    p ¬ hashTable[hashCode];    hp ¬ @hashTable[hashCode];    UNTIL p = NIL DO      IF EqualString[p.key, h.key] THEN RETURN[TRUE];      hp ¬ @p.next;      p ¬ p.next;      ENDLOOP;    hp­ ¬ h;    RETURN[FALSE];    END;  -- of procedure InsertLabel  ReleaseLTSpace: PUBLIC PROCEDURE =    BEGIN Heap.Delete[LTtempHeap]; LTtempHeap ¬ NIL; hashTable ¬ NIL; RETURN; END;  --  of Procedure ReleaseLTSpace  END...    -- Log  -- 16-Jul-82 13:27:02 - ETN        - TrinityMass Version 1  -- 21-Jan-83 12:15:04 - ETN        - Sierra. Removed parent: in Heap.Create[  -- 22-Jul-83 13:05:42 - JAC        - Clean up LTtempHeap  -- 22-Jul-83 15:08:22 - JAC        - Insert ClearHashTable