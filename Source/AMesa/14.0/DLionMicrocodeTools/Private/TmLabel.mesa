-- Copyright (C) 1982, 1983, 1984  by Xerox Corporation. All rights reserved. -- File: TmLabel.mesa -- Last edit: DEG      26-Sep-84 20:46:20-- Last edit: JAC    22-Jul-83 15:00:01-- Last edit: ETN    16-Jul-82 10:16:24DIRECTORY  MassBurdockInterface USING [LabelSeqNum, PartialBinary],  TmAssembler;TmLabel: DEFINITIONS =  BEGIN OPEN TmAssembler;  ConstraintAttribute: TYPE = RECORD [    caChain: LONG POINTER TO ConstraintAttribute ¬ NIL,    constraints: LONG POINTER TO ConstraintChain ¬ NIL,    ia7: ia7Type ¬ x,    maxModulo: ModuloIndex ¬ 0];  -- end ConstraintAttribute  ConstraintChain: TYPE = RECORD [    nextConstraint: LONG POINTER TO ConstraintChain ¬ NIL,    miIndex1: CARDINAL [0..5120) ¬ NullIndex,    miIndex2: CARDINAL [0..5120) ¬ NullIndex,    offset: CARDINAL [0..4096) ¬ 0,    modulo: ModuloIndex ¬ 0];  -- end ConstraintChain  ConstraintRec: TYPE = RECORD [    label1: LabelRec ¬ LabelRec[special[]],    label2: LabelRec ¬ LabelRec[special[]],    offset: CARDINAL [0..4096) ¬ 0,    modulo: ModuloIndex ¬ 0];  -- end ConstraintRec  CurrentMI: TYPE = RECORD [    dest: LabelRec ¬ LabelRec[special[]],    andMask: CARDINAL [0..maxNumMI) ¬ 4095,    orMask: CARDINAL [0..maxNumMI) ¬ 0];  -- end CurrentMI  Cycle: TYPE = {x, c1, c2, c3, cX};  EarlyBinaryRec: TYPE = RECORD [    partialBinary: MassBurdockInterface.PartialBinary,    destMI: CurrentMI,    last: BOOLEAN ¬ FALSE,    sa: BOOLEAN ¬ FALSE];  -- end EarlyBinaryRec  Empty: CARDINAL [0..5120) = 5119;  HashEntry: TYPE = RECORD [    key: LONG STRING, ptr: LabelEntryPtr ¬ NIL, next: HashEntryPtr ¬ NIL];  HashEntryPtr: TYPE = LONG POINTER TO HashEntry;  LTtempHeap: UNCOUNTED ZONE;  ia7Type: TYPE = {t, f, x};  LabelEntry: TYPE = RECORD [    export: BOOLEAN ¬ FALSE,    import: BOOLEAN ¬ FALSE,    incons: BOOLEAN ¬ FALSE,    labeled: BOOLEAN ¬ FALSE,    found: BOOLEAN ¬ FALSE,    target: BOOLEAN ¬ FALSE,    miseqnum: MiSeqNum ¬ NullIndex,    labelseqnum: MassBurdockInterface.LabelSeqNum ¬ 0,    needsCycle: Cycle ¬ x,    isCycle: Cycle ¬ x,    needsfromcX: BOOLEAN ¬ FALSE,    pBr: BOOLEAN ¬ FALSE,    needsBr: BOOLEAN ¬ FALSE,    isBr: BOOLEAN ¬ TRUE,    pCB2: BOOLEAN ¬ FALSE,    needsCB2: BOOLEAN ¬ FALSE,    isCB2: BOOLEAN ¬ TRUE,    ldStkp: BOOLEAN ¬ FALSE,    stknok: BOOLEAN ¬ FALSE,    isstk: BOOLEAN ¬ FALSE,    isIBDisp: BOOLEAN ¬ FALSE,    ldStkpnok: BOOLEAN ¬ FALSE,    c1noM: BOOLEAN ¬ FALSE,    hasW: BOOLEAN ¬ FALSE,    hasR: BOOLEAN ¬ FALSE,    toR: BOOLEAN ¬ FALSE,    fromW: BOOLEAN ¬ FALSE,    c2noM: BOOLEAN ¬ FALSE,    c3noM: BOOLEAN ¬ FALSE];  -- end LabelEntry  LabelEntryPtr: TYPE = LONG POINTER TO LabelEntry;  LabelList: TYPE = RECORD [    next: LONG POINTER TO LabelList ¬ NIL, label: HashEntryPtr];  -- end LabelList  LabelRec: TYPE = RECORD [    element: SELECT type: LabelType FROM      unlabeled => [miseqnum: MiSeqNum],      labeled => [labelseqnum: MassBurdockInterface.LabelSeqNum],      absolute => [value: CARDINAL [0..4096)],      special => NULL,      ENDCASE];  -- end LabelRec  LabelIntRec: TYPE = RECORD [    export: BOOLEAN ¬ FALSE,    import: BOOLEAN ¬ FALSE,    incons: BOOLEAN ¬ FALSE,    found: BOOLEAN ¬ FALSE,    target: BOOLEAN ¬ FALSE,    needsCycle: Cycle ¬ x,    isCycle: Cycle ¬ x,    labIndex: MassBurdockInterface.LabelSeqNum ¬ 0,    length: [0..256) ¬ 0,    miIndex: CARDINAL [0..5120) ¬ Empty];  -- end LabelIntRec  LabelType: TYPE = {absolute, unlabeled, labeled, external, special};  maxmaxModulo: CARDINAL = 5;  maxNumMI: CARDINAL = 4096;  MiSeqNum: TYPE = CARDINAL [0..5120);  Modulo: ARRAY [0..5] OF CARDINAL = [1, 2, 4, 8, 16, 4096];  ModuloIndex: TYPE = [0..5];  NullIndex: CARDINAL [0..5120) = 5118;  -- program  MassLabelProcs: PROGRAM;  -- from MassLabelProcs  MassLTHash: PROGRAM;  -- from MassLTHash  MassAlloc: PROGRAM;  -- from MassAlloc  byteTiming: BOOLEAN;  canceledBr: BOOLEAN;  canceledBr2: BOOLEAN;  curLineLab: LONG STRING;  curLineNum: CARDINAL;  masked: CARDINAL [0..3];  mdok: BOOLEAN;  mdrok: BOOLEAN;  natc: BOOLEAN;  niblTiming: BOOLEAN;  pci: BOOLEAN;  stw: BOOLEAN;  wok: BOOLEAN;  -- procedures  AddConstraint: PROCEDURE [ccp: LONG POINTER TO ConstraintChain];  -- from MassAlloc  AllocateUnconstrained: PROCEDURE;  -- from MassAlloc  AppendSymbolName: PROCEDURE [str: LONG STRING, mi: CARDINAL [0..5120)];  -- from MassPass2  BrConstrain: PROCEDURE [    lab1, lab2: LONG STRING, offset: CARDINAL, modulo: ModuloIndex];  -- from MassLabelProcs  BuildCAList: PROCEDURE RETURNS [caOut: LONG POINTER TO ConstraintAttribute];  -- from MassAlloc  BuildEarlyBinary: PROCEDURE [encodingPtr: EncodingPtr];  -- from MassLabelProcs  ClearHashTable: PUBLIC PROCEDURE;  --in TmLTHashImpl  Constrain: PROCEDURE [    lab1, lab2: LONG STRING, offset: CARDINAL, modulo: ModuloIndex];  -- from MassLabelProcs  DisplayLabels: PROCEDURE [proc: PROCEDURE [HashEntryPtr]];  -- from MassLTHash  EndOfStatementProc: PROCEDURE;  -- from MassLabelProcs  FindLabel: PROCEDURE [str: LONG STRING] RETURNS [h: HashEntryPtr];  -- from MassLTHash  GetLabelEntry: PROCEDURE [name: LONG STRING]    RETURNS [hashEntryPtr: HashEntryPtr];  -- from MassLabelProcs  InitLTHeap: PROCEDURE [initPages, incrPages: CARDINAL];  -- from MassLTHash  InsertLabel: PROCEDURE [h: HashEntryPtr] RETURNS [error: BOOLEAN];  -- from MassLTHash  McFileEndProc: PROCEDURE;  -- from MassLabelProcs  Pass2Part2: PROCEDURE;  -- from MassPass2Part2  ProcessAt: PROCEDURE [offset: CARDINAL, modulo: ModuloIndex, name: LONG STRING];  -- from MassLabelProcs  ProcessConstraints: PROCEDURE [ca: LONG POINTER TO ConstraintAttribute];  -- from MassAlloc  ProcessDestLabel: PROCEDURE [name: LONG STRING]    RETURNS [hashEntryPtr: HashEntryPtr];  -- from MassLabelProcs  ProcessExternal: PROCEDURE [type: BuiltinMacroType, name: LONG STRING];  -- from MassLabelProcs  ProcessLineLabel: PROCEDURE [name: LONG STRING]    RETURNS [hashEntryPtr: HashEntryPtr];  -- from MassLabelProcs  ProcessReserve: PUBLIC PROCEDURE [lowAddr, highAddr: CARDINAL];  -- from MassLabelProcs  ProcSA: PUBLIC PROCEDURE [name: LONG STRING, val: INTEGER];  -- from MassLabelProcs  ReadLabelFromST: PROCEDURE [str: LONG STRING];  ReleaseLTSpace: PROCEDURE;  -- from MassLTHash  SetDest: PROCEDURE [lab: LONG STRING, and: CARDINAL, or: CARDINAL];  -- from MassLabelProcs  END...    -- Log  -- 16-Jul-82 10:17:05 - ETN        - TrinityMass Version 1  -- 22-Jul-83 15:01:25 - JAC        - Insert ClearHashTable  -- Time: 26-Sep-84 20:46:16	By: DEG     	Action: Added copyright notice and rebuild for 11.1 release.