-- LibrarianAndAdobeUpgrade.doc-- Last edited:		17-Oct-86 14:18:07This document describes how to upgrade your Librarian and Adobe services to Mesa 12.3 from Mesa 12.0 and how to use the Librarian scavenger to convert existing data bases to the new Mesa 12.3 format.UPGRADING TO SERVICES 10.0Before installing the Librarian and Adobe services, you must first upgrade the librarian/adobe server to Services 10.0 from 8.0.  List the service names before upgrading, as you will need to specify these same names when upgrading the services themselves. Note:  Before upgrading to Services 10.0, execute the Librarian service's Backup Databases command to ensure that you have a successful backup of the latest versions of the data bases.  The backup command only attempts to backup "loaded" data bases, that is, those data bases that have been referenced recently (during this boot session).  To load all of your data bases, execute the List Databases command, with a "*" to indicate all data bases and "Y" for verbose mode.See your local administrators support group for floppies and help in upgrading your server to services 10.0.  Be sure and run the extended filing scavenge, and then SmashVolumeLimits after installing 10.0 services.  Now you are ready to install Mesa 12.3 Librarian and Adobe services.UPGRADING ADOBE TO MESA 12.3Having upgraded the server to 10.0, fetch the new AdobeService.bcd and AdobeSDF.bcd from the 12.3 release directory and install them.  When the new Adobe service is run, you will need to re-register the Adobe service name.  Use the current service name to avoid clearinghouse propagation delays.  Your new Adobe service is now installed.UPGRADING LIBRARIAN TO 12.3At this point you should have the 12.0 data bases backed up, and the server now running services 10.0.  Now fetch the new LibrarianService.bcd and LibrarianSDF.bcd from the 12.3 release directory and install them.  When the new Librarian service is run, as with the Adobe service, you will need to re-register the Librarian service name.  Again, use the current service name to avoid clearinghouse propagation delays.  Your new Librarian service is now installed.In order to save existing Librarian data bases, you must scavenge them forward as described in the next section.SCAVENGING FORWARD LIBRARIAN DATABASESA Mesa 12.0 data base consists of a .Records file containing the libject property values and a .BTree file containing a BTree used to index the .Records file.  The Mesa 12.3 Librarian service instead uses a hash table to index its .Records files.  For this reason, the 12.3 Librarian scavenger must convert the BTree in the .BTree file to a hash table and move it into a .HashTable file.  The .BTree file is deleted and the .Records file remains unchanged.Follow the steps below to scavenge forward existing data bases.Step 1.	Fetch LibScavenger.bcd from the 12.3 release directory.  Start the Librarian service, if it hasn't been already, and run LibScavenger.bcd.Step 2.	Execute the Scavenge Forward Databases command.  You must be enabled to use this command.Step 3.	You will be asked if the scavenger should look in the librarian directory for data bases (.BTree files) to scavenge.  All existing data bases are in this directory, so in most cases you should answer "Y".  (If you answer "N", the scavenger will look for its data bases in the services working directory, where the List Files command looks for its files).Step 4.	You will then be asked to select a data base to be converted.  Select the appropriate data base number and answer "Y" to confirm.  The scavenger will grind away converting libjects at the rate of about 3 or 4 libjects per second.Step 5.	Repeat Steps 2-4 for each data base to be converted.Step 6.	After scavenging all data bases you intend to save, you must stop and then start the Librarian service in order for the newly converted data bases to be noticed.EXAMPLE: !Librarian Service LS!List Databases         Database name:  *        Verbose feedback? (Y/N):  YMesaDFs  .Records                     88576    28-Aug-86 18:39:00 PDT  .BTree                       46080    28-Aug-86 18:39:00 PDT  .Log                             0    25-Aug-86 13:20:00 PDT  Readers:  all  Writers:  all  Authentication level:  simple  Backup path:  (Rasp:osbu north:xerox)test/librarianPilot-LibjectsLS: Pilot-Libjects: being loaded.  .Records                    375808    20-Jun-86 10:54:03 PDT  .BTree                      107520    19-Aug-86 20:06:22 PDT  .Log                             0    20-Jun-86 10:41:51 PDT  Readers:  all  Writers:  all  Authentication level:  simple  Backup path:  (Huey:Osbu North:Xerox)Pilot-LibjectsLS!Backup DatabasesLS!LS: MesaDFs: backup started.LS: MesaDFs: backup completed.LS: Pilot-Libjects: backup started.LS: Pilot-Libjects: backup completed.  ***	Upgrade to Services 10.0.  ***	Install 12.3 Librarian and Adobe services either from floppy or the net.!Run Service         Select choice        1    Librarian Service        2    Adobe Service        Enter one or more choices: 1        LS: Normal startup? (Y/N):  YRunning Librarian Service.Starting Librarian Service        Service name and description unknown.	Enter service name: Lamborghini	Enter service description: system software librarian service	Confirm? (Y/N): Y	Validating Clearinghouse entry for: Lamborghini:OSBU North:Xerox	A new Clearinghouse entry was created.	DoneLS!Set Remote Directory        Remote Directory:  (Goose)AlphaMesa/12.3/!Retrieve Files         File List:  LibScavenger.bcdLibScavenger.bcd ... retrieved!Run Files         File List:  LibScavenger.bcdLibScavenger.bcd ... run LS!Scavenge Forward Database         Look for database in librarian directory? (Y/N):  Y        Database to scavenge        1    Pilot-Libjects        2    MesaDFs        Enter choice number: 1        Are you sure? (Y/N):  yScavenging forward 'Pilot-Libjects' ...  done.Elapsed time:  0:03:25701 libjects converted.LS!Stop Service         Select choices        1    Librarian Service        2    Adobe Service        Enter one or more choices: 1        LS: Stop immediately? (Y/N):  YStopping Librarian Service.LS!Start Service         Select choices        1    Librarian Service        Enter one or more choices: 1Starting Librarian Service.Starting Librarian ServiceLS!List Databases         Database name:  *        Verbose feedback? (Y/N):  NMesaDFsPilot-Libjects