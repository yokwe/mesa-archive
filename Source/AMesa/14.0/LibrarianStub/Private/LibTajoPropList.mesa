-- File: LibTajoPropList.mesa - last edit:-- bjd                 28-Aug-86 17:39:48-- Copyright (C) 1985, 1986 by Xerox Corporation. All rights reserved.-- This module is a thin veneer over the XLibrarian implementation exporting the old interface, Librarian, so that existing clients wouldn't have to be rebuilt against the new interface, XLibrarian.    DIRECTORY Librarian, LibOps, String, System, XLibrarian;LibTajoPropList: PROGRAM  IMPORTS String, XLibrarian EXPORTS Librarian =  BEGIN      PropertyList: TYPE = LONG POINTER TO PropertyListObject;  PropertyListObject: PUBLIC TYPE = RECORD [    z: UNCOUNTED ZONE,    list: Properties];  Properties: TYPE = RECORD [    maxLength: CARDINAL,    props: LONG DESCRIPTOR FOR ARRAY OF Librarian.Property];  Atom: TYPE = Librarian.Atom;  nullAtom: Atom = Librarian.nullAtom;  Property: TYPE = Librarian.Property;  Value: TYPE = Librarian.Value;  nullProp: Property = [nullAtom, [null[]]];  WrongPropertyType: PUBLIC ERROR = CODE;  Error: PUBLIC ERROR [code: Librarian.ErrorCode] = CODE;  -- procedures exported to Librarian  CreatePropertyList: PUBLIC PROC [z: UNCOUNTED ZONE] RETURNS [PropertyList] = {    ENABLE {      XLibrarian.WrongPropertyType => ERROR WrongPropertyType;      XLibrarian.Error => ERROR Error[implementationBug]};    RETURN[TajoPList[XLibrarian.CreatePropertyList[z]]]};  CopyPropertyList: PUBLIC PROC [from: PropertyList]    RETURNS [to: PropertyList] = {    ENABLE {      XLibrarian.WrongPropertyType => ERROR WrongPropertyType;      XLibrarian.Error => ERROR Error[implementationBug]};    RETURN[TajoPList[XLibrarian.CopyPropertyList[XPList[from]]]]};    DestroyPropertyList: PUBLIC PROC [pl: PropertyList] = {    ENABLE {      XLibrarian.WrongPropertyType => ERROR WrongPropertyType;      XLibrarian.Error => ERROR Error[implementationBug]};    XLibrarian.DestroyPropertyList[XPList[pl]]};  RemoveAllProperties: PUBLIC PROC [pl: PropertyList] = {    ENABLE {      XLibrarian.WrongPropertyType => ERROR WrongPropertyType;      XLibrarian.Error => ERROR Error[implementationBug]};    XLibrarian.RemoveAllProperties[XPList[pl]]};  EnumerateProperties: PUBLIC PROC [    pl: PropertyList, proc: Librarian.PropertyEnumerator] = {    FOR i: NATURAL IN [0..pl.list.props.LENGTH) DO      IF proc[pl.list.props[i]] THEN EXIT;      ENDLOOP};  GetProperty: PUBLIC PROC [plist: PropertyList, tag: Atom]    RETURNS [Property] = {    ENABLE {      XLibrarian.WrongPropertyType => ERROR WrongPropertyType;      XLibrarian.Error => ERROR Error[implementationBug]};    RETURN[TajoProp[XLibrarian.GetProperty[XPList[plist], XLibAtom[tag]]]]};  RemoveProperty: PUBLIC PROC [plist: PropertyList, tag: Atom] = {    ENABLE {      XLibrarian.WrongPropertyType => ERROR WrongPropertyType;      XLibrarian.Error => ERROR Error[implementationBug]};    XLibrarian.RemoveProperty[XPList[plist], XLibAtom[tag]]};-- GetPropertyXXXX returns discriminated values  GetTimeProperty: PUBLIC PROC [plist: PropertyList, tag: Atom]    RETURNS [System.GreenwichMeanTime] = {    ENABLE {      XLibrarian.WrongPropertyType => ERROR WrongPropertyType;      XLibrarian.Error => ERROR Error[implementationBug]};    RETURN[XLibrarian.GetTimeProperty[XPList[plist], XLibAtom[tag]]]};  GetRecordProperty: PUBLIC PROC [plist: PropertyList, tag: Atom]    RETURNS [LONG DESCRIPTOR FOR ARRAY OF WORD] = {    ENABLE {      XLibrarian.WrongPropertyType => ERROR WrongPropertyType;      XLibrarian.Error => ERROR Error[implementationBug]};    RETURN[XLibrarian.GetRecordProperty[XPList[plist], XLibAtom[tag]]]};  GetStringProperty: PUBLIC PROC [plist: PropertyList, tag: Atom]    RETURNS [LONG STRING] = {    ENABLE {      XLibrarian.WrongPropertyType => ERROR WrongPropertyType;      XLibrarian.Error => ERROR Error[implementationBug]};    RETURN[XLibrarian.GetStringProperty[XPList[plist], XLibAtom[tag]]]};  GetStringsProperty: PUBLIC PROC [plist: PropertyList, tag: Atom]    RETURNS [LONG DESCRIPTOR FOR ARRAY OF LONG STRING] = {    ENABLE {      XLibrarian.WrongPropertyType => ERROR WrongPropertyType;      XLibrarian.Error => ERROR Error[implementationBug]};    RETURN[XLibrarian.GetStringsProperty[XPList[plist], XLibAtom[tag]]]};  GetIntegerProperty: PUBLIC PROC [plist: PropertyList, tag: Atom]    RETURNS [LONG INTEGER] = {    ENABLE {      XLibrarian.WrongPropertyType => ERROR WrongPropertyType;      XLibrarian.Error => ERROR Error[implementationBug]};    RETURN[XLibrarian.GetIntegerProperty[XPList[plist], XLibAtom[tag]]]};  AddProperty: PUBLIC PROC [plist: PropertyList, prop: Property] = {    ENABLE {      XLibrarian.WrongPropertyType => ERROR WrongPropertyType;      XLibrarian.Error => ERROR Error[implementationBug]};    XLibrarian.AddProperty[XPList[plist], XProp[prop]]};  AddTimeProperty: PUBLIC PROC [    plist: PropertyList, tag: Atom, time: System.GreenwichMeanTime] = {    ENABLE {      XLibrarian.WrongPropertyType => ERROR WrongPropertyType;      XLibrarian.Error => ERROR Error[implementationBug]};    XLibrarian.AddTimeProperty[XPList[plist], XLibAtom[tag], time]};  AddIntegerProperty: PUBLIC PROC [    plist: PropertyList, tag: Atom, integer: LONG INTEGER] = {    ENABLE {      XLibrarian.WrongPropertyType => ERROR WrongPropertyType;      XLibrarian.Error => ERROR Error[implementationBug]};    XLibrarian.AddIntegerProperty[XPList[plist], XLibAtom[tag], integer]};  AddStringProperty: PUBLIC PROC [    plist: PropertyList, tag: Atom, string: LONG STRING] = {    ENABLE {      XLibrarian.WrongPropertyType => ERROR WrongPropertyType;      XLibrarian.Error => ERROR Error[implementationBug]};    XLibrarian.AddStringProperty[XPList[plist], XLibAtom[tag], string]};  AddRecordProperty: PUBLIC PROC [    plist: PropertyList, tag: Atom, record: Librarian.Record] = {    ENABLE {      XLibrarian.WrongPropertyType => ERROR WrongPropertyType;      XLibrarian.Error => ERROR Error[implementationBug]};    XLibrarian.AddRecordProperty[XPList[plist], XLibAtom[tag], record]};  AddStringsProperty: PUBLIC PROC [    plist: PropertyList, tag: Atom, strings: Librarian.Strings] = {    ENABLE {      XLibrarian.WrongPropertyType => ERROR WrongPropertyType;      XLibrarian.Error => ERROR Error[implementationBug]};    XLibrarian.AddStringsProperty[XPList[plist], XLibAtom[tag], strings]};  StringForErrorCode: PUBLIC PROC [code: Librarian.ErrorCode, s: LONG STRING] = {    String.AppendString[to: s, from:      SELECT code FROM	implementationBug => "Implementation Bug"L,	noSuchAtom => "No Such Atom"L,	serverDead => "Server Dead"L,	serverNotStarted => "Server Not Started"L,	noConnectionsAvailable => "No Connections Available"L,	noSuchDataBase => "No Such Database"L,	authenticationFailure => "Authentication Failure"L,	insufficientAccess => "Insufficient Access"L,	insufficientAuthentication => "Insufficient Authentication"L,	invalidHandle => "Invalid Handle"L,	alreadyCheckedOut => "Already Checked Out"L,	notCheckedOut => "Not Checked Out"L,	noSuchLibject => "No Such Libject"L,	libjectAlreadyExists => "Libject Already Exists"L,	dataBaseBusy => "Database Currently Unavailable"L,	nameTooLong => "Name Too Long"L,	nilZone => "Nil Zone"L,	reservedProperty => "Reserved Property"L,	illegalType => "Illegal Type"L,	notCheckedOutToYou => "Not Checked Out To You"L,	communicationError => "Communication Error"L,        ENDCASE => "unknown Error"L ! String.StringBoundsFault => RESUME[NIL]]};  -- loopholes  XPList: PROCEDURE [p: PropertyList] RETURNS [xp: XLibrarian.PropertyList] = INLINE {    RETURN[LOOPHOLE[p]]};  TajoPList: PROCEDURE [xp: XLibrarian.PropertyList]    RETURNS [p: PropertyList] = INLINE {RETURN[LOOPHOLE[xp]]};  XLibAtom: PROCEDURE [a: Atom] RETURNS [xa: XLibrarian.Atom] = INLINE {    RETURN[LOOPHOLE[a]]};  XProp: PROCEDURE [p: Property] RETURNS [xp: XLibrarian.Property] = INLINE {    RETURN[LOOPHOLE[p]]};  TajoProp: PROCEDURE [xp: XLibrarian.Property] RETURNS [p: Property] = INLINE {    RETURN[LOOPHOLE[xp]]};      Init: PROC = {};    -- main line code  Init[];  END.  -- of LibTajoPropList  