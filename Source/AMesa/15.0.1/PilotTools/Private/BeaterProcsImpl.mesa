-- Copyright (C) 1988  by Xerox Corporation. All rights reserved. -- BeaterProcsImpl.mesa	CAJ	20-May-88  9:14:36DIRECTORY  BeaterProcs,  Environment USING [wordsPerPage],  Space USING [Error, ScratchMap, Unmap];BeaterProcsImpl: MONITOR  IMPORTS Space  EXPORTS BeaterProcs =  BEGIN  -- PUBLIC variables, errors  countRegistered: PUBLIC CARDINAL ¬ 0;  BeaterListEmpty: PUBLIC ERROR = CODE;  BeaterListFull: PUBLIC ERROR = CODE;  IllegalKey: PUBLIC ERROR = CODE;  -- Private variables  beaterProcArray: LONG POINTER TO ARRAY [0..0) OF BeaterProcs.BeaterProc ¬ NIL;  maxEntries: CARDINAL ¬ startingMax;  startingMax: CARDINAL = 256;  -- Procedures  RegisterBeaterProc: PUBLIC ENTRY PROCEDURE [proc: BeaterProcs.BeaterProc] =    -- Add the supplied procedure to the set of procedures used for beating.    -- If there isn't room for any more, BeaterListFull is raised.    BEGIN    SELECT countRegistered FROM      maxEntries => ERROR BeaterListFull;        -- Someday: allocate bigger array, transfer contents, give back old,	-- reset maxEntries, and continue.      0 =>        BEGIN  -- allocate array space on first register        beaterProcArray ¬ Space.ScratchMap[((maxEntries*SIZE[PROCEDURE])          + Environment.wordsPerPage - 1)/Environment.wordsPerPage];          -- ?? should this be resident??	END;      ENDCASE;  -- normal case    beaterProcArray[countRegistered] ¬ proc;    countRegistered ¬ countRegistered + 1;    END;  Shutdown: PUBLIC PROCEDURE =    -- Resets BeaterProcs facility and returns resources.    BEGIN    countRegistered ¬ 0;    -- maxEntries ¬ startingMax;    beaterProcArray ¬ Space.Unmap[beaterProcArray ! Space.Error => CONTINUE];    END;  Select: PUBLIC PROCEDURE [key: CARDINAL]    RETURNS [proc: BeaterProcs.BeaterProc] =    -- Return the procedure selected by key.    BEGIN    IF countRegistered = 0 THEN ERROR BeaterListEmpty;    IF key >= countRegistered THEN ERROR IllegalKey;    proc ¬ beaterProcArray[key];    END;  UnRegisterBeaterProc: PUBLIC ENTRY PROCEDURE [proc: BeaterProcs.BeaterProc]    RETURNS [success: BOOLEAN] =    -- Remove proc from the set of procedures used for beating.    -- If proc is in the set more than once, the first encountered is removed.    -- success indicates whether proc was successfully found and removed.    BEGIN    -- unimplemented    success ¬ FALSE;    END;  END.LOG20-May-88  9:14:29	CAJ	Created file.