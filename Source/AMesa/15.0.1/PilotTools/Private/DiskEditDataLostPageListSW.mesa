-- Copyright (C) 1988  by Xerox Corporation. All rights reserved. -- DiskEditDataLostPageListSW.mesa     10-Mar-88 12:49:53 by CAJ  DIRECTORY  DiskEditInternal USING [dataPtr, dataWindowKey],  Environment USING [wordsPerPage],  FormSW USING [    AllocateItemDescriptor, ClientItemsProcType, CommandItem, DisplayItem,    ItemHandle, LabelItem, LongNumberItem, newLine, nextPlace, NumberItem,    NumberNotifyProcType, ProcType],  PhysicalVolumeFormat USING [DataLostPageHeader, DataLostPageList, PageNumber],  UserTerminal USING [BlinkDisplay],  WindowSwap USING [RegisterView];DiskEditDataLostPageListSW: PROGRAM  IMPORTS DiskEditInternal, FormSW, UserTerminal, WindowSwap =  BEGIN  FormItems: TYPE = {    begin, title, countPages, maxEntries, pageIndex, dataLostPage, next, back};  dataLostPageList: PhysicalVolumeFormat.DataLostPageList =    LOOPHOLE[DiskEditInternal.dataPtr];  dataLostPage: PhysicalVolumeFormat.PageNumber;  pageIndex: CARDINAL;  BackCommand: FormSW.ProcType =    BEGIN    dataLostPageList.pages[pageIndex] ¬ dataLostPage;    pageIndex ¬      IF pageIndex = 0 THEN      (Environment.wordsPerPage - SIZE[PhysicalVolumeFormat.DataLostPageHeader])/        SIZE[PhysicalVolumeFormat.PageNumber] - 1      ELSE pageIndex - 1;    dataLostPage ¬ dataLostPageList.pages[pageIndex];    FormSW.DisplayItem[sw, FormItems.dataLostPage.ORD];    FormSW.DisplayItem[sw, FormItems.pageIndex.ORD];    END;  CleanupDataLostPageListSW: PROCEDURE =    BEGIN    dataLostPageList.pages[pageIndex] ¬ dataLostPage;    END;  FillDataLostPageListSW: PROCEDURE =    BEGIN    pageIndex ¬ 0;    dataLostPage ¬ dataLostPageList.pages[pageIndex];    END;  MakeDataLostPageListSW: FormSW.ClientItemsProcType =    BEGIN    i: CARDINAL ¬ 0;    nItems: CARDINAL = 8;    items ¬ FormSW.AllocateItemDescriptor[nItems];    items[FormItems.begin.ORD] ¬ FormSW.LabelItem[      tag: NIL, invisible: TRUE, place: FormSW.newLine];    items[FormItems.title.ORD] ¬ FormSW.LabelItem[      tag:      "DataLost page list - 1st page    (view later pages in BadPageList view)"L,      place: FormSW.newLine];    items[FormItems.countPages.ORD] ¬ FormSW.LongNumberItem[      tag: "CountPages "L, signed: FALSE, notNegative: TRUE, radix: decimal,      default: 0, value: @dataLostPageList.header.countPages,      place: FormSW.newLine];    items[FormItems.maxEntries.ORD] ¬ FormSW.LongNumberItem[      tag: "MaxEntries "L, signed: FALSE, notNegative: TRUE, radix: decimal,      default: 0, value: @dataLostPageList.header.maxEntries,      place: FormSW.nextPlace];    items[FormItems.pageIndex.ORD] ¬ FormSW.NumberItem[      tag: "Index "L, signed: FALSE, notNegative: TRUE, radix: decimal,      default: 0, value: @pageIndex, proc: NoticeNewIndex, place: FormSW.newLine];    items[FormItems.dataLostPage.ORD] ¬ FormSW.LongNumberItem[      tag: "DataLost page "L, signed: FALSE, notNegative: TRUE, radix: decimal,      default: 0, value: @dataLostPage, place: FormSW.nextPlace];    items[FormItems.next.ORD] ¬ FormSW.CommandItem[      tag: "Next"L, proc: NextCommand, place: FormSW.nextPlace];    items[FormItems.back.ORD] ¬ FormSW.CommandItem[      tag: "Back"L, proc: BackCommand, place: FormSW.nextPlace];    RETURN[items, TRUE]    END;  NextCommand: FormSW.ProcType =    BEGIN    dataLostPageList.pages[pageIndex] ¬ dataLostPage;    pageIndex ¬ (pageIndex + 1) MOD ((Environment.wordsPerPage -      SIZE[PhysicalVolumeFormat.DataLostPageHeader])/        SIZE[PhysicalVolumeFormat.PageNumber]);    dataLostPage ¬ dataLostPageList.pages[pageIndex];    FormSW.DisplayItem[sw, FormItems.dataLostPage.ORD];    FormSW.DisplayItem[sw, FormItems.pageIndex.ORD];    END;  NoticeNewIndex: FormSW.NumberNotifyProcType =    BEGIN    IF pageIndex ~IN      [0..Environment.wordsPerPage/SIZE[PhysicalVolumeFormat.PageNumber])        THEN {UserTerminal.BlinkDisplay[]; RETURN};    dataLostPageList.pages[oldValue] ¬ dataLostPage;    dataLostPage ¬ dataLostPageList.pages[pageIndex];    FormSW.DisplayItem[sw, FormItems.dataLostPage.ORD];    END;  -- Module initialization:  -- Register this subwindow as a view for the data subwindow  WindowSwap.RegisterView[    key: DiskEditInternal.dataWindowKey,    viewName: "DataLost page list"L,    makeFormSW: MakeDataLostPageListSW,    viewFromDataProc: FillDataLostPageListSW,    dataFromViewProc: CleanupDataLostPageListSW];  END.LOG10-Mar-88 12:49:48   CAJ       Create file.